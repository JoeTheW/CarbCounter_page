"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6657],{6657:(A,f,l)=>{l.r(f),l.d(f,{ViewEntriesPageModule:()=>Q});var g=l(177),m=l(4341),s=l(3819),h=l(9858),y=l(467),_=l(8581),p=l(4618),t=l(4438),b=l(7225),D=l(2038),E=l(4988),P=l(5293),w=l(9385);let T=(()=>{var n;class r{transform(o,i=0,a="down"){return("down"===a?Math.floor:Math.ceil)(o*10**i)/10**i}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=t.EJ8({name:"toFixed",type:n,pure:!0}),r})();function j(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-button",6),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.incrementPage(-1))}),t.nrm(1,"ion-icon",7),t.k0s()}}function F(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-button",6),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.incrementPage(1))}),t.nrm(1,"ion-icon",8),t.k0s()}}function I(n,r){if(1&n&&(t.j41(0,"ion-toolbar")(1,"ion-row",1)(2,"ion-col",2),t.DNE(3,j,2,0,"ion-button",3),t.k0s(),t.j41(4,"ion-col",4)(5,"p"),t.EFF(6),t.nI1(7,"toFixed"),t.k0s()(),t.j41(8,"ion-col",5),t.DNE(9,F,2,0,"ion-button",3),t.k0s()()()),2&n){let e;const o=t.XpG();t.R7$(3),t.Y8G("ngIf",o.pageable.page-1>0),t.R7$(3),t.Lme("page ",o.pageable.page," of ",t.brH(7,4,o.pageable.totalElements?o.pageable.totalElements/o.pageable.size:o.pageable.page,0,"up"),""),t.R7$(3),t.Y8G("ngIf",(null!==(e=o.pageable.totalElements)&&void 0!==e?e:o.pageable.size)>o.pageable.page*o.pageable.size)}}let k=(()=>{var n;class r{constructor(){this.pageableChange=new t.bkB,this.onPageChanged=new t.bkB}ngOnInit(){}incrementPage(o){this.pageable.page+=o,this.pageableChange.emit(this.pageable),this.onPageChanged.emit(this.pageable)}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-paging"]],inputs:{pageable:"pageable"},outputs:{pageableChange:"pageableChange",onPageChanged:"onPageChanged"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"flex","justify-content-between"],[1,"flex","justify-content-start"],["fill","clear",3,"click",4,"ngIf"],[1,"flex","justify-content-center"],[1,"flex","justify-content-end"],["fill","clear",3,"click"],["color","medium","slot","icon-only","name","chevron-back"],["color","medium","slot","icon-only","name","chevron-forward"]],template:function(o,i){1&o&&t.DNE(0,I,10,8,"ion-toolbar",0),2&o&&t.Y8G("ngIf",i.pageable)},dependencies:[g.bT,s.Jm,s.hU,s.iq,s.ln,s.ai,T]}),r})(),S=(()=>{var n;class r{transform(o,i){return 0===i?0:o/i}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=t.EJ8({name:"fractionOf",type:n,pure:!0}),r})(),V=(()=>{var n;class r{transform(o,i){return 0===i?0:Math.round(o/i*100)}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=t.EJ8({name:"percentOf",type:n,pure:!0}),r})();const R=n=>({above:n});function O(n,r){if(1&n){const e=t.RV6();t.j41(0,"div",1),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.changeMode())}),t.j41(1,"span",2)(2,"small"),t.EFF(3),t.k0s()(),t.nrm(4,"ion-progress-bar",3),t.nI1(5,"fractionOf"),t.nI1(6,"fractionOf"),t.j41(7,"div",4)(8,"p",5),t.EFF(9),t.k0s(),t.j41(10,"p",6),t.EFF(11),t.nI1(12,"number"),t.nI1(13,"percentOf"),t.k0s(),t.j41(14,"p",7),t.EFF(15),t.k0s()()()}if(2&n){const e=t.XpG();t.Y8G("ngClass",t.eq3(20,R,e.total>e.target)),t.R7$(3),t.JRh(e.title),t.R7$(),t.Y8G("value",e.total>e.target?t.i5U(5,8,e.target,e.total):t.i5U(6,11,e.total,e.target)),t.R7$(5),t.Lme("",e.total>e.target?"goal":"total "," ",e.total>e.target?e.target:e.total,"g"),t.R7$(2),t.JRh(e.total>e.target?t.i5U(12,14,e.total-e.target,"1.1-2")+"g exceeded":t.i5U(13,17,e.total,e.target)+"%"),t.R7$(4),t.Lme("",e.total>e.target?"total":"goal "," ",e.total>e.target?e.total:e.target,"g")}}let x=(()=>{var n;class r{constructor(o,i){this.foodLogService=o,this.loadingService=i,this.total=0,this.onTotalChange=new t.bkB}ngOnInit(){this.setup()}setup(){this.getCarbGoal()}getCarbGoal(){this.loadingService.addToQueue(this.foodLogService.getDailyCarbGoal().then(o=>{}))}changeMode(){}}return(n=r).\u0275fac=function(o){return new(o||n)(t.rXU(b.i),t.rXU(D.U))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-progress-display"]],inputs:{total:"total",target:"target",title:"title"},outputs:{onTotalChange:"onTotalChange"},decls:1,vars:1,consts:[["class","mx-2 carb-goal-progress",3,"ngClass","click",4,"ngIf"],[1,"mx-2","carb-goal-progress",3,"click","ngClass"],[1,"flex","justify-content-center"],[3,"value"],[1,"flex","justify-content-between","above"],[1,"my-1","carb-progress-value-text"],[1,"my-1"],[1,"my-1","carb-progress-target-text"]],template:function(o,i){1&o&&t.DNE(0,O,16,22,"div",0),2&o&&t.Y8G("ngIf",i.target)},dependencies:[g.YU,g.bT,s.FH,g.QX,S,V]}),r})();var G=l(7058);const C=()=>({weekday:"short",month:"long",day:"2-digit"}),v=n=>({date:n});function M(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-datetime",20),t.mxI("ngModelChange",function(i){t.eBV(e);const a=t.XpG();return t.DH7(a.fromDateString,i)||(a.fromDateString=i),t.Njj(i)}),t.bIt("ionChange",function(i){t.eBV(e);const a=t.XpG();return t.Njj(a.fromDateChanged(i))}),t.j41(1,"span",21),t.EFF(2,"Select from date"),t.k0s()()}if(2&n){const e=t.XpG();t.R50("ngModel",e.fromDateString),t.Y8G("formatOptions",t.eq3(4,v,t.lJ4(3,C)))("showDefaultButtons",!0)}}function B(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-datetime",22),t.mxI("ngModelChange",function(i){t.eBV(e);const a=t.XpG();return t.DH7(a.toDateString,i)||(a.toDateString=i),t.Njj(i)}),t.bIt("ionChange",function(i){t.eBV(e);const a=t.XpG();return t.Njj(a.toDateChanged(i))}),t.j41(1,"span",21),t.EFF(2,"Select from date"),t.k0s()()}if(2&n){const e=t.XpG();t.R50("ngModel",e.toDateString),t.Y8G("formatOptions",t.eq3(4,v,t.lJ4(3,C)))("showDefaultButtons",!0)}}function L(n,r){if(1&n&&(t.j41(0,"ion-row")(1,"ion-card-subtitle")(2,"strong"),t.EFF(3),t.k0s()()()),2&n){const e=t.XpG().$implicit;t.R7$(3),t.JRh(e.note)}}function $(n,r){if(1&n&&(t.j41(0,"ion-card",36)(1,"ion-card-content",37),t.nrm(2,"app-portion",38),t.k0s()()),2&n){const e=r.$implicit;t.R7$(2),t.Y8G("portionId",e)("allowDBDeletion",!1)("allowEdit",!1)}}function N(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-button",39),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,a=t.XpG();return t.Njj(a.normaliseCarbs(i))}),t.EFF(1," mismatch "),t.nrm(2,"ion-icon",40),t.k0s()}}function X(n,r){if(1&n){const e=t.RV6();t.j41(0,"ion-card",23)(1,"ion-card-header",24),t.DNE(2,L,4,1,"ion-row",25),t.j41(3,"ion-row")(4,"ion-card-subtitle"),t.EFF(5),t.nI1(6,"ordinalDate"),t.k0s()(),t.j41(7,"ion-row")(8,"ion-card-title"),t.EFF(9),t.k0s()()(),t.j41(10,"ion-card-content")(11,"ion-row")(12,"h1"),t.EFF(13),t.k0s()(),t.j41(14,"ion-row")(15,"ion-accordion-group",26)(16,"ion-accordion",27)(17,"ion-item",28)(18,"ion-card-subtitle"),t.EFF(19),t.k0s()(),t.j41(20,"div",29),t.DNE(21,$,3,3,"ion-card",30),t.k0s()()()(),t.j41(22,"ion-row")(23,"ion-col",31)(24,"div",32)(25,"ion-button",33),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.deleteEntry(i))}),t.nrm(26,"ion-icon",34),t.k0s(),t.DNE(27,N,3,0,"ion-button",35),t.k0s()()()()()}if(2&n){const e=r.$implicit;t.R7$(2),t.Y8G("ngIf",e.note),t.R7$(3),t.JRh(t.bMT(6,8,e.date)),t.R7$(4),t.JRh(e.name),t.R7$(4),t.SpI("Carbs: ",e.carbs,"g"),t.R7$(6),t.Lme("",e.portionIds.length," portion",e.portionIds.length>1?"s":"",""),t.R7$(2),t.Y8G("ngForOf",e.portionIds),t.R7$(6),t.Y8G("ngIf",e.carbs!=e.portionCarbs)}}const Y=[{path:"",component:(()=>{var n;class r{constructor(o,i,a,c){this.foodLogService=o,this.loadingService=i,this.alertService=a,this.portionService=c,this.pageable={page:1,size:5},this.today=new Date,this.fromDate=new Date,this.toDate=new Date,this.progress={carbGoal:0,carbTotal:0,title:""}}ngOnInit(){this.setupDateRange(),this.setup()}setup(){this.loadFoodLogs()}setupDateRange(){this.today=new Date,this.fromDate=p.E.getStartOfDay(this.today),this.toDate=p.E.getEndOfDay(this.today)}loadFoodLogs(){var o=this;this.calculateCarbValues(),this.loadingService.addToQueue(this.foodLogService.getAllInRangeOrderedByIndexPaged(_.$I.FOOD_LOG_TBL_DATE,this.pageable,"desc",this.fromDate,this.toDate).then(i=>{this.foodLogs=i,this.foodLogs.forEach(a=>{a.portionCarbs=0,a.portionIds.forEach(function(){var c=(0,y.A)(function*(d){var u;let H=yield o.portionService.getByKey(d);a.portionCarbs=(null!==(u=a.portionCarbs)&&void 0!==u?u:0)+H.carbs});return function(d){return c.apply(this,arguments)}}())})}))}calculateCarbValues(){let o=this.toDate.getTime()-this.fromDate.getTime(),i=Math.round(o/864e5);this.loadingService.addToQueue(this.foodLogService.getDailyCarbGoal().then(a=>{this.progress.carbGoal=a*i,this.progress.title=`${i} day${1==i?"":"s"}`})),this.loadingService.addToQueue(this.foodLogService.getAllInRangeOrderedByIndexPaged(_.$I.FOOD_LOG_TBL_DATE,{page:0,size:999999999},"desc",this.fromDate,this.toDate).then(a=>{a||(this.progress.carbTotal=0),this.progress.carbTotal=a.reduce((c,d)=>c+(d.carbs||0),0)}))}pageChanged(o){this.loadFoodLogs()}deleteEntry(o){this.alertService.promptConfirmation("Confirm","are you sure you want to delete this entry?","no","yes").then(i=>{i&&this.loadingService.addToQueue(this.foodLogService.deleteEntityFromDB(o.id).then(()=>{this.pageChanged(this.pageable)}))})}normaliseCarbs(o){this.alertService.promptConfirmation("Normalise carbs?","The portions within this entry have been updated - update the carb count?","no","yes").then(i=>{i&&(o.carbs=o.portionCarbs,this.loadingService.addToQueue(this.foodLogService.saveItemToDB(o)),this.calculateCarbValues())})}fromDateChanged(o){let a=new Date(o.detail.value);if(a.getTime()>this.toDate.getTime())return this.alertService.simpleError("From date must be before to date."),void(this.fromDateString=this.toLocalISOString(this.fromDate));this.fromDate=a,this.fromDate=p.E.getStartOfDay(this.fromDate),this.loadFoodLogs()}toDateChanged(o){let a=new Date(o.detail.value);if(a.getTime()<this.fromDate.getTime())return this.alertService.simpleError("To date must be after from date."),void(this.toDateString=this.toLocalISOString(this.toDate));this.toDate=a,this.toDate=p.E.getEndOfDay(this.toDate),this.loadFoodLogs()}incrementRange(o){let i=this.toDate.getTime()-this.fromDate.getTime(),a=Math.round(i/864e5);this.fromDate=this.addDays(this.fromDate,a*o),this.toDate=this.addDays(this.toDate,a*o),this.fromDateString=this.toLocalISOString(this.fromDate),this.toDateString=this.toLocalISOString(this.toDate),this.loadFoodLogs()}addDays(o,i){const a=new Date(o);return a.setDate(a.getDate()+i),a}toLocalISOString(o){const i=6e4*o.getTimezoneOffset();return new Date(o.getTime()-i).toISOString().slice(0,-1)}}return(n=r).\u0275fac=function(o){return new(o||n)(t.rXU(b.i),t.rXU(D.U),t.rXU(E.u),t.rXU(P.t))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-view-entries"]],decls:38,vars:9,consts:[[3,"translucent"],["slot","start"],["size","large"],[1,"flex","justify-content-between"],[1,"flex","justify-content-start","m-0"],["fill","clear",1,"default-chevrons",3,"click"],["color","medium","slot","icon-only","name","chevron-back"],[1,"flex","flex-row","justify-content-center"],[1,"date-picker"],["datetime","from-datetime"],["datetime","to-datetime"],[1,"flex","justify-content-end","m-0"],["color","medium","slot","icon-only","name","chevron-forward"],[1,"narrow-chevrons","m-0"],["fill","clear",1,"m-0",3,"click"],[3,"keepContentsMounted"],[3,"fullscreen"],["class","no-padding-card",4,"ngFor","ngForOf"],[3,"total","target","title"],[3,"pageableChange","onPageChanged","pageable"],["id","from-datetime","presentation","date",3,"ngModelChange","ionChange","ngModel","formatOptions","showDefaultButtons"],["slot","title"],["id","to-datetime","presentation","date",3,"ngModelChange","ionChange","ngModel","formatOptions","showDefaultButtons"],[1,"no-padding-card"],["mode","ios"],[4,"ngIf"],[1,"w-full"],["value","first"],["slot","header"],["slot","content"],["class","portion-card",4,"ngFor","ngForOf"],[1,"flex","justify-content-start"],[1,"flex","align-items-start"],["item-start","","fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["item-start","","fill","clear","color","warning",3,"click",4,"ngIf"],[1,"portion-card"],[1,"no-padding"],[3,"portionId","allowDBDeletion","allowEdit"],["item-start","","fill","clear","color","warning",3,"click"],["slot","icon-only","name","refresh"]],template:function(o,i){1&o&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title",2),t.EFF(5,"Entries"),t.k0s()(),t.j41(6,"ion-toolbar")(7,"ion-row",3)(8,"ion-col",4)(9,"ion-button",5),t.bIt("click",function(){return i.incrementRange(-1)}),t.nrm(10,"ion-icon",6),t.k0s()(),t.j41(11,"div",7)(12,"div",8)(13,"ion-label"),t.EFF(14,"From Date"),t.k0s(),t.nrm(15,"ion-datetime-button",9),t.k0s(),t.j41(16,"div",8)(17,"ion-label"),t.EFF(18,"To Date"),t.k0s(),t.nrm(19,"ion-datetime-button",10),t.k0s()(),t.j41(20,"ion-col",11)(21,"ion-button",5),t.bIt("click",function(){return i.incrementRange(1)}),t.nrm(22,"ion-icon",12),t.k0s()()(),t.j41(23,"div",13)(24,"ion-button",14),t.bIt("click",function(){return i.incrementRange(-1)}),t.nrm(25,"ion-icon",6),t.k0s(),t.j41(26,"ion-button",14),t.bIt("click",function(){return i.incrementRange(1)}),t.nrm(27,"ion-icon",12),t.k0s()()()(),t.j41(28,"ion-modal",15),t.DNE(29,M,3,6,"ng-template"),t.k0s(),t.j41(30,"ion-modal",15),t.DNE(31,B,3,6,"ng-template"),t.k0s(),t.j41(32,"ion-content",16),t.DNE(33,X,28,10,"ion-card",17),t.k0s(),t.j41(34,"ion-footer")(35,"ion-toolbar"),t.nrm(36,"app-progress-display",18),t.j41(37,"app-paging",19),t.mxI("pageableChange",function(c){return t.DH7(i.pageable,c)||(i.pageable=c),c}),t.bIt("onPageChanged",function(c){return i.pageChanged(c)}),t.k0s()()()),2&o&&(t.Y8G("translucent",!0),t.R7$(28),t.Y8G("keepContentsMounted",!0),t.R7$(2),t.Y8G("keepContentsMounted",!0),t.R7$(2),t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("ngForOf",i.foodLogs),t.R7$(3),t.Y8G("total",i.progress.carbTotal)("target",i.progress.carbGoal)("title",i.progress.title),t.R7$(),t.R50("pageable",i.pageable))},dependencies:[g.Sq,g.bT,m.BC,m.vS,s.xk,s.YH,s.Jm,s.QW,s.b_,s.I9,s.ME,s.HW,s.tN,s.hU,s.W9,s.A9,s.K4,s.M0,s.eU,s.iq,s.uz,s.he,s.MC,s.ln,s.BC,s.ai,s.Sb,s.Je,w.x,k,x,G.W],styles:[".default-chevrons[_ngcontent-%COMP%]{display:flex!important}.narrow-chevrons[_ngcontent-%COMP%]{display:none;justify-content:center;margin-top:10px}@media (max-width: 350px){.default-chevrons[_ngcontent-%COMP%]{display:none!important}.narrow-chevrons[_ngcontent-%COMP%]{display:flex}}"]}),r})()}];let U=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[h.iI.forChild(Y),h.iI]}),r})();var J=l(1815),z=l(4683);let Q=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[g.MD,m.YN,s.bv,U,J.U,z.Y]}),r})()}}]);