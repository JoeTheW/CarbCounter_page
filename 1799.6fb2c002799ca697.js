"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1799],{4180:(U,f,s)=>{s.r(f),s.d(f,{AddEntryPageModule:()=>X});var p=s(177),u=s(4341),l=s(3819),g=s(9858),t=s(4438),h=s(4569),_=s(7225),y=s(2038),v=s(529),E=s(4988),I=s(467);function b(o,a){1&o&&(t.j41(0,"span"),t.EFF(1,"*"),t.k0s())}function k(o,a){1&o&&(t.j41(0,"ion-text",8)(1,"small"),t.EFF(2,"This field is required."),t.k0s()())}function P(o,a){if(1&o){const i=t.RV6();t.j41(0,"div")(1,"ion-item")(2,"ion-label"),t.EFF(3),t.DNE(4,b,2,0,"span",5),t.k0s(),t.j41(5,"ion-input",6),t.mxI("ngModelChange",function(e){const r=t.eBV(i).$implicit;return t.DH7(r.value,e)||(r.value=e),t.Njj(e)}),t.k0s(),t.DNE(6,k,3,0,"ion-text",7),t.k0s()()}if(2&o){const i=a.$implicit;t.R7$(),t.AVh("required",(null==i.attributes?null:i.attributes.required)&&!i.value),t.R7$(2),t.JRh(i.label),t.R7$(),t.Y8G("ngIf",null==i.attributes?null:i.attributes.required),t.R7$(),t.R50("ngModel",i.value),t.Y8G("type",i.type),t.R7$(),t.Y8G("ngIf",(null==i.attributes?null:i.attributes.required)&&!i.value)}}let M=(()=>{var o;class a{constructor(n){this.modalController=n}ngOnInit(){}isValid(){return this.inputs.every(n=>{var e;return!(null!==(e=n.attributes)&&void 0!==e&&e.required)||n.value})}dismiss(n){this.modalController.dismiss({data:this.getFormData()},n?"confirm":"cancel")}confirm(){this.isValid()&&this.dismiss(!0)}getFormData(){const n={};return this.inputs.forEach(e=>{n[e.name]=e.value}),n}}return(o=a).\u0275fac=function(n){return new(n||o)(t.rXU(l.W3))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-input-modal"]],inputs:{title:"title",message:"message",inputs:"inputs"},decls:16,vars:4,consts:[[4,"ngFor","ngForOf"],["slot","start"],[3,"click"],["slot","end"],[3,"click","disabled"],[4,"ngIf"],["required","",3,"ngModelChange","ngModel","type"],["color","danger",4,"ngIf"],["color","danger"]],template:function(n,e){1&n&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s()()(),t.j41(4,"ion-content")(5,"p"),t.EFF(6),t.k0s(),t.DNE(7,P,7,7,"div",0),t.k0s(),t.j41(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",1)(11,"ion-button",2),t.bIt("click",function(){return e.dismiss(!1)}),t.EFF(12,"Cancel"),t.k0s()(),t.j41(13,"ion-buttons",3)(14,"ion-button",4),t.bIt("click",function(){return e.confirm()}),t.EFF(15,"Confirm"),t.k0s()()()()),2&n&&(t.R7$(3),t.JRh(e.title),t.R7$(3),t.JRh(e.message),t.R7$(),t.Y8G("ngForOf",e.inputs),t.R7$(7),t.Y8G("disabled",!e.isValid()))},dependencies:[p.Sq,p.bT,u.BC,u.YS,u.vS,l.Jm,l.QW,l.W9,l.M0,l.eU,l.$w,l.uz,l.he,l.IO,l.BC,l.ai,l.Gw],styles:[".required[_ngcontent-%COMP%]{border:1px solid red}"]}),a})(),C=(()=>{var o;class a{constructor(n){this.modalController=n}presentInputModal(n,e,r){var d=this;return(0,I.A)(function*(){const c=yield d.modalController.create({component:M,componentProps:{inputs:n,title:e,message:r},cssClass:"small-modal",showBackdrop:!0});yield c.present();const m=yield c.onDidDismiss();return{data:m.data||{},confirmed:"confirm"===m.role}})()}}return(o=a).\u0275fac=function(n){return new(n||o)(t.KVO(l.W3))},o.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),a})();var F=s(9385);let j=(()=>{var o;class a{transform(n,e){return n?n.reduce((r,d)=>r+(d[e]||0),0):0}}return(o=a).\u0275fac=function(n){return new(n||o)},o.\u0275pipe=t.EJ8({name:"sumProperty",type:o,pure:!1}),a})();function R(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-card-title",15),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.EFF(1),t.k0s()}if(2&o){const i=t.XpG();t.R7$(),t.JRh(i.entry.name)}}function T(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-input",16),t.mxI("ngModelChange",function(e){t.eBV(i);const r=t.XpG();return t.DH7(r.entry.name,e)||(r.entry.name=e),t.Njj(e)}),t.k0s()}if(2&o){const i=t.XpG();t.R50("ngModel",i.entry.name),t.Y8G("autofocus",!0)}}function A(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-icon",17),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.k0s()}if(2&o){const i=t.XpG();t.Y8G("name",i.editTitle?"checkmark":"pencil")}}function S(o,a){if(1&o){const i=t.RV6();t.j41(0,"p",15),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.EFF(1),t.k0s()}if(2&o){let i;const n=t.XpG();t.R7$(),t.JRh(null!==(i=n.entry.note)&&void 0!==i?i:"click to add note")}}function G(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-input",18),t.mxI("ngModelChange",function(e){t.eBV(i);const r=t.XpG();return t.DH7(r.entry.note,e)||(r.entry.note=e),t.Njj(e)}),t.k0s()}if(2&o){const i=t.XpG();t.R50("ngModel",i.entry.note),t.Y8G("autofocus",!0)}}function N(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-icon",19),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.k0s()}if(2&o){const i=t.XpG();t.Y8G("name",i.editNote?"checkmark":"pencil")}}function D(o,a){if(1&o){const i=t.RV6();t.j41(0,"ion-card",20)(1,"ion-card-content",21)(2,"app-portion",22),t.bIt("onPortionDeleted",function(e){t.eBV(i);const r=t.XpG();return t.Njj(r.removePortion(e))}),t.k0s()()()}if(2&o){const i=a.$implicit;t.R7$(2),t.Y8G("portion",i)("allowDBDeletion",!1)("allowEdit",!1)}}const $=[{path:"",component:(()=>{var o;class a{constructor(n,e,r,d,c,m,B){this.catalogService=n,this.foodLogService=e,this.loadingService=r,this.messageService=d,this.alertService=c,this.modalService=m,this.router=B,this.defaultLog={name:"",portionIds:[],date:(new Date).toISOString()},this.entry={...this.defaultLog},this.editTitle=!0,this.editNote=!1,this.portions=[]}ngOnInit(){this.promptInput()}reset(){this.entry={...this.defaultLog},this.portions=[],this.editTitle=!0,this.editNote=!1}openCatalog(){this.catalogService.openFoodCatalog({title:"Select portions to add",callback:this.addSelectedPortions.bind(this),canAddItems:!0,canSelectItems:!1,canSelectPortions:!0})}addSelectedPortions(n){var e;this.portions=this.portions.concat(null!==(e=n.returnedPortions)&&void 0!==e?e:[])}removePortion(n){let e=this.portions.map(r=>r.id).indexOf(n.id);this.portions.splice(e,1)}cancel(){this.reset()}confirm(){this.entry.carbs=this.countCarbs(this.portions),this.entry.portionIds=this.portions.map(n=>n.id).filter(n=>null!=n),this.entry.date=(new Date).toISOString(),this.validate(this.entry)&&this.loadingService.addToQueue(this.foodLogService.saveItemToDB(this.entry).then(n=>{this.reset(),this.messageService.display("Entry saved!"),this.promptNavigation()}))}promptNavigation(){this.alertService.promptConfirmation("View entries","Would you like to view your new log on the entry log page?","no","yes").then(n=>{n&&this.router.navigateByUrl("/view-entries")})}validate(n){var e;let r=!0;return n.name?null==n.portionIds||(null===(e=n.portionIds)||void 0===e?void 0:e.length)<=0?(r=!1,this.alertService.simpleError("Entries cannot be created without portions","Entry invalid"),!1):r:(r=!1,this.alertService.simpleError("Entry must have a name","Entry invalid"),!1)}countCarbs(n){return n.reduce((e,r)=>e+(r.carbs||0),0)}promptInputModal(){this.modalService.presentInputModal([{name:"entryName",label:"entry name",placeholder:"entry name eg. 'lunch'",attributes:{required:!0,autofocus:!0}},{name:"note",label:"note",placeholder:"note eg. 'small lunch'"}],"Enter details","Add info for new entry").then(e=>{if(e.confirmed){let r=e.data.data,d=r.entryName,c=r.note;this.entry.name=null==d||""==d?null:d,this.entry.note=null==c||""==c?null:c,this.editTitle=null==this.entry.name,this.openCatalog()}})}promptInput(){this.alertService.promptInput("Enter details","Add info for new entry",[{name:"entryName",label:"entry name",placeholder:"entry name eg. 'lunch'",attributes:{required:!0,autofocus:!0}},{name:"note",placeholder:"note eg. 'small lunch'"}]).then(e=>{let r=e.entryName,d=e.note;this.entry.name=null==r||""==r?null:r,this.entry.note=null==d||""==d?null:d,this.editTitle=null==this.entry.name,this.openCatalog()})}}return(o=a).\u0275fac=function(n){return new(n||o)(t.rXU(h.H),t.rXU(_.i),t.rXU(y.U),t.rXU(v.b),t.rXU(E.u),t.rXU(C),t.rXU(g.Ix))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-add-entry"]],decls:36,vars:14,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],[3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","large",3,"name","click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","add any extra information","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","small",3,"name","click",4,"ngIf"],["class","portion-card",4,"ngFor","ngForOf"],["lines","none",3,"click"],["name","add","size","large","color","primary"],["slot","end"],["color","medium",3,"click"],[3,"click","strong"],[3,"click"],["fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","large",3,"click","name"],["fill","outline","type","text","placeholder","add any extra information","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","small",3,"click","name"],[1,"portion-card"],[1,"no-padding"],[3,"onPortionDeleted","portion","allowDBDeletion","allowEdit"]],template:function(n,e){1&n&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title",2),t.EFF(5,"Add Entry"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header")(9,"ion-row"),t.DNE(10,R,2,1,"ion-card-title",4)(11,T,1,2,"ion-input",5)(12,A,1,1,"ion-icon",6),t.k0s(),t.j41(13,"ion-card-subtitle"),t.EFF(14,"Select portions"),t.k0s()(),t.j41(15,"ion-card-content")(16,"ion-row"),t.DNE(17,S,2,1,"p",4)(18,G,1,2,"ion-input",7)(19,N,1,1,"ion-icon",8),t.k0s(),t.DNE(20,D,3,3,"ion-card",9),t.j41(21,"ion-item",10),t.bIt("click",function(){return e.openCatalog()}),t.nrm(22,"ion-icon",11),t.j41(23,"ion-label"),t.EFF(24,"Add portion "),t.k0s()()()()(),t.j41(25,"ion-footer")(26,"ion-toolbar")(27,"p")(28,"b"),t.EFF(29),t.nI1(30,"sumProperty"),t.k0s()(),t.j41(31,"ion-buttons",12)(32,"ion-button",13),t.bIt("click",function(){return e.cancel()}),t.EFF(33," Cancel "),t.k0s(),t.j41(34,"ion-button",14),t.bIt("click",function(){return e.confirm()}),t.EFF(35,"Confirm"),t.k0s()()()()),2&n&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("ngIf",!e.editTitle),t.R7$(),t.Y8G("ngIf",e.editTitle),t.R7$(),t.Y8G("ngIf",e.entry.name),t.R7$(5),t.Y8G("ngIf",!e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngForOf",e.portions),t.R7$(9),t.SpI("",t.i5U(30,11,e.portions,"carbs"),"g Carbs"),t.R7$(5),t.Y8G("strong",!0))},dependencies:[p.Sq,p.bT,u.BC,u.vS,l.Jm,l.QW,l.b_,l.I9,l.ME,l.HW,l.tN,l.W9,l.M0,l.eU,l.iq,l.$w,l.uz,l.he,l.MC,l.ln,l.BC,l.ai,l.Gw,F.x,j]}),a})()}];let V=(()=>{var o;class a{}return(o=a).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.iI.forChild($),g.iI]}),a})();var Y=s(1815),x=s(4683);let X=(()=>{var o;class a{}return(o=a).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[p.MD,u.YN,l.bv,V,Y.U,x.Y]}),a})()}}]);