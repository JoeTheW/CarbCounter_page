"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9956],{9956:($,_,a)=>{a.r(_),a.d(_,{AddEntryPageModule:()=>Y});var u=a(177),f=a(4341),l=a(3819),p=a(9858),E=a(7058),m=a(4618),t=a(4438),A=a(4569),T=a(7225),S=a(2038),R=a(529),I=a(4988),P=a(4464),D=a(742),C=a(8361);let k=(()=>{var o;class s{transform(n,e){return n?n.reduce((r,d)=>r+(d[e]||0),0):0}}return(o=s).\u0275fac=function(n){return new(n||o)},o.\u0275pipe=t.EJ8({name:"sumProperty",type:o,pure:!1}),s})();function M(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-card-title",16),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.EFF(1),t.k0s()}if(2&o){const i=t.XpG();t.R7$(),t.JRh(i.entry.name)}}function G(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-input",17),t.mxI("ngModelChange",function(e){t.eBV(i);const r=t.XpG();return t.DH7(r.entry.name,e)||(r.entry.name=e),t.Njj(e)}),t.k0s()}if(2&o){const i=t.XpG();t.R50("ngModel",i.entry.name),t.Y8G("autofocus",!0)}}function j(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-icon",18),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.k0s()}if(2&o){const i=t.XpG();t.Y8G("name",i.editTitle?"checkmark":"pencil")}}function b(o,s){if(1&o){const i=t.RV6();t.j41(0,"p",16),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.EFF(1),t.k0s()}if(2&o){let i;const n=t.XpG();t.R7$(),t.JRh(null!==(i=n.entry.note)&&void 0!==i?i:"click to add note")}}function F(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-input",19),t.mxI("ngModelChange",function(e){t.eBV(i);const r=t.XpG();return t.DH7(r.entry.note,e)||(r.entry.note=e),t.Njj(e)}),t.k0s()}if(2&o){const i=t.XpG();t.R50("ngModel",i.entry.note),t.Y8G("autofocus",!0)}}function X(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-icon",20),t.bIt("click",function(){t.eBV(i);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.k0s()}if(2&o){const i=t.XpG();t.Y8G("name",i.editNote?"checkmark":"pencil")}}function B(o,s){if(1&o){const i=t.RV6();t.j41(0,"ion-card",21)(1,"ion-card-content",22)(2,"app-portion",23),t.bIt("onPortionDeleted",function(e){t.eBV(i);const r=t.XpG();return t.Njj(r.removePortion(e))}),t.k0s()()()}if(2&o){const i=s.$implicit;t.R7$(2),t.Y8G("portion",i)("allowDBDeletion",!1)("allowEdit",!1)("adjustable",!0)}}const x=[{path:"",component:(()=>{var o;class s{constructor(n,e,r,d,c,h,g,y,N,v){this.catalogService=n,this.foodLogService=e,this.loadingService=r,this.messageService=d,this.alertService=c,this.modalService=h,this.router=g,this.route=y,this.normalNav=N,this.ordinalDatePipe=v,this.defaultLog={name:"",portionIds:[],date:(new Date).toISOString()},this.entry={...this.defaultLog},this.editTitle=!1,this.editNote=!1,this.portions=[]}ngOnInit(){this.route.params.subscribe(n=>{this.setup()})}setup(){this.entry.name=this.getDefaultEntryName(),this.promptInputModal()}reset(){this.entry={...this.defaultLog},this.portions=[],this.editTitle=!0,this.editNote=!1,this.setup()}openCatalog(){this.normalNav.setNavigationAllowed(!1),this.catalogService.openFoodCatalog({title:"Select portions to add",callback:this.addSelectedPortions.bind(this),canAddItems:!0,canSelectItems:!1,canSelectPortions:!0})}addSelectedPortions(n){var e;this.portions=this.portions.concat(null!==(e=n.returnedPortions)&&void 0!==e?e:[]),this.normalNav.setNavigationAllowed(!0)}removePortion(n){let e=this.portions.map(r=>r.id).indexOf(n.id);this.portions.splice(e,1)}cancel(){this.reset()}confirm(){this.entry.carbs=this.countCarbs(this.portions),this.entry.portionIds=this.portions.map(n=>n.id).filter(n=>null!=n),this.entry.date=(new Date).toISOString(),this.validate(this.entry)&&this.loadingService.addToQueue(this.foodLogService.saveItemToDB(this.entry).then(n=>{this.reset(),this.messageService.display("Entry saved!"),this.promptNavigation()}))}promptNavigation(){this.alertService.promptConfirmation("View entries","Would you like to view your new log on the entry log page?","no","yes").then(n=>{n&&this.router.navigateByUrl("/view-entries")})}validate(n){var e;let r=!0;return n.name?null==n.portionIds||(null===(e=n.portionIds)||void 0===e?void 0:e.length)<=0?(r=!1,this.alertService.simpleError("Entries cannot be created without portions","Entry invalid"),!1):r:(r=!1,this.alertService.simpleError("Entry must have a name","Entry invalid"),!1)}countCarbs(n){return n.reduce((e,r)=>e+(r.carbs||0),0)}promptInputModal(){let n=[{altType:"dropdown",options:{choices:["Breakfast","Lunch","Dinner","Morning Snack","Afternoon Snack","Other"]},value:this.getDefaultEntryName(),name:"entryName",label:"entry type",placeholder:"entry name eg. 'lunch'",attributes:{required:!0}},{name:"note",label:"note",placeholder:"note eg. 'small lunch'"}];this.modalService.presentInputModal(n,"Enter details","Add info for new entry").then(e=>{if(e.confirmed){let r=e.data.data,d=r.entryName,c=r.note;this.entry.name=null==d||""==d?null:d,this.entry.note=null==c||""==c?null:c,this.editTitle=null==this.entry.name,this.openCatalog()}})}promptInput(){this.alertService.promptInput("Enter details","Add info for new entry",[{name:"entryName",label:"entry name",placeholder:"entry name eg. 'lunch'",attributes:{required:!0,autofocus:!0}},{name:"note",placeholder:"note eg. 'small lunch'"}]).then(e=>{let r=e.entryName,d=e.note;this.entry.name=null==r||""==r?null:r,this.entry.note=null==d||""==d?null:d,this.editTitle=null==this.entry.name,this.openCatalog()})}getDefaultEntryName(){let n="";const e=(new Date).getHours();return n=e>=5&&e<10?"Breakfast":e>=12&&e<16?"Lunch":e>=18&&e<22?"Dinner":e>=10&&e<12?"Morning Snack":e>=16&&e<18?"Afternoon Snack":"Other",n}devAddTestEntries(){for(let n=0;n<150;n++){let e=m.E.getRandomDate(new Date("2024-02-19T01:57:45.271Z"),new Date("2024-05-26T01:57:45.271Z")),r=e.toISOString(),d=m.E.getRandomInt(1,40),c=m.E.getRandomInt(1,40),g={name:this.ordinalDatePipe.transform(e),date:r,portionIds:[d,c],carbs:m.E.getRandomInt(5,43)};this.loadingService.addToQueue(this.foodLogService.saveItemToDB(g).then(y=>{this.messageService.display(`Entry ${n} saved!`)}))}}}return(o=s).\u0275fac=function(n){return new(n||o)(t.rXU(A.H),t.rXU(T.i),t.rXU(S.U),t.rXU(R.b),t.rXU(I.u),t.rXU(P.B),t.rXU(p.Ix),t.rXU(p.nX),t.rXU(D.$),t.rXU(E.W))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-add-entry"]],features:[t.Jv_([E.W])],decls:35,vars:17,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],["mode","ios"],[3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","large",3,"name","click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","add any extra information","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","small",3,"name","click",4,"ngIf"],["class","portion-card",4,"ngFor","ngForOf"],["lines","none",3,"click"],["name","add","size","large","color","primary"],["slot","end"],["color","medium",3,"click"],["color","success","fill","outline",3,"click","strong"],[3,"click"],["fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","large",3,"click","name"],["fill","outline","type","text","placeholder","add any extra information","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","small",3,"click","name"],[1,"portion-card"],[1,"no-padding"],[3,"onPortionDeleted","portion","allowDBDeletion","allowEdit","adjustable"]],template:function(n,e){1&n&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title",2),t.EFF(5,"Add Entry"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header",4)(9,"ion-row"),t.DNE(10,M,2,1,"ion-card-title",5)(11,G,1,2,"ion-input",6)(12,j,1,1,"ion-icon",7),t.k0s()(),t.j41(13,"ion-card-content")(14,"ion-row"),t.DNE(15,b,2,1,"p",5)(16,F,1,2,"ion-input",8)(17,X,1,1,"ion-icon",9),t.k0s(),t.DNE(18,B,3,4,"ion-card",10),t.j41(19,"ion-item",11),t.bIt("click",function(){return e.openCatalog()}),t.nrm(20,"ion-icon",12),t.j41(21,"ion-label"),t.EFF(22,"Add portion "),t.k0s()()()()(),t.j41(23,"ion-footer")(24,"ion-toolbar")(25,"p")(26,"b"),t.EFF(27),t.nI1(28,"sumProperty"),t.nI1(29,"number"),t.k0s()(),t.j41(30,"ion-buttons",13)(31,"ion-button",14),t.bIt("click",function(){return e.cancel()}),t.EFF(32," Restart "),t.k0s(),t.j41(33,"ion-button",15),t.bIt("click",function(){return e.confirm()}),t.EFF(34,"Confirm"),t.k0s()()()()),2&n&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("ngIf",!e.editTitle),t.R7$(),t.Y8G("ngIf",e.editTitle),t.R7$(),t.Y8G("ngIf",e.entry.name),t.R7$(3),t.Y8G("ngIf",!e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngForOf",e.portions),t.R7$(9),t.SpI("",t.i5U(29,14,t.i5U(28,11,e.portions,"carbs"),"1.0-1"),"g Carbs"),t.R7$(6),t.Y8G("strong",!0))},dependencies:[u.Sq,u.bT,f.BC,f.vS,l.Jm,l.QW,l.b_,l.I9,l.ME,l.tN,l.W9,l.M0,l.eU,l.iq,l.$w,l.uz,l.he,l.MC,l.ln,l.BC,l.ai,l.Gw,C.x,u.QX,k]}),s})()}];let O=(()=>{var o;class s{}return(o=s).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[p.iI.forChild(x),p.iI]}),s})();var U=a(1815),V=a(4683);let Y=(()=>{var o;class s{}return(o=s).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[u.MD,f.YN,l.bv,O,U.U,V.Y]}),s})()}}]);