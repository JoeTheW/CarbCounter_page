"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6657],{6657:(W,f,l)=>{l.r(f),l.d(f,{ViewEntriesPageModule:()=>A});var g=l(177),m=l(4341),s=l(3819),h=l(9858),C=l(467),_=l(8581),p=l(4618),e=l(4438),b=l(7225),D=l(2038),E=l(4988),P=l(5293),w=l(8361);let j=(()=>{var n;class r{transform(o,i=0,a="down"){return("down"===a?Math.floor:Math.ceil)(o*10**i)/10**i}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=e.EJ8({name:"toFixed",type:n,pure:!0}),r})();function T(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-button",6),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.incrementPage(-1))}),e.nrm(1,"ion-icon",7),e.k0s()}}function F(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-button",6),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.incrementPage(1))}),e.nrm(1,"ion-icon",8),e.k0s()}}function I(n,r){if(1&n&&(e.j41(0,"ion-toolbar")(1,"ion-row",1)(2,"ion-col",2),e.DNE(3,T,2,0,"ion-button",3),e.k0s(),e.j41(4,"ion-col",4)(5,"p"),e.EFF(6),e.nI1(7,"toFixed"),e.k0s()(),e.j41(8,"ion-col",5),e.DNE(9,F,2,0,"ion-button",3),e.k0s()()()),2&n){let t;const o=e.XpG();e.R7$(3),e.Y8G("ngIf",o.pageable.page-1>0),e.R7$(3),e.Lme("page ",o.pageable.page," of ",e.brH(7,4,o.pageable.totalElements?o.pageable.totalElements/o.pageable.size:o.pageable.page,0,"up"),""),e.R7$(3),e.Y8G("ngIf",(null!==(t=o.pageable.totalElements)&&void 0!==t?t:o.pageable.size)>o.pageable.page*o.pageable.size)}}let k=(()=>{var n;class r{constructor(){this.pageableChange=new e.bkB,this.onPageChanged=new e.bkB}ngOnInit(){}incrementPage(o){this.pageable.page+=o,this.pageableChange.emit(this.pageable),this.onPageChanged.emit(this.pageable)}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-paging"]],inputs:{pageable:"pageable"},outputs:{pageableChange:"pageableChange",onPageChanged:"onPageChanged"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"flex","justify-content-between"],[1,"flex","justify-content-start"],["fill","clear",3,"click",4,"ngIf"],[1,"flex","justify-content-center"],[1,"flex","justify-content-end"],["fill","clear",3,"click"],["color","medium","slot","icon-only","name","chevron-back"],["color","medium","slot","icon-only","name","chevron-forward"]],template:function(o,i){1&o&&e.DNE(0,I,10,8,"ion-toolbar",0),2&o&&e.Y8G("ngIf",i.pageable)},dependencies:[g.bT,s.Jm,s.hU,s.iq,s.ln,s.ai,j]}),r})(),V=(()=>{var n;class r{transform(o,i){return 0===i?0:o/i}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=e.EJ8({name:"fractionOf",type:n,pure:!0}),r})(),S=(()=>{var n;class r{transform(o,i){return 0===i?0:Math.round(o/i*100)}}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275pipe=e.EJ8({name:"percentOf",type:n,pure:!0}),r})();const R=n=>({above:n});function O(n,r){if(1&n){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.changeMode())}),e.j41(1,"span",2)(2,"small"),e.EFF(3),e.k0s()(),e.nrm(4,"ion-progress-bar",3),e.nI1(5,"fractionOf"),e.nI1(6,"fractionOf"),e.j41(7,"div",4)(8,"p",5),e.EFF(9),e.nI1(10,"number"),e.k0s(),e.j41(11,"p",6),e.EFF(12),e.nI1(13,"number"),e.nI1(14,"percentOf"),e.k0s(),e.j41(15,"p",7),e.EFF(16),e.nI1(17,"number"),e.k0s()()()}if(2&n){const t=e.XpG();e.Y8G("ngClass",e.eq3(26,R,t.total>t.target)),e.R7$(3),e.JRh(t.title),e.R7$(),e.Y8G("value",t.total>t.target?e.i5U(5,8,t.target,t.total):e.i5U(6,11,t.total,t.target)),e.R7$(5),e.Lme("",t.total>t.target?"goal":"total "," ",e.i5U(10,14,t.total>t.target?t.target:t.total,"1.0-1"),"g"),e.R7$(3),e.JRh(t.total>t.target?e.i5U(13,17,t.total-t.target,"1.0-1")+"g exceeded":e.i5U(14,20,t.total,t.target)+"%"),e.R7$(4),e.Lme("",t.total>t.target?"total":"goal "," ",e.i5U(17,23,t.total>t.target?t.total:t.target,"1.0-1"),"g")}}let x=(()=>{var n;class r{constructor(o,i){this.foodLogService=o,this.loadingService=i,this.total=0,this.onTotalChange=new e.bkB}ngOnInit(){this.setup()}setup(){this.getCarbGoal()}getCarbGoal(){this.loadingService.addToQueue(this.foodLogService.getDailyCarbGoal().then(o=>{}))}changeMode(){}}return(n=r).\u0275fac=function(o){return new(o||n)(e.rXU(b.i),e.rXU(D.U))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-progress-display"]],inputs:{total:"total",target:"target",title:"title"},outputs:{onTotalChange:"onTotalChange"},decls:1,vars:1,consts:[["class","mx-2 carb-goal-progress",3,"ngClass","click",4,"ngIf"],[1,"mx-2","carb-goal-progress",3,"click","ngClass"],[1,"flex","justify-content-center"],[3,"value"],[1,"flex","justify-content-between","above"],[1,"my-1","carb-progress-value-text"],[1,"my-1"],[1,"my-1","carb-progress-target-text"]],template:function(o,i){1&o&&e.DNE(0,O,18,28,"div",0),2&o&&e.Y8G("ngIf",i.target)},dependencies:[g.YU,g.bT,s.FH,g.QX,V,S]}),r})();var G=l(7058);const v=()=>({weekday:"short",month:"long",day:"2-digit"}),y=n=>({date:n});function M(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-datetime",20),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.DH7(a.fromDateString,i)||(a.fromDateString=i),e.Njj(i)}),e.bIt("ionChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.fromDateChanged(i))}),e.j41(1,"span",21),e.EFF(2,"Select from date"),e.k0s()()}if(2&n){const t=e.XpG();e.R50("ngModel",t.fromDateString),e.Y8G("formatOptions",e.eq3(4,y,e.lJ4(3,v)))("showDefaultButtons",!0)}}function B(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-datetime",22),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.DH7(a.toDateString,i)||(a.toDateString=i),e.Njj(i)}),e.bIt("ionChange",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.toDateChanged(i))}),e.j41(1,"span",21),e.EFF(2,"Select from date"),e.k0s()()}if(2&n){const t=e.XpG();e.R50("ngModel",t.toDateString),e.Y8G("formatOptions",e.eq3(4,y,e.lJ4(3,v)))("showDefaultButtons",!0)}}function L(n,r){if(1&n&&(e.j41(0,"ion-row")(1,"ion-card-subtitle")(2,"strong"),e.EFF(3),e.k0s()()()),2&n){const t=e.XpG().$implicit;e.R7$(3),e.JRh(t.note)}}function $(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-row")(1,"ion-chip",36),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.portionAdjustmentInfo())}),e.j41(2,"ion-label"),e.EFF(3,"Portions adjusted"),e.k0s(),e.nrm(4,"ion-icon",37),e.k0s()()}}function N(n,r){if(1&n&&(e.j41(0,"ion-card",38)(1,"ion-card-content",39),e.nrm(2,"app-portion",40),e.k0s()()),2&n){const t=r.$implicit;e.R7$(2),e.Y8G("portionId",t)("allowDBDeletion",!1)("allowEdit",!1)}}function X(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-button",41),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG();return e.Njj(a.normaliseCarbs(i))}),e.EFF(1," mismatch "),e.nrm(2,"ion-icon",42),e.k0s()}}function U(n,r){if(1&n){const t=e.RV6();e.j41(0,"ion-card",23)(1,"ion-card-header",24),e.DNE(2,L,4,1,"ion-row",25),e.j41(3,"ion-row")(4,"ion-card-subtitle"),e.EFF(5),e.nI1(6,"ordinalDate"),e.k0s()(),e.j41(7,"ion-row")(8,"ion-card-title"),e.EFF(9),e.k0s()()(),e.j41(10,"ion-card-content")(11,"ion-row")(12,"h1"),e.EFF(13),e.nI1(14,"number"),e.k0s()(),e.DNE(15,$,5,0,"ion-row",25),e.j41(16,"ion-row")(17,"ion-accordion-group",26)(18,"ion-accordion",27)(19,"ion-item",28)(20,"ion-card-subtitle"),e.EFF(21),e.k0s()(),e.j41(22,"div",29),e.DNE(23,N,3,3,"ion-card",30),e.k0s()()()(),e.j41(24,"ion-row")(25,"ion-col",31)(26,"div",32)(27,"ion-button",33),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.deleteEntry(i))}),e.nrm(28,"ion-icon",34),e.k0s(),e.DNE(29,X,3,0,"ion-button",35),e.k0s()()()()()}if(2&n){const t=r.$implicit;e.R7$(2),e.Y8G("ngIf",t.note),e.R7$(3),e.JRh(e.bMT(6,9,t.date)),e.R7$(4),e.JRh(t.name),e.R7$(4),e.SpI("Carbs: ",e.i5U(14,11,t.carbs,"1.0-1"),"g"),e.R7$(2),e.Y8G("ngIf",t.carbs!=t.portionCarbs),e.R7$(6),e.Lme("",t.portionIds.length," portion",t.portionIds.length>1?"s":"",""),e.R7$(2),e.Y8G("ngForOf",t.portionIds),e.R7$(6),e.Y8G("ngIf",t.carbs!=t.portionCarbs)}}const Y=[{path:"",component:(()=>{var n;class r{constructor(o,i,a,c){this.foodLogService=o,this.loadingService=i,this.alertService=a,this.portionService=c,this.pageable={page:1,size:5},this.today=new Date,this.fromDate=new Date,this.toDate=new Date,this.progress={carbGoal:0,carbTotal:0,title:""}}ngOnInit(){this.setupDateRange(),this.setup()}setup(){this.loadFoodLogs()}setupDateRange(){this.today=new Date,this.fromDate=p.E.getStartOfDay(this.today),this.toDate=p.E.getEndOfDay(this.today)}loadFoodLogs(){var o=this;this.calculateCarbValues(),this.loadingService.addToQueue(this.foodLogService.getAllInRangeOrderedByIndexPaged(_.$I.FOOD_LOG_TBL_DATE,this.pageable,"desc",this.fromDate,this.toDate).then(i=>{this.foodLogs=i,this.foodLogs.forEach(a=>{a.portionCarbs=0,a.portionIds.forEach(function(){var c=(0,C.A)(function*(d){var u;let H=yield o.portionService.getByKey(d);a.portionCarbs=(null!==(u=a.portionCarbs)&&void 0!==u?u:0)+H.carbs});return function(d){return c.apply(this,arguments)}}())})}))}calculateCarbValues(){let o=this.toDate.getTime()-this.fromDate.getTime(),i=Math.round(o/864e5);this.loadingService.addToQueue(this.foodLogService.getDailyCarbGoal().then(a=>{this.progress.carbGoal=a*i,this.progress.title=`${i} day${1==i?"":"s"}`})),this.loadingService.addToQueue(this.foodLogService.getAllInRangeOrderedByIndexPaged(_.$I.FOOD_LOG_TBL_DATE,{page:0,size:999999999},"desc",this.fromDate,this.toDate).then(a=>{a||(this.progress.carbTotal=0),this.progress.carbTotal=a.reduce((c,d)=>c+(d.carbs||0),0)}))}pageChanged(o){this.loadFoodLogs()}deleteEntry(o){this.alertService.promptConfirmation("Confirm","are you sure you want to delete this entry?","no","yes").then(i=>{i&&this.loadingService.addToQueue(this.foodLogService.deleteEntityFromDB(o.id).then(()=>{this.pageChanged(this.pageable)}))})}normaliseCarbs(o){this.alertService.promptConfirmation("Normalise carbs?","The portions within this entry were adjusted or have since been updated - update the carb count of this entry to match portion values?","no","yes").then(i=>{i&&(o.carbs=o.portionCarbs,this.loadingService.addToQueue(this.foodLogService.saveItemToDB(o)),this.calculateCarbValues())})}fromDateChanged(o){let a=new Date(o.detail.value);if(a.getTime()>this.toDate.getTime())return this.alertService.simpleError("From date must be before to date."),void(this.fromDateString=this.toLocalISOString(this.fromDate));this.fromDate=a,this.fromDate=p.E.getStartOfDay(this.fromDate),this.loadFoodLogs()}toDateChanged(o){let a=new Date(o.detail.value);if(a.getTime()<this.fromDate.getTime())return this.alertService.simpleError("To date must be after from date."),void(this.toDateString=this.toLocalISOString(this.toDate));this.toDate=a,this.toDate=p.E.getEndOfDay(this.toDate),this.loadFoodLogs()}incrementRange(o){let i=this.toDate.getTime()-this.fromDate.getTime(),a=Math.round(i/864e5);this.fromDate=this.addDays(this.fromDate,a*o),this.toDate=this.addDays(this.toDate,a*o),this.fromDateString=this.toLocalISOString(this.fromDate),this.toDateString=this.toLocalISOString(this.toDate),this.loadFoodLogs()}addDays(o,i){const a=new Date(o);return a.setDate(a.getDate()+i),a}toLocalISOString(o){const i=6e4*o.getTimezoneOffset();return new Date(o.getTime()-i).toISOString().slice(0,-1)}portionAdjustmentInfo(){this.alertService.alert("Portions adjusted","","Portion sizes were adjusted when this entry was created, therefore the 'Carbs' value may not match the portions below.")}}return(n=r).\u0275fac=function(o){return new(o||n)(e.rXU(b.i),e.rXU(D.U),e.rXU(E.u),e.rXU(P.t))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-view-entries"]],decls:38,vars:9,consts:[[3,"translucent"],["slot","start"],["size","large"],[1,"flex","justify-content-between"],[1,"flex","justify-content-start","m-0"],["fill","clear",1,"default-chevrons",3,"click"],["color","medium","slot","icon-only","name","chevron-back"],[1,"flex","flex-row","justify-content-center"],[1,"date-picker"],["datetime","from-datetime"],["datetime","to-datetime"],[1,"flex","justify-content-end","m-0"],["color","medium","slot","icon-only","name","chevron-forward"],[1,"narrow-chevrons","m-0"],["fill","clear",1,"m-0",3,"click"],[3,"keepContentsMounted"],[3,"fullscreen"],["class","no-padding-card",4,"ngFor","ngForOf"],[3,"total","target","title"],[3,"pageableChange","onPageChanged","pageable"],["id","from-datetime","presentation","date",3,"ngModelChange","ionChange","ngModel","formatOptions","showDefaultButtons"],["slot","title"],["id","to-datetime","presentation","date",3,"ngModelChange","ionChange","ngModel","formatOptions","showDefaultButtons"],[1,"no-padding-card"],["mode","ios"],[4,"ngIf"],[1,"w-full"],["value","first"],["slot","header"],["slot","content"],["class","portion-card",4,"ngFor","ngForOf"],[1,"flex","justify-content-start"],[1,"flex","align-items-start"],["item-start","","fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["item-start","","fill","clear","color","warning",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","help-circle"],[1,"portion-card"],[1,"no-padding"],[3,"portionId","allowDBDeletion","allowEdit"],["item-start","","fill","clear","color","warning",3,"click"],["slot","icon-only","name","refresh"]],template:function(o,i){1&o&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title",2),e.EFF(5,"Entries"),e.k0s()(),e.j41(6,"ion-toolbar")(7,"ion-row",3)(8,"ion-col",4)(9,"ion-button",5),e.bIt("click",function(){return i.incrementRange(-1)}),e.nrm(10,"ion-icon",6),e.k0s()(),e.j41(11,"div",7)(12,"div",8)(13,"ion-label"),e.EFF(14,"From Date"),e.k0s(),e.nrm(15,"ion-datetime-button",9),e.k0s(),e.j41(16,"div",8)(17,"ion-label"),e.EFF(18,"To Date"),e.k0s(),e.nrm(19,"ion-datetime-button",10),e.k0s()(),e.j41(20,"ion-col",11)(21,"ion-button",5),e.bIt("click",function(){return i.incrementRange(1)}),e.nrm(22,"ion-icon",12),e.k0s()()(),e.j41(23,"div",13)(24,"ion-button",14),e.bIt("click",function(){return i.incrementRange(-1)}),e.nrm(25,"ion-icon",6),e.k0s(),e.j41(26,"ion-button",14),e.bIt("click",function(){return i.incrementRange(1)}),e.nrm(27,"ion-icon",12),e.k0s()()()(),e.j41(28,"ion-modal",15),e.DNE(29,M,3,6,"ng-template"),e.k0s(),e.j41(30,"ion-modal",15),e.DNE(31,B,3,6,"ng-template"),e.k0s(),e.j41(32,"ion-content",16),e.DNE(33,U,30,14,"ion-card",17),e.k0s(),e.j41(34,"ion-footer")(35,"ion-toolbar"),e.nrm(36,"app-progress-display",18),e.j41(37,"app-paging",19),e.mxI("pageableChange",function(c){return e.DH7(i.pageable,c)||(i.pageable=c),c}),e.bIt("onPageChanged",function(c){return i.pageChanged(c)}),e.k0s()()()),2&o&&(e.Y8G("translucent",!0),e.R7$(28),e.Y8G("keepContentsMounted",!0),e.R7$(2),e.Y8G("keepContentsMounted",!0),e.R7$(2),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngForOf",i.foodLogs),e.R7$(3),e.Y8G("total",i.progress.carbTotal)("target",i.progress.carbGoal)("title",i.progress.title),e.R7$(),e.R50("pageable",i.pageable))},dependencies:[g.Sq,g.bT,m.BC,m.vS,s.xk,s.YH,s.Jm,s.QW,s.b_,s.I9,s.ME,s.HW,s.tN,s.ZB,s.hU,s.W9,s.A9,s.K4,s.M0,s.eU,s.iq,s.uz,s.he,s.MC,s.ln,s.BC,s.ai,s.Sb,s.Je,w.x,k,x,g.QX,G.W],styles:[".default-chevrons[_ngcontent-%COMP%]{display:flex!important}.narrow-chevrons[_ngcontent-%COMP%]{display:none;justify-content:center;margin-top:10px}@media (max-width: 350px){.default-chevrons[_ngcontent-%COMP%]{display:none!important}.narrow-chevrons[_ngcontent-%COMP%]{display:flex}}"]}),r})()}];let J=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.iI.forChild(Y),h.iI]}),r})();var z=l(1815),Q=l(4683);let A=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.MD,m.YN,s.bv,J,z.U,Q.Y]}),r})()}}]);