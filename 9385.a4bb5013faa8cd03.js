"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9385],{9385:(T,v,a)=>{a.d(v,{x:()=>x});var t=a(4438),C=a(2038),I=a(5293),b=a(4569),E=a(4988),p=a(4075),M=a(529),u=a(177),d=a(4341),r=a(3819),c=a(9601);function _(n,f){if(1&n&&(t.j41(0,"h1"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(e.portionModel.name)}}function l(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-input",15),t.mxI("ngModelChange",function(o){t.eBV(e);const m=t.XpG(2);return t.DH7(m.portionModel.name,o)||(m.portionModel.name=o),t.Njj(o)}),t.bIt("ionInput",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.markModelChanged())}),t.k0s()}if(2&n){const e=t.XpG(2);t.R50("ngModel",e.portionModel.name)}}function s(n,f){if(1&n&&(t.j41(0,"h2"),t.EFF(1),t.k0s()),2&n){let e;const i=t.XpG(2);t.R7$(),t.JRh(null!==(e=i.portionModel.note)&&void 0!==e?e:"-")}}function g(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-input",16),t.mxI("ngModelChange",function(o){t.eBV(e);const m=t.XpG(2);return t.DH7(m.portionModel.note,o)||(m.portionModel.note=o),t.Njj(o)}),t.bIt("ionInput",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.markModelChanged())}),t.k0s()}if(2&n){const e=t.XpG(2);t.R50("ngModel",e.portionModel.note)}}function h(n,f){if(1&n&&(t.j41(0,"h2"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI("",e.portionModel.carbs,"g")}}function D(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-button",17),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.adjustCarbs(-5))}),t.nrm(1,"ion-icon",18),t.k0s()}}function P(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-input",19),t.mxI("ngModelChange",function(o){t.eBV(e);const m=t.XpG(2);return t.DH7(m.portionModel.carbs,o)||(m.portionModel.carbs=o),t.Njj(o)}),t.bIt("ionInput",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.markModelChanged())}),t.k0s()}if(2&n){const e=t.XpG(2);t.R50("ngModel",e.portionModel.carbs)}}function j(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-button",20),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.adjustCarbs(5))}),t.nrm(1,"ion-icon",21),t.k0s()}}function R(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-button",22),t.bIt("click",function(){t.eBV(e);const o=t.XpG(2);return t.Njj(o.selectPortion())}),t.EFF(1," Select "),t.k0s()}}function O(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-button",26),t.bIt("click",function(){t.eBV(e);const o=t.XpG(3);return t.Njj(o.changeEditMode())}),t.nrm(1,"ion-icon",27),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("disabled",e.editMode&&!e.portionModel.name),t.R7$(),t.Y8G("name",e.editMode?"save":"pencil")}}function S(n,f){if(1&n&&(t.j41(0,"ion-col",23)(1,"div",24),t.DNE(2,O,2,2,"ion-button",25),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("ngIf",e.portionModel.id)}}function B(n,f){if(1&n){const e=t.RV6();t.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",1)(3,"app-catalog-item",2),t.bIt("onItemClicked",function(o){t.eBV(e);const m=t.XpG();return t.Njj(m.onImageClicked(o))}),t.k0s()(),t.j41(4,"ion-col")(5,"p"),t.EFF(6),t.k0s(),t.j41(7,"ion-row"),t.DNE(8,_,2,1,"h1",0)(9,l,1,1,"ion-input",3),t.k0s(),t.j41(10,"ion-row"),t.DNE(11,s,2,1,"h2",0)(12,g,1,1,"ion-input",4),t.k0s(),t.j41(13,"ion-row",5),t.DNE(14,h,2,1,"h2",0),t.j41(15,"ion-col",1),t.DNE(16,D,2,0,"ion-button",6),t.k0s(),t.j41(17,"ion-col"),t.DNE(18,P,1,1,"ion-input",7),t.k0s(),t.j41(19,"ion-col",1),t.DNE(20,j,2,0,"ion-button",8),t.k0s()()()(),t.j41(21,"ion-row")(22,"ion-col",9)(23,"div",10)(24,"ion-button",11),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.deletePortion())}),t.nrm(25,"ion-icon",12),t.k0s()()(),t.DNE(26,R,2,0,"ion-button",13)(27,S,3,1,"ion-col",14),t.k0s()()}if(2&n){const e=t.XpG();t.R7$(3),t.Y8G("item",e.tempItem)("clickable",e.editMode)("showTitle",!1)("showIcons",!1)("animate",!1)("overlayIcon",e.editMode?"camera":"")("reloadEmitter",e.onImageChanged),t.R7$(3),t.JRh(e.catalogItemName),t.R7$(2),t.Y8G("ngIf",!e.editMode),t.R7$(),t.Y8G("ngIf",e.editMode),t.R7$(2),t.Y8G("ngIf",!e.editMode),t.R7$(),t.Y8G("ngIf",e.editMode),t.R7$(2),t.Y8G("ngIf",!e.editMode),t.R7$(2),t.Y8G("ngIf",e.editMode),t.R7$(2),t.Y8G("ngIf",e.editMode),t.R7$(2),t.Y8G("ngIf",e.editMode),t.R7$(6),t.Y8G("ngIf",e.canSelectPortions&&e.portion.id&&!e.editMode),t.R7$(),t.Y8G("ngIf",e.allowEdit)}}let x=(()=>{var n;class f{constructor(i,o,m,y,k,G){this.loadingService=i,this.portionService=o,this.catalogService=m,this.alertService=y,this.imageService=k,this.messageService=G,this.allowDBDeletion=!1,this.allowEdit=!1,this.canSelectPortions=!1,this.onPortionDeleted=new t.bkB,this.onPortionSelected=new t.bkB,this.onImageChanged=new t.bkB,this.editMode=!1,this.modelChanged=!1,this.tempItem={name:"temp"}}ngOnInit(){!this.portion&&this.portionId?this.loadingService.addToQueue(this.portionService.getByKey(this.portionId).then(i=>{i?(this.portion=i,this.setup()):this.missingPortionData(this.portionId)})):this.setup()}missingPortionData(i){this.portion={name:"deleted",catalogItemId:-1,carbs:0,note:"portion deleted"},this.portionModel={...this.portion}}setup(){this.portionModel=this.cloneItem(this.portion),this.tempItem.imageId=this.portion.imageId,""===this.portionModel.name?(this.editMode=!0,this.getCatalogItemName().then(i=>{this.catalogItemName=i,this.portionModel.name=i})):this.getCatalogItemName().then(i=>this.catalogItemName=i)}getCatalogItemName(){return this.catalogService.getPropertyByKey(this.portion.catalogItemId,"name")}cloneItem(i){return{...i}}markModelChanged(){this.modelChanged=!0}changeEditMode(){this.editMode&&this.savePortion(),this.editMode=!this.editMode}savePortion(){return new Promise(i=>{this.portion=this.cloneItem(this.portionModel),this.loadingService.addToQueue(this.portionService.saveItemToDB(this.portion).then(o=>(this.portion=o,i())))})}adjustCarbs(i){var o;let m=null!==(o=this.portionModel.carbs)&&void 0!==o?o:0;m+=i,m=Math.max(m,0),this.portionModel.carbs=m}deletePortion(){this.allowDBDeletion?this.alertService.promptConfirmation("Confirm","are you sure you want to delete this portion?","no","yes").then(i=>{i&&this.loadingService.addToQueue(this.portionService.deleteEntityFromDB(this.portion.id).then(()=>{this.onPortionDeleted.emit(this.portion)}))}):this.onPortionDeleted.emit(this.portion)}selectPortion(){this.onPortionSelected.emit(this.portion)}onImageClicked(i){this.imageService.userCreateImage().then(o=>{var m;o?(this.portionModel.imageId=null!==(m=o.id)&&void 0!==m?m:0,this.savePortion().then(()=>{this.tempItem.imageId=this.portionModel.imageId,this.onImageChanged.emit()})):this.messageService.display("Photo upload cancelled.")})}}return(n=f).\u0275fac=function(i){return new(i||n)(t.rXU(C.U),t.rXU(I.t),t.rXU(b.H),t.rXU(E.u),t.rXU(p.f),t.rXU(M.b))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-portion"]],inputs:{portion:"portion",portionId:"portionId",listPosition:"listPosition",allowDBDeletion:"allowDBDeletion",allowEdit:"allowEdit",canSelectPortions:"canSelectPortions"},outputs:{onPortionDeleted:"onPortionDeleted",onPortionSelected:"onPortionSelected",onImageChanged:"onImageChanged"},decls:1,vars:1,consts:[[4,"ngIf"],["size","auto"],[3,"onItemClicked","item","clickable","showTitle","showIcons","animate","overlayIcon","reloadEmitter"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter name",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter note",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],[1,"flex","flex-row","align-items-center","gap-2"],["shape","round","color","danger","fill","clear",3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","number","placeholder","enter carbs",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["shape","round","color","success","fill","clear",3,"click",4,"ngIf"],[1,"flex","justify-content-start"],[1,"flex","align-items-start"],["item-start","","fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["size","small","shape","round","color","warning","fill","outline",3,"click",4,"ngIf"],["class","flex justify-content-end",4,"ngIf"],["fill","outline","type","text","placeholder","enter name",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["fill","outline","type","text","placeholder","enter note",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","danger","fill","clear",3,"click"],["slot","icon-only","name","remove","size","small"],["fill","outline","type","number","placeholder","enter carbs",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","success","fill","clear",3,"click"],["slot","icon-only","name","add","size","small"],["size","small","shape","round","color","warning","fill","outline",3,"click"],[1,"flex","justify-content-end"],[1,"flex","align-items-end"],["item-end","","fill","clear","color","medium",3,"disabled","click",4,"ngIf"],["item-end","","fill","clear","color","medium",3,"click","disabled"],["slot","icon-only",3,"name"]],template:function(i,o){1&i&&t.DNE(0,B,28,18,"ion-grid",0),2&i&&t.Y8G("ngIf",o.portionModel)},dependencies:[u.bT,d.BC,d.vS,r.Jm,r.hU,r.lO,r.iq,r.$w,r.ln,r.su,r.Gw,c.I]}),f})()},8385:(T,v,a)=>{a.d(v,{g:()=>E});var t=a(4438),C=a(3819);function I(p,M){if(1&p&&(t.j41(0,"p")(1,"b"),t.EFF(2),t.k0s()()),2&p){const u=t.XpG();t.R7$(2),t.SpI("",u.selectedItems.length," items selected")}}function b(p,M){if(1&p&&(t.j41(0,"p")(1,"b"),t.EFF(2),t.k0s()()),2&p){const u=t.XpG();t.R7$(2),t.SpI("",u.selectedPortions.length," portions selected")}}let E=(()=>{var p;class M{constructor(d){this.modalController=d,this.title="Catalog",this.canAddItems=!1,this.canSelectItems=!1,this.canSelectPortions=!1,this.returnData={},this.selectedItems=[],this.selectedPortions=[]}ngOnInit(){}dismiss(){return this.modalController.dismiss(this.constructReturnData("dismiss"))}confirm(){return this.modalController.dismiss(this.constructReturnData("confirmSelection"))}itemSelected(d){-1==this.selectedItems.indexOf(d)&&this.selectedItems.push(d)}portionSelected(d){-1==this.selectedPortions.indexOf(d)&&this.selectedPortions.push(d)}constructReturnData(d){let r={...this.returnData};return r.returnedItems=this.selectedItems,r.returnedPortions=this.selectedPortions,r}}return(p=M).\u0275fac=function(d){return new(d||p)(t.rXU(C.W3))},p.\u0275cmp=t.VBU({type:p,selectors:[["app-food-catalog-modal"]],decls:23,vars:9,consts:[["catalog",""],["slot","end"],["color","medium",3,"click"],["name","close"],[3,"translucent"],["headerMode","none",3,"segmentChanged"],[3,"fullscreen"],[3,"onItemSelected","onPortionSelected","onSelectionComplete","canAddItems","canSelectPortions","canSelectItems"],[3,"searchTermChanged"],[4,"ngIf"],["color","success","fill","outline",3,"click","strong"]],template:function(d,r){if(1&d){const c=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",1)(5,"ion-button",2),t.bIt("click",function(){return t.eBV(c),t.Njj(r.dismiss())}),t.nrm(6,"ion-icon",3),t.k0s()()()(),t.j41(7,"ion-header",4)(8,"app-food-catalog-header",5),t.bIt("segmentChanged",function(l){t.eBV(c);const s=t.sdS(11);return t.Njj(s.handleSegmentChanged(l))}),t.k0s()(),t.j41(9,"ion-content",6)(10,"app-food-catalog",7,0),t.bIt("onItemSelected",function(l){return t.eBV(c),t.Njj(r.itemSelected(l))})("onPortionSelected",function(l){return t.eBV(c),t.Njj(r.portionSelected(l))})("onSelectionComplete",function(){return t.eBV(c),t.Njj(r.confirm())}),t.k0s()(),t.j41(12,"ion-footer")(13,"app-food-catalog-footer",8),t.bIt("searchTermChanged",function(l){t.eBV(c);const s=t.sdS(11);return t.Njj(s.handleSearchTermChanged(l))}),t.k0s()(),t.j41(14,"ion-footer")(15,"ion-toolbar"),t.DNE(16,I,3,1,"p",9)(17,b,3,1,"p",9),t.j41(18,"ion-buttons",1)(19,"ion-button",2),t.bIt("click",function(){return t.eBV(c),t.Njj(r.dismiss())}),t.EFF(20," Cancel "),t.k0s(),t.j41(21,"ion-button",10),t.bIt("click",function(){return t.eBV(c),t.Njj(r.confirm())}),t.EFF(22,"Confirm"),t.k0s()()()()}2&d&&(t.R7$(3),t.JRh(r.title),t.R7$(4),t.Y8G("translucent",!0),t.R7$(2),t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("canAddItems",r.canAddItems)("canSelectPortions",r.canSelectPortions)("canSelectItems",r.canSelectItems),t.R7$(6),t.Y8G("ngIf",r.canSelectItems),t.R7$(),t.Y8G("ngIf",r.canSelectPortions),t.R7$(4),t.Y8G("strong",!0))}}),M})()},4569:(T,v,a)=>{a.d(v,{H:()=>d});var t=a(467),C=a(8581),I=a(9195),b=a(9275),E=a(8385),p=a(4438),M=a(3819),u=a(2038);let d=(()=>{var r;class c extends b.y{constructor(l,s,g){super(s,g),this.modalController=l,this.databaseService=s,this.loadingService=g}deleteDefaultData(){var l=this;let s=I.g.catalogItems;return new Promise(g=>{let h=0;s.forEach(function(){var D=(0,t.A)(function*(P){if(yield l.deleteEntityFromDB(P.id),h++,h>=s.length)return g()});return function(P){return D.apply(this,arguments)}}())})}setupTableData(){this.tableName=C.jj.CATALOG_ITEM}setupDefaultData(l){var s=this;return(0,t.A)(function*(){let g;s.databaseService.getDatabase().then(h=>(g=h,g.count(C.jj.CATALOG_ITEM))).then(h=>{h<=0||l?I.g.catalogItems.forEach(function(){var D=(0,t.A)(function*(P){yield s.createEntityInDB(g,P),I.g.catalogItems.indexOf(P)>=I.g.catalogItems.length-1&&(s.reserveDatabaseEntries(),s.dataReady.next(!0))});return function(P){return D.apply(this,arguments)}}()):(s.reserveDatabaseEntries(),s.dataReady.next(!0))})})()}openFoodCatalog(l){this.modalController.create({component:E.g,showBackdrop:!0,backdropDismiss:!1,canDismiss:(s,g)=>new Promise(h=>{l.callback&&l.callback(s),this.handleModalClosed(s),h(!0)}),componentProps:{title:l.title,canSelectItems:l.canSelectItems,canSelectPortions:l.canSelectPortions,canAddItems:l.canAddItems}}).then(s=>{s.present()})}handleModalClosed(l){}}return(r=c).\u0275fac=function(l){return new(l||r)(p.KVO(M.W3),p.KVO(C.BP),p.KVO(u.U))},r.\u0275prov=p.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),c})()},5293:(T,v,a)=>{a.d(v,{t:()=>M});var t=a(467),C=a(8581),I=a(9195),b=a(9275),E=a(4438),p=a(2038);let M=(()=>{var u;class d extends b.y{constructor(c,_){super(c,_),this.databaseService=c,this.loadingService=_}deleteDefaultData(){var c=this;let _=I.g.portions;return new Promise(l=>{let s=0;_.forEach(function(){var g=(0,t.A)(function*(h){if(yield c.deleteEntityFromDB(h.id),s++,s>=_.length)return l()});return function(h){return g.apply(this,arguments)}}())})}setupTableData(){this.tableName=C.jj.PORTION}setupDefaultData(c){var _=this;return(0,t.A)(function*(){var l;let s,g=null!==(l=_.tableName)&&void 0!==l?l:"ERROR",h=I.g.portions;_.databaseService.getDatabase().then(D=>(s=D,s.count(g))).then(D=>{D<=0||c?h.forEach(function(){var P=(0,t.A)(function*(j){yield _.createEntityInDB(s,j),h.indexOf(j)>=h.length-1&&(_.reserveDatabaseEntries(),_.dataReady.next(!0))});return function(j){return P.apply(this,arguments)}}()):(_.reserveDatabaseEntries(),_.dataReady.next(!0))})})()}}return(u=d).\u0275fac=function(c){return new(c||u)(E.KVO(C.BP),E.KVO(p.U))},u.\u0275prov=E.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),d})()}}]);