"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9385],{9385:(y,j,r)=>{r.d(j,{x:()=>B});var e=r(4438),v=r(2038),E=r(5293),R=r(4569),b=r(4988),u=r(4075),D=r(529),C=r(177),f=r(4341),_=r(3819),g=r(9601);function d(o,h){if(1&o&&(e.j41(0,"h1"),e.EFF(1),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.JRh(t.portionModel.name)}}function m(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-input",15),e.mxI("ngModelChange",function(n){e.eBV(t);const p=e.XpG(2);return e.DH7(p.portionModel.name,n)||(p.portionModel.name=n),e.Njj(n)}),e.bIt("ionInput",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.markModelChanged())}),e.k0s()}if(2&o){const t=e.XpG(2);e.R50("ngModel",t.portionModel.name)}}function M(o,h){if(1&o&&(e.j41(0,"h2"),e.EFF(1),e.k0s()),2&o){let t;const i=e.XpG(2);e.R7$(),e.JRh(null!==(t=i.portionModel.note)&&void 0!==t?t:"-")}}function O(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-input",16),e.mxI("ngModelChange",function(n){e.eBV(t);const p=e.XpG(2);return e.DH7(p.portionModel.note,n)||(p.portionModel.note=n),e.Njj(n)}),e.bIt("ionInput",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.markModelChanged())}),e.k0s()}if(2&o){const t=e.XpG(2);e.R50("ngModel",t.portionModel.note)}}function a(o,h){if(1&o&&(e.j41(0,"h2"),e.EFF(1),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI("",t.portionModel.carbs,"g")}}function l(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-button",17),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.adjustCarbs(-5))}),e.nrm(1,"ion-icon",18),e.k0s()}}function s(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-input",19),e.mxI("ngModelChange",function(n){e.eBV(t);const p=e.XpG(2);return e.DH7(p.portionModel.carbs,n)||(p.portionModel.carbs=n),e.Njj(n)}),e.bIt("ionInput",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.markModelChanged())}),e.k0s()}if(2&o){const t=e.XpG(2);e.R50("ngModel",t.portionModel.carbs)}}function c(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-button",20),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.adjustCarbs(5))}),e.nrm(1,"ion-icon",21),e.k0s()}}function P(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-button",22),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.selectPortion())}),e.EFF(1," Select "),e.k0s()}}function I(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-button",26),e.bIt("click",function(){e.eBV(t);const n=e.XpG(3);return e.Njj(n.changeEditMode())}),e.nrm(1,"ion-icon",27),e.k0s()}if(2&o){const t=e.XpG(3);e.Y8G("disabled",t.editMode&&!t.portionModel.name),e.R7$(),e.Y8G("name",t.editMode?"save":"pencil")}}function S(o,h){if(1&o&&(e.j41(0,"ion-col",23)(1,"div",24),e.DNE(2,I,2,2,"ion-button",25),e.k0s()()),2&o){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.portionModel.id)}}function T(o,h){if(1&o){const t=e.RV6();e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",1)(3,"app-catalog-item",2),e.bIt("onItemClicked",function(n){e.eBV(t);const p=e.XpG();return e.Njj(p.onImageClicked(n))}),e.k0s()(),e.j41(4,"ion-col")(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"ion-row"),e.DNE(8,d,2,1,"h1",0)(9,m,1,1,"ion-input",3),e.k0s(),e.j41(10,"ion-row"),e.DNE(11,M,2,1,"h2",0)(12,O,1,1,"ion-input",4),e.k0s(),e.j41(13,"ion-row",5),e.DNE(14,a,2,1,"h2",0),e.j41(15,"ion-col",1),e.DNE(16,l,2,0,"ion-button",6),e.k0s(),e.j41(17,"ion-col"),e.DNE(18,s,1,1,"ion-input",7),e.k0s(),e.j41(19,"ion-col",1),e.DNE(20,c,2,0,"ion-button",8),e.k0s()()()(),e.j41(21,"ion-row")(22,"ion-col",9)(23,"div",10)(24,"ion-button",11),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.deletePortion())}),e.nrm(25,"ion-icon",12),e.k0s()()(),e.DNE(26,P,2,0,"ion-button",13)(27,S,3,1,"ion-col",14),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(3),e.Y8G("item",t.tempItem)("clickable",t.editMode)("showTitle",!1)("showIcons",!1)("animate",!1)("overlayIcon",t.editMode?"camera":"")("reloadEmitter",t.onImageChanged),e.R7$(3),e.JRh(t.catalogItemName),e.R7$(2),e.Y8G("ngIf",!t.editMode),e.R7$(),e.Y8G("ngIf",t.editMode),e.R7$(2),e.Y8G("ngIf",!t.editMode),e.R7$(),e.Y8G("ngIf",t.editMode),e.R7$(2),e.Y8G("ngIf",!t.editMode),e.R7$(2),e.Y8G("ngIf",t.editMode),e.R7$(2),e.Y8G("ngIf",t.editMode),e.R7$(2),e.Y8G("ngIf",t.editMode),e.R7$(6),e.Y8G("ngIf",t.canSelectPortions&&t.portion.id&&!t.editMode),e.R7$(),e.Y8G("ngIf",t.allowEdit)}}let B=(()=>{var o;class h{constructor(i,n,p,x,k,A){this.loadingService=i,this.portionService=n,this.catalogService=p,this.alertService=x,this.imageService=k,this.messageService=A,this.allowDBDeletion=!1,this.allowEdit=!1,this.canSelectPortions=!1,this.onPortionDeleted=new e.bkB,this.onPortionSelected=new e.bkB,this.onImageChanged=new e.bkB,this.editMode=!1,this.modelChanged=!1,this.tempItem={name:"temp"}}ngOnInit(){!this.portion&&this.portionId?this.loadingService.addToQueue(this.portionService.getByKey(this.portionId).then(i=>{i?(this.portion=i,this.setup()):this.missingPortionData(this.portionId)})):this.setup()}missingPortionData(i){this.portion={name:"deleted",catalogItemId:-1,carbs:0,note:"portion deleted"},this.portionModel={...this.portion}}setup(){this.portionModel=this.cloneItem(this.portion),this.tempItem.imageId=this.portion.imageId,""===this.portionModel.name?(this.editMode=!0,this.getCatalogItemName().then(i=>{this.catalogItemName=i,this.portionModel.name=i})):this.getCatalogItemName().then(i=>this.catalogItemName=i)}getCatalogItemName(){return this.catalogService.getPropertyByKey(this.portion.catalogItemId,"name")}cloneItem(i){return{...i}}markModelChanged(){this.modelChanged=!0}changeEditMode(){this.editMode&&this.savePortion(),this.editMode=!this.editMode}savePortion(){return new Promise(i=>{this.portion=this.cloneItem(this.portionModel),this.loadingService.addToQueue(this.portionService.saveItemToDB(this.portion).then(n=>(this.portion=n,i())))})}adjustCarbs(i){var n;let p=null!==(n=this.portionModel.carbs)&&void 0!==n?n:0;p+=i,p=Math.max(p,0),this.portionModel.carbs=p}deletePortion(){this.allowDBDeletion?this.alertService.promptConfirmation("Confirm","are you sure you want to delete this portion?","no","yes").then(i=>{i&&this.loadingService.addToQueue(this.portionService.deleteEntityFromDB(this.portion.id).then(()=>{this.onPortionDeleted.emit(this.portion)}))}):this.onPortionDeleted.emit(this.portion)}selectPortion(){this.onPortionSelected.emit(this.portion)}onImageClicked(i){this.imageService.userCreateImage().then(n=>{var p;n?(this.portionModel.imageId=null!==(p=n.id)&&void 0!==p?p:0,this.savePortion().then(()=>{this.tempItem.imageId=this.portionModel.imageId,this.onImageChanged.emit()})):this.messageService.display("Photo upload cancelled.")})}}return(o=h).\u0275fac=function(i){return new(i||o)(e.rXU(v.U),e.rXU(E.t),e.rXU(R.H),e.rXU(b.u),e.rXU(u.f),e.rXU(D.b))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-portion"]],inputs:{portion:"portion",portionId:"portionId",listPosition:"listPosition",allowDBDeletion:"allowDBDeletion",allowEdit:"allowEdit",canSelectPortions:"canSelectPortions"},outputs:{onPortionDeleted:"onPortionDeleted",onPortionSelected:"onPortionSelected",onImageChanged:"onImageChanged"},decls:1,vars:1,consts:[[4,"ngIf"],["size","auto"],[3,"onItemClicked","item","clickable","showTitle","showIcons","animate","overlayIcon","reloadEmitter"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter name",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter note",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],[1,"flex","flex-row","align-items-center","gap-2"],["shape","round","color","danger","fill","clear",3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","number","placeholder","enter carbs",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["shape","round","color","success","fill","clear",3,"click",4,"ngIf"],[1,"flex","justify-content-start"],[1,"flex","align-items-start"],["item-start","","fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["size","small","shape","round","color","warning","fill","outline",3,"click",4,"ngIf"],["class","flex justify-content-end",4,"ngIf"],["fill","outline","type","text","placeholder","enter name",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["fill","outline","type","text","placeholder","enter note",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","danger","fill","clear",3,"click"],["slot","icon-only","name","remove","size","small"],["fill","outline","type","number","placeholder","enter carbs",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","success","fill","clear",3,"click"],["slot","icon-only","name","add","size","small"],["size","small","shape","round","color","warning","fill","outline",3,"click"],[1,"flex","justify-content-end"],[1,"flex","align-items-end"],["item-end","","fill","clear","color","medium",3,"disabled","click",4,"ngIf"],["item-end","","fill","clear","color","medium",3,"click","disabled"],["slot","icon-only",3,"name"]],template:function(i,n){1&i&&e.DNE(0,T,28,18,"ion-grid",0),2&i&&e.Y8G("ngIf",n.portionModel)},dependencies:[C.bT,f.BC,f.vS,_.Jm,_.hU,_.lO,_.iq,_.$w,_.ln,_.su,_.Gw,g.I]}),h})()},8385:(y,j,r)=>{r.d(j,{g:()=>b});var e=r(4438),v=r(3819);function E(u,D){if(1&u&&(e.j41(0,"p")(1,"b"),e.EFF(2),e.k0s()()),2&u){const C=e.XpG();e.R7$(2),e.SpI("",C.selectedItems.length," items selected")}}function R(u,D){if(1&u&&(e.j41(0,"p")(1,"b"),e.EFF(2),e.k0s()()),2&u){const C=e.XpG();e.R7$(2),e.SpI("",C.selectedPortions.length," portions selected")}}let b=(()=>{var u;class D{constructor(f){this.modalController=f,this.title="Catalog",this.canAddItems=!1,this.canSelectItems=!1,this.canSelectPortions=!1,this.returnData={},this.selectedItems=[],this.selectedPortions=[]}ngOnInit(){}dismiss(){return this.modalController.dismiss(this.constructReturnData("dismiss"))}confirm(){return this.modalController.dismiss(this.constructReturnData("confirmSelection"))}itemSelected(f){-1==this.selectedItems.indexOf(f)&&this.selectedItems.push(f)}portionSelected(f){-1==this.selectedPortions.indexOf(f)&&this.selectedPortions.push(f)}constructReturnData(f){let _={...this.returnData};return _.returnedItems=this.selectedItems,_.returnedPortions=this.selectedPortions,_}}return(u=D).\u0275fac=function(f){return new(f||u)(e.rXU(v.W3))},u.\u0275cmp=e.VBU({type:u,selectors:[["app-food-catalog-modal"]],decls:24,vars:9,consts:[["catalogheader",""],["catalog",""],["slot","end"],["color","medium",3,"click"],["name","close"],[3,"translucent"],["headerMode","none",3,"segmentChanged"],[3,"fullscreen"],[3,"onItemSelected","onPortionSelected","onSelectionComplete","segmentChanged","canAddItems","canSelectPortions","canSelectItems"],[3,"searchTermChanged"],[4,"ngIf"],["color","success","fill","outline",3,"click","strong"]],template:function(f,_){if(1&f){const g=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s(),e.j41(4,"ion-buttons",2)(5,"ion-button",3),e.bIt("click",function(){return e.eBV(g),e.Njj(_.dismiss())}),e.nrm(6,"ion-icon",4),e.k0s()()()(),e.j41(7,"ion-header",5)(8,"app-food-catalog-header",6,0),e.bIt("segmentChanged",function(m){e.eBV(g);const M=e.sdS(12);return e.Njj(M.handleSegmentChanged(m))}),e.k0s()(),e.j41(10,"ion-content",7)(11,"app-food-catalog",8,1),e.bIt("onItemSelected",function(m){return e.eBV(g),e.Njj(_.itemSelected(m))})("onPortionSelected",function(m){return e.eBV(g),e.Njj(_.portionSelected(m))})("onSelectionComplete",function(){return e.eBV(g),e.Njj(_.confirm())})("segmentChanged",function(m){e.eBV(g);const M=e.sdS(9);return e.Njj(M.handleSegmentChanged(m))}),e.k0s()(),e.j41(13,"ion-footer")(14,"app-food-catalog-footer",9),e.bIt("searchTermChanged",function(m){e.eBV(g);const M=e.sdS(12);return e.Njj(M.handleSearchTermChanged(m))}),e.k0s()(),e.j41(15,"ion-footer")(16,"ion-toolbar"),e.DNE(17,E,3,1,"p",10)(18,R,3,1,"p",10),e.j41(19,"ion-buttons",2)(20,"ion-button",3),e.bIt("click",function(){return e.eBV(g),e.Njj(_.dismiss())}),e.EFF(21," Cancel "),e.k0s(),e.j41(22,"ion-button",11),e.bIt("click",function(){return e.eBV(g),e.Njj(_.confirm())}),e.EFF(23,"Confirm"),e.k0s()()()()}2&f&&(e.R7$(3),e.JRh(_.title),e.R7$(4),e.Y8G("translucent",!0),e.R7$(3),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("canAddItems",_.canAddItems)("canSelectPortions",_.canSelectPortions)("canSelectItems",_.canSelectItems),e.R7$(6),e.Y8G("ngIf",_.canSelectItems),e.R7$(),e.Y8G("ngIf",_.canSelectPortions),e.R7$(4),e.Y8G("strong",!0))}}),D})()},4569:(y,j,r)=>{r.d(j,{H:()=>d});var e=r(467),v=r(8581),E=r(9195),R=r(9275),b=r(8385),u=r(4438),D=r(3819),C=r(5293),f=r(4075),_=r(8317),g=r(2038);let d=(()=>{var m;class M extends R.y{constructor(a,l,s,c,P,I){super(P,I),this.modalController=a,this.portionService=l,this.imageService=s,this.imageCaptureService=c,this.databaseService=P,this.loadingService=I}deleteDefaultData(){var a=this;let l=E.g.catalogItems;return new Promise(s=>{let c=0;l.forEach(function(){var P=(0,e.A)(function*(I){if(yield a.deleteEntityFromDB(I.id),c++,c>=l.length)return s()});return function(I){return P.apply(this,arguments)}}())})}setupTableData(){this.tableName=v.jj.CATALOG_ITEM}setupDefaultData(a){var l=this;return(0,e.A)(function*(){let s;l.databaseService.getDatabase().then(c=>(s=c,s.count(v.jj.CATALOG_ITEM))).then(c=>{c<=0||a?E.g.catalogItems.forEach(function(){var P=(0,e.A)(function*(I){yield l.createEntityInDB(s,I),E.g.catalogItems.indexOf(I)>=E.g.catalogItems.length-1&&(l.reserveDatabaseEntries(),l.dataReady.next(!0))});return function(I){return P.apply(this,arguments)}}()):(l.reserveDatabaseEntries(),l.dataReady.next(!0))})})()}openFoodCatalog(a){this.modalController.create({component:b.g,showBackdrop:!0,backdropDismiss:!1,canDismiss:(l,s)=>new Promise(c=>{a.callback&&a.callback(l),this.handleModalClosed(l),c(!0)}),componentProps:{title:a.title,canSelectItems:a.canSelectItems,canSelectPortions:a.canSelectPortions,canAddItems:a.canAddItems}}).then(l=>{l.present()})}handleModalClosed(a){}getExportableItemData(a){var l=this;let s={portions:[],images:[]},c=[];return new Promise(function(){var P=(0,e.A)(function*(I){a=yield l.getByKey(a.id),s.catalogItem=a,null!=a.imageId&&c.push(a.imageId);let S=yield l.portionService.getAllForIndex(v.$I.PORTION_TBL_CATALOG_ITEM_ID,a.id);if(s.portions=S,S.forEach(T=>{null!=T.imageId&&c.push(T.imageId)}),c=Array.from(new Set(c)),c.length<=0)return I(s);c.forEach(function(){var T=(0,e.A)(function*(B){var o,h;let t=yield l.imageService.getByKey(B),i=yield l.imageService.getImageData(t);if(t.imageData=i,null===(o=s.images)||void 0===o||o.push(t),s.images&&(null===(h=s.images)||void 0===h?void 0:h.length)>=c.length)return I(s)});return function(B){return T.apply(this,arguments)}}())});return function(I){return P.apply(this,arguments)}}())}devHandleImportedData(a){var l=this;return new Promise(function(){var s=(0,e.A)(function*(c){var P;let I=null!==(P=null==a?void 0:a.images)&&void 0!==P?P:[],S=0,T=0;if(I.length<=0)return c(a);I.forEach(function(){var B=(0,e.A)(function*(o){var h,t,i;S++;let n=l.constructImageNameFromItem(null!==(h=null===(t=a.catalogItem)||void 0===t?void 0:t.name)&&void 0!==h?h:"item.jpg",S),p=o.imagePath.split(".")[1];o.imagePath=n+p;let x=null!==(i=o.imageData)&&void 0!==i?i:"no-data";if(yield l.imageCaptureService.devSaveBase64DataToDefaultsFolder(n,x),o.imageData=void 0,T++,T>=I.length)return c(a)});return function(o){return B.apply(this,arguments)}}())});return function(c){return s.apply(this,arguments)}}())}constructImageNameFromItem(a,l){let s=a;return s=s.toLowerCase(),s=s.replace(/ /g,"-"),s=`${s}-${l}`,s}}return(m=M).\u0275fac=function(a){return new(a||m)(u.KVO(D.W3),u.KVO(C.t),u.KVO(f.f),u.KVO(_.X),u.KVO(v.BP),u.KVO(g.U))},m.\u0275prov=u.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),M})()},5293:(y,j,r)=>{r.d(j,{t:()=>D});var e=r(467),v=r(8581),E=r(9195),R=r(9275),b=r(4438),u=r(2038);let D=(()=>{var C;class f extends R.y{constructor(g,d){super(g,d),this.databaseService=g,this.loadingService=d}deleteDefaultData(){var g=this;let d=E.g.portions;return new Promise(m=>{let M=0;d.forEach(function(){var O=(0,e.A)(function*(a){if(yield g.deleteEntityFromDB(a.id),M++,M>=d.length)return m()});return function(a){return O.apply(this,arguments)}}())})}setupTableData(){this.tableName=v.jj.PORTION}setupDefaultData(g){var d=this;return(0,e.A)(function*(){var m;let M,O=null!==(m=d.tableName)&&void 0!==m?m:"ERROR",a=E.g.portions;d.databaseService.getDatabase().then(l=>(M=l,M.count(O))).then(l=>{l<=0||g?a.forEach(function(){var s=(0,e.A)(function*(c){yield d.createEntityInDB(M,c),a.indexOf(c)>=a.length-1&&(d.reserveDatabaseEntries(),d.dataReady.next(!0))});return function(c){return s.apply(this,arguments)}}()):(d.reserveDatabaseEntries(),d.dataReady.next(!0))})})()}}return(C=f).\u0275fac=function(g){return new(g||C)(b.KVO(v.BP),b.KVO(u.U))},C.\u0275prov=b.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),f})()}}]);