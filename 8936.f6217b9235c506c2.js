"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8936],{8385:(B,T,n)=>{n.d(T,{g:()=>b});var t=n(4438),I=n(3819);function l(m,e){if(1&m&&(t.j41(0,"p")(1,"b"),t.EFF(2),t.k0s()()),2&m){const D=t.XpG();t.R7$(2),t.SpI("",D.selectedItems.length," items selected")}}function j(m,e){if(1&m&&(t.j41(0,"p")(1,"b"),t.EFF(2),t.k0s()()),2&m){const D=t.XpG();t.R7$(2),t.SpI("",D.selectedPortions.length," portions selected")}}let b=(()=>{var m;class e{constructor(f){this.modalController=f,this.title="Catalog",this.canAddItems=!1,this.canSelectItems=!1,this.canSelectPortions=!1,this.returnData={},this.selectedItems=[],this.selectedPortions=[]}ngOnInit(){}dismiss(){return this.modalController.dismiss(this.constructReturnData("dismiss"))}confirm(){return this.modalController.dismiss(this.constructReturnData("confirmSelection"))}itemSelected(f){-1==this.selectedItems.indexOf(f)&&this.selectedItems.push(f)}portionSelected(f){-1==this.selectedPortions.indexOf(f)&&this.selectedPortions.push(f)}constructReturnData(f){let _={...this.returnData};return _.returnedItems=this.selectedItems,_.returnedPortions=this.selectedPortions,_}}return(m=e).\u0275fac=function(f){return new(f||m)(t.rXU(I.W3))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-food-catalog-modal"]],decls:24,vars:9,consts:[["catalogheader",""],["catalog",""],["slot","end"],["color","medium",3,"click"],["name","close"],[3,"translucent"],["headerMode","none",3,"segmentChanged"],[3,"fullscreen"],[3,"onItemSelected","onPortionSelected","onSelectionComplete","segmentChanged","canAddItems","canSelectPortions","canSelectItems"],[3,"searchTermChanged"],[4,"ngIf"],["color","success","fill","outline",3,"click","strong"]],template:function(f,_){if(1&f){const h=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s(),t.j41(4,"ion-buttons",2)(5,"ion-button",3),t.bIt("click",function(){return t.eBV(h),t.Njj(_.dismiss())}),t.nrm(6,"ion-icon",4),t.k0s()()()(),t.j41(7,"ion-header",5)(8,"app-food-catalog-header",6,0),t.bIt("segmentChanged",function(u){t.eBV(h);const S=t.sdS(12);return t.Njj(S.handleSegmentChanged(u))}),t.k0s()(),t.j41(10,"ion-content",7)(11,"app-food-catalog",8,1),t.bIt("onItemSelected",function(u){return t.eBV(h),t.Njj(_.itemSelected(u))})("onPortionSelected",function(u){return t.eBV(h),t.Njj(_.portionSelected(u))})("onSelectionComplete",function(){return t.eBV(h),t.Njj(_.confirm())})("segmentChanged",function(u){t.eBV(h);const S=t.sdS(9);return t.Njj(S.handleSegmentChanged(u))}),t.k0s()(),t.j41(13,"ion-footer")(14,"app-food-catalog-footer",9),t.bIt("searchTermChanged",function(u){t.eBV(h);const S=t.sdS(12);return t.Njj(S.handleSearchTermChanged(u))}),t.k0s()(),t.j41(15,"ion-footer")(16,"ion-toolbar"),t.DNE(17,l,3,1,"p",10)(18,j,3,1,"p",10),t.j41(19,"ion-buttons",2)(20,"ion-button",3),t.bIt("click",function(){return t.eBV(h),t.Njj(_.dismiss())}),t.EFF(21," Cancel "),t.k0s(),t.j41(22,"ion-button",11),t.bIt("click",function(){return t.eBV(h),t.Njj(_.confirm())}),t.EFF(23,"Confirm"),t.k0s()()()()}2&f&&(t.R7$(3),t.JRh(_.title),t.R7$(4),t.Y8G("translucent",!0),t.R7$(3),t.Y8G("fullscreen",!0),t.R7$(),t.Y8G("canAddItems",_.canAddItems)("canSelectPortions",_.canSelectPortions)("canSelectItems",_.canSelectItems),t.R7$(6),t.Y8G("ngIf",_.canSelectItems),t.R7$(),t.Y8G("ngIf",_.canSelectPortions),t.R7$(4),t.Y8G("strong",!0))}}),e})()},4569:(B,T,n)=>{n.d(T,{H:()=>g});var t=n(467),I=n(8581),l=n(9195),j=n(9275),b=n(8385),m=n(4438),e=n(3819),D=n(5293),f=n(4075),_=n(8317),h=n(2038);let g=(()=>{var u;class S extends j.y{constructor(a,i,c,d,E,v){super(E,v),this.modalController=a,this.portionService=i,this.imageService=c,this.imageCaptureService=d,this.databaseService=E,this.loadingService=v}deleteDefaultData(){var a=this;let i=l.g.catalogItems;return new Promise(c=>{let d=0;i.forEach(function(){var E=(0,t.A)(function*(v){if(yield a.deleteEntityFromDB(v.id),d++,d>=i.length)return c()});return function(v){return E.apply(this,arguments)}}())})}setupTableData(){this.tableName=I.jj.CATALOG_ITEM}setupDefaultData(a){var i=this;return(0,t.A)(function*(){let c;i.databaseService.getDatabase().then(d=>(c=d,c.count(I.jj.CATALOG_ITEM))).then(d=>{d<=0||a?l.g.catalogItems.forEach(function(){var E=(0,t.A)(function*(v){yield i.createEntityInDB(c,v),l.g.catalogItems.indexOf(v)>=l.g.catalogItems.length-1&&(i.reserveDatabaseEntries(),i.dataReady.next(!0))});return function(v){return E.apply(this,arguments)}}()):(i.reserveDatabaseEntries(),i.dataReady.next(!0))})})()}openFoodCatalog(a){this.modalController.create({component:b.g,showBackdrop:!0,backdropDismiss:!1,canDismiss:(i,c)=>new Promise(d=>{a.callback&&a.callback(i),this.handleModalClosed(i),d(!0)}),componentProps:{title:a.title,canSelectItems:a.canSelectItems,canSelectPortions:a.canSelectPortions,canAddItems:a.canAddItems}}).then(i=>{i.present()})}handleModalClosed(a){}getExportableItemData(a){var i=this;let c={portions:[],images:[]},d=[];return new Promise(function(){var E=(0,t.A)(function*(v){a=yield i.getByKey(a.id),c.catalogItem=a,null!=a.imageId&&d.push(a.imageId);let R=yield i.portionService.getAllForIndex(I.$I.PORTION_TBL_CATALOG_ITEM_ID,a.id);if(c.portions=R,R.forEach(F=>{null!=F.imageId&&d.push(F.imageId)}),d=Array.from(new Set(d)),d.length<=0)return v(c);d.forEach(function(){var F=(0,t.A)(function*(O){var o,C;let p=yield i.imageService.getByKey(O),r=yield i.imageService.getImageData(p);if(p.imageData=r,null===(o=c.images)||void 0===o||o.push(p),c.images&&(null===(C=c.images)||void 0===C?void 0:C.length)>=d.length)return v(c)});return function(O){return F.apply(this,arguments)}}())});return function(v){return E.apply(this,arguments)}}())}devHandleImportedData(a){var i=this;return new Promise(function(){var c=(0,t.A)(function*(d){var E;let v=null!==(E=null==a?void 0:a.images)&&void 0!==E?E:[],R=0,F=0;if(v.length<=0)return d(a);v.forEach(function(){var O=(0,t.A)(function*(o){var C,p,r;R++;let s=i.constructImageNameFromItem(null!==(C=null===(p=a.catalogItem)||void 0===p?void 0:p.name)&&void 0!==C?C:"item.jpg",R),P=o.imagePath.split(".")[1];o.imagePath=s+P;let M=null!==(r=o.imageData)&&void 0!==r?r:"no-data";if(yield i.imageCaptureService.devSaveBase64DataToDefaultsFolder(s,M),o.imageData=void 0,F++,F>=v.length)return d(a)});return function(o){return O.apply(this,arguments)}}())});return function(d){return c.apply(this,arguments)}}())}constructImageNameFromItem(a,i){let c=a;return c=c.toLowerCase(),c=c.replace(/ /g,"-"),c=`${c}-${i}`,c}}return(u=S).\u0275fac=function(a){return new(a||u)(m.KVO(e.W3),m.KVO(D.t),m.KVO(f.f),m.KVO(_.X),m.KVO(I.BP),m.KVO(h.U))},u.\u0275prov=m.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),S})()},5293:(B,T,n)=>{n.d(T,{t:()=>e});var t=n(467),I=n(8581),l=n(9195),j=n(9275),b=n(4438),m=n(2038);let e=(()=>{var D;class f extends j.y{constructor(h,g){super(h,g),this.databaseService=h,this.loadingService=g}deleteDefaultData(){var h=this;let g=l.g.portions;return new Promise(u=>{let S=0;g.forEach(function(){var y=(0,t.A)(function*(a){if(yield h.deleteEntityFromDB(a.id),S++,S>=g.length)return u()});return function(a){return y.apply(this,arguments)}}())})}setupTableData(){this.tableName=I.jj.PORTION}setupDefaultData(h){var g=this;return(0,t.A)(function*(){var u;let S,y=null!==(u=g.tableName)&&void 0!==u?u:"ERROR",a=l.g.portions;g.databaseService.getDatabase().then(i=>(S=i,S.count(y))).then(i=>{i<=0||h?a.forEach(function(){var c=(0,t.A)(function*(d){yield g.createEntityInDB(S,d),a.indexOf(d)>=a.length-1&&(g.reserveDatabaseEntries(),g.dataReady.next(!0))});return function(d){return c.apply(this,arguments)}}()):(g.reserveDatabaseEntries(),g.dataReady.next(!0))})})()}}return(D=f).\u0275fac=function(h){return new(h||D)(b.KVO(I.BP),b.KVO(m.U))},D.\u0275prov=b.jDH({token:D,factory:D.\u0275fac,providedIn:"root"}),f})()},8936:(B,T,n)=>{n.r(T),n.d(T,{SettingsPageModule:()=>O});var t=n(177),I=n(4341),l=n(3819),j=n(9858),b=n(7144),m=n(1020),e=n(4438),D=n(1799),f=n(529),_=n(8581),h=n(4988),g=n(2038),u=n(4569),S=n(5293),y=n(7225),a=n(8317),i=n(4075),c=n(345);function d(o,C){1&o&&(e.j41(0,"ion-list-header"),e.EFF(1,"DEV"),e.k0s())}function E(o,C){if(1&o){const p=e.RV6();e.j41(0,"ion-list",4)(1,"ion-item")(2,"ion-label"),e.EFF(3," Take test photo "),e.j41(4,"p"),e.EFF(5,"Takes a test photo"),e.k0s()(),e.j41(6,"ion-button",13),e.bIt("click",function(){e.eBV(p);const s=e.XpG();return e.Njj(s.takePhoto())}),e.EFF(7," Take photo "),e.nrm(8,"ion-icon",14),e.k0s()(),e.j41(9,"ion-item")(10,"ion-input",15),e.mxI("ngModelChange",function(s){e.eBV(p);const P=e.XpG();return e.DH7(P.settings.importedData,s)||(P.settings.importedData=s),e.Njj(s)}),e.k0s(),e.j41(11,"ion-button",16),e.bIt("click",function(){e.eBV(p);const s=e.XpG();return e.Njj(s.devProcessImportedData())}),e.EFF(12," Process "),e.nrm(13,"ion-icon",17),e.k0s()(),e.nrm(14,"img",18),e.k0s()}if(2&o){const p=e.XpG();e.Y8G("inset",!0),e.R7$(10),e.R50("ngModel",p.settings.importedData),e.R7$(),e.Y8G("disabled",!p.settings.importedData),e.R7$(3),e.Y8G("src",p.imagePath,e.B4B)}}const R=[{path:"",component:(()=>{var o;class C{constructor(r,s,P,M,A,G,U,k,V,$,K){this.systemService=r,this.messageService=s,this.databaseService=P,this.alertService=M,this.loadingService=A,this.catalogService=G,this.portionService=U,this.foodLogService=k,this.imageCaptureService=V,this.imageService=$,this._sanitizer=K,this.properties={appVersion:b.c.version,dbVersion:b.c.dbVersion},this.settings={carbGoal:0},this.isDev=!1,this.imagePath=""}ngOnInit(){this.setup()}setup(){this.isDev=!b.c.production,this.getCarbGoal()}toggleChange(r){this.systemService.toggleChange(r),this.messageService.display("Dark mode changed",3,"middle")}deleteDefaultData(){this.alertService.promptConfirmation("Confirm","are you sure you want to delete built-in app data?","no","yes").then(r=>{r&&this.databaseService.triggerDeleteDefaultData()})}restoreDefaultData(){this.alertService.promptConfirmation("Confirm","are you sure you want to restore default data back to initial app state?","no","yes").then(r=>{r&&this.databaseService.triggerRestoreDefaultData()})}getCarbGoal(){this.loadingService.addToQueue(this.foodLogService.getDailyCarbGoal().then(r=>{this.settings.carbGoal=r}))}setCarbGoal(){null!=this.settings.carbGoal&&this.settings.carbGoal>0&&this.foodLogService.setDailyCarbGoal(this.settings.carbGoal)}takePhoto(){this.imageCaptureService.requestPhoto().then(r=>{r?(console.log(r),this.imageCaptureService.readFileFromPath(r.filepath).then(s=>{console.log(s),this.imagePath=`data:image/jpeg;base64,${s.data}`})):this.alertService.simpleError("Error during image upload")})}devProcessImportedData(){let r=JSON.parse(this.settings.importedData);this.settings.importedData=void 0,this.catalogService.devHandleImportedData(r).then(s=>{let P=JSON.stringify(s);m.B.write({string:P}).then(()=>{this.messageService.display("Adjusted data copied to clipboard.",6,"middle")})})}}return(o=C).\u0275fac=function(r){return new(r||o)(e.rXU(D.V),e.rXU(f.b),e.rXU(_.BP),e.rXU(h.u),e.rXU(g.U),e.rXU(u.H),e.rXU(S.t),e.rXU(y.i),e.rXU(a.X),e.rXU(i.f),e.rXU(c.up))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-settings"]],decls:44,vars:11,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],[3,"inset"],["justify","space-between",3,"ngModelChange","ionChange","ngModel"],["color","danger",3,"click"],["slot","icon-only","name","trash"],["color","warning",3,"click"],["slot","icon-only","name","refresh"],["label","Daily carb goal","labelPlacement","stacked","helperText","Roughly 1/8th of your daily calorie goal","type","number",3,"ngModelChange","ionChange","ngModel"],[4,"ngIf"],[3,"inset",4,"ngIf"],[3,"click"],["slot","end","name","camera"],["label","Import data","labelPlacement","stacked","helperText","Paste exported data here",3,"ngModelChange","ngModel"],[3,"click","disabled"],["slot","end","name","cog"],[3,"src"]],template:function(r,s){1&r&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title",2),e.EFF(5,"Settings"),e.k0s()()(),e.j41(6,"ion-content",3)(7,"ion-list-header"),e.EFF(8,"Appearance"),e.k0s(),e.j41(9,"ion-list",4)(10,"ion-item")(11,"ion-toggle",5),e.mxI("ngModelChange",function(M){return e.DH7(s.systemService.darkModeToggle,M)||(s.systemService.darkModeToggle=M),M}),e.bIt("ionChange",function(M){return s.toggleChange(M)}),e.EFF(12,"Dark Mode"),e.k0s()()(),e.j41(13,"ion-list-header"),e.EFF(14,"Data"),e.k0s(),e.j41(15,"ion-list",4)(16,"ion-item")(17,"ion-label"),e.EFF(18," Delete default data "),e.j41(19,"p"),e.EFF(20,"deletes built-in data from app (including changes you have made)"),e.k0s()(),e.j41(21,"ion-button",6),e.bIt("click",function(){return s.deleteDefaultData()}),e.nrm(22,"ion-icon",7),e.k0s()(),e.j41(23,"ion-item")(24,"ion-label"),e.EFF(25," Restore default data "),e.j41(26,"p"),e.EFF(27,"restores built-in data to original app state"),e.k0s()(),e.j41(28,"ion-button",8),e.bIt("click",function(){return s.restoreDefaultData()}),e.nrm(29,"ion-icon",9),e.k0s()()(),e.j41(30,"ion-list-header"),e.EFF(31,"Personal"),e.k0s(),e.j41(32,"ion-list",4)(33,"ion-item")(34,"ion-input",10),e.mxI("ngModelChange",function(M){return e.DH7(s.settings.carbGoal,M)||(s.settings.carbGoal=M),M}),e.bIt("ionChange",function(){return s.setCarbGoal()}),e.k0s()()(),e.DNE(35,d,2,0,"ion-list-header",11)(36,E,15,4,"ion-list",12),e.k0s(),e.j41(37,"ion-footer")(38,"ion-toolbar")(39,"ion-note"),e.EFF(40),e.k0s(),e.nrm(41,"br"),e.j41(42,"ion-note"),e.EFF(43),e.k0s()()()),2&r&&(e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("inset",!0),e.R7$(2),e.R50("ngModel",s.systemService.darkModeToggle),e.R7$(4),e.Y8G("inset",!0),e.R7$(17),e.Y8G("inset",!0),e.R7$(2),e.R50("ngModel",s.settings.carbGoal),e.R7$(),e.Y8G("ngIf",s.isDev),e.R7$(),e.Y8G("ngIf",s.isDev),e.R7$(4),e.SpI("app v",s.properties.appVersion,""),e.R7$(3),e.SpI("db v",s.properties.dbVersion,""))},dependencies:[t.bT,I.BC,I.vS,l.Jm,l.QW,l.W9,l.M0,l.eU,l.iq,l.$w,l.uz,l.he,l.nf,l.AF,l.MC,l.JI,l.BC,l.BY,l.ai,l.hB,l.su,l.Gw]}),C})()}];let F=(()=>{var o;class C{}return(o=C).\u0275fac=function(r){return new(r||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[j.iI.forChild(R),j.iI]}),C})(),O=(()=>{var o;class C{}return(o=C).\u0275fac=function(r){return new(r||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[t.MD,I.YN,l.bv,F]}),C})()}}]);