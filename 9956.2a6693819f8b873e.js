"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9956],{9956:(x,g,s)=>{s.r(g),s.d(g,{AddEntryPageModule:()=>C});var c=s(177),d=s(4341),a=s(3819),u=s(9858),t=s(4438),m=s(4569),f=s(7225),y=s(2038),_=s(529),h=s(4988),v=s(9385);let E=(()=>{var n;class l{transform(i,e){return i?i.reduce((r,p)=>r+(p[e]||0),0):0}}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=t.EJ8({name:"sumProperty",type:n,pure:!1}),l})();function P(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-card-title",15),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.EFF(1),t.k0s()}if(2&n){const o=t.XpG();t.R7$(),t.JRh(o.entry.name)}}function I(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-input",16),t.mxI("ngModelChange",function(e){t.eBV(o);const r=t.XpG();return t.DH7(r.entry.name,e)||(r.entry.name=e),t.Njj(e)}),t.k0s()}if(2&n){const o=t.XpG();t.R50("ngModel",o.entry.name),t.Y8G("autofocus",!0)}}function k(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-icon",17),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("name",o.editTitle?"checkmark":"pencil")}}function A(n,l){if(1&n){const o=t.RV6();t.j41(0,"p",15),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.EFF(1),t.k0s()}if(2&n){let o;const i=t.XpG();t.R7$(),t.JRh(null!==(o=i.entry.note)&&void 0!==o?o:"click to add note")}}function j(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-input",18),t.mxI("ngModelChange",function(e){t.eBV(o);const r=t.XpG();return t.DH7(r.entry.note,e)||(r.entry.note=e),t.Njj(e)}),t.k0s()}if(2&n){const o=t.XpG();t.R50("ngModel",o.entry.note),t.Y8G("autofocus",!0)}}function G(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-icon",19),t.bIt("click",function(){t.eBV(o);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.k0s()}if(2&n){const o=t.XpG();t.Y8G("name",o.editNote?"checkmark":"pencil")}}function T(n,l){if(1&n){const o=t.RV6();t.j41(0,"ion-card",20)(1,"ion-card-content",21)(2,"app-portion",22),t.bIt("onPortionDeleted",function(e){t.eBV(o);const r=t.XpG();return t.Njj(r.removePortion(e))}),t.k0s()()()}if(2&n){const o=l.$implicit;t.R7$(2),t.Y8G("portion",o)("allowDBDeletion",!1)("allowEdit",!1)}}const R=[{path:"",component:(()=>{var n;class l{constructor(i,e,r,p,F,N){this.catalogService=i,this.foodLogService=e,this.loadingService=r,this.messageService=p,this.alertService=F,this.router=N,this.defaultLog={name:"",portionIds:[],date:(new Date).toISOString()},this.entry={...this.defaultLog},this.editTitle=!0,this.editNote=!1,this.portions=[]}ngOnInit(){}reset(){this.entry={...this.defaultLog},this.portions=[],this.editTitle=!0,this.editNote=!1}openCatalog(){this.catalogService.openFoodCatalog({title:"Select portions to add",callback:this.addSelectedPortions.bind(this),canAddItems:!0,canSelectItems:!1,canSelectPortions:!0})}addSelectedPortions(i){var e;this.portions=this.portions.concat(null!==(e=i.returnedPortions)&&void 0!==e?e:[])}removePortion(i){let e=this.portions.map(r=>r.id).indexOf(i.id);this.portions.splice(e,1)}cancel(){this.reset()}confirm(){this.entry.carbs=this.countCarbs(this.portions),this.entry.portionIds=this.portions.map(i=>i.id).filter(i=>null!=i),this.entry.date=(new Date).toISOString(),this.validate(this.entry)&&this.loadingService.addToQueue(this.foodLogService.saveItemToDB(this.entry).then(i=>{this.reset(),this.messageService.display("Entry saved!"),this.promptNavigation()}))}promptNavigation(){this.alertService.promptConfirmation("View entries","Would you like to view your new log on the entry log page?","no","yes").then(i=>{i&&this.router.navigateByUrl("/view-entries")})}validate(i){var e;let r=!0;return i.name?null==i.portionIds||(null===(e=i.portionIds)||void 0===e?void 0:e.length)<=0?(r=!1,this.alertService.simpleError("Entries cannot be created without portions","Entry invalid"),!1):r:(r=!1,this.alertService.simpleError("Entry must have a name","Entry invalid"),!1)}countCarbs(i){return i.reduce((e,r)=>e+(r.carbs||0),0)}}return(n=l).\u0275fac=function(i){return new(i||n)(t.rXU(m.H),t.rXU(f.i),t.rXU(y.U),t.rXU(_.b),t.rXU(h.u),t.rXU(u.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-add-entry"]],decls:36,vars:14,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],[3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","large",3,"name","click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","add any extra information","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","small",3,"name","click",4,"ngIf"],["class","portion-card",4,"ngFor","ngForOf"],["lines","none",3,"click"],["name","add","size","large","color","primary"],["slot","end"],["color","medium",3,"click"],[3,"click","strong"],[3,"click"],["fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","large",3,"click","name"],["fill","outline","type","text","placeholder","add any extra information","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","small",3,"click","name"],[1,"portion-card"],[1,"no-padding"],[3,"onPortionDeleted","portion","allowDBDeletion","allowEdit"]],template:function(i,e){1&i&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title",2),t.EFF(5,"Add Entry"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header")(9,"ion-row"),t.DNE(10,P,2,1,"ion-card-title",4)(11,I,1,2,"ion-input",5)(12,k,1,1,"ion-icon",6),t.k0s(),t.j41(13,"ion-card-subtitle"),t.EFF(14,"Select portions"),t.k0s()(),t.j41(15,"ion-card-content")(16,"ion-row"),t.DNE(17,A,2,1,"p",4)(18,j,1,2,"ion-input",7)(19,G,1,1,"ion-icon",8),t.k0s(),t.DNE(20,T,3,3,"ion-card",9),t.j41(21,"ion-item",10),t.bIt("click",function(){return e.openCatalog()}),t.nrm(22,"ion-icon",11),t.j41(23,"ion-label"),t.EFF(24,"Add portion "),t.k0s()()()()(),t.j41(25,"ion-footer")(26,"ion-toolbar")(27,"p")(28,"b"),t.EFF(29),t.nI1(30,"sumProperty"),t.k0s()(),t.j41(31,"ion-buttons",12)(32,"ion-button",13),t.bIt("click",function(){return e.cancel()}),t.EFF(33," Cancel "),t.k0s(),t.j41(34,"ion-button",14),t.bIt("click",function(){return e.confirm()}),t.EFF(35,"Confirm"),t.k0s()()()()),2&i&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("ngIf",!e.editTitle),t.R7$(),t.Y8G("ngIf",e.editTitle),t.R7$(),t.Y8G("ngIf",e.entry.name),t.R7$(5),t.Y8G("ngIf",!e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngForOf",e.portions),t.R7$(9),t.SpI("",t.i5U(30,11,e.portions,"carbs"),"g Carbs"),t.R7$(5),t.Y8G("strong",!0))},dependencies:[c.Sq,c.bT,d.BC,d.vS,a.Jm,a.QW,a.b_,a.I9,a.ME,a.HW,a.tN,a.W9,a.M0,a.eU,a.iq,a.$w,a.uz,a.he,a.MC,a.ln,a.BC,a.ai,a.Gw,v.x,E]}),l})()}];let S=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[u.iI.forChild(R),u.iI]}),l})();var M=s(1815),b=s(4683);let C=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[c.MD,d.YN,a.bv,S,M.U,b.Y]}),l})()}}]);