"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2619],{2619:(q,f,s)=>{s.r(f),s.d(f,{AddEntryPageModule:()=>Q});var p=s(177),u=s(4341),r=s(3819),g=s(9858),t=s(4438),v=s(4569),E=s(7225),I=s(2038),N=s(529),T=s(4988),C=s(467);function A(o,a){1&o&&t.eu8(0)}function M(o,a){1&o&&(t.j41(0,"ion-text",14)(1,"small"),t.EFF(2,"This field is required."),t.k0s()())}function R(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-input",12),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG().$implicit;return t.DH7(l.value,e)||(l.value=e),t.Njj(e)}),t.k0s(),t.DNE(1,M,3,0,"ion-text",13)}if(2&o){const n=t.XpG().$implicit;t.AVh("required",(null==n.attributes?null:n.attributes.required)&&!n.value),t.R50("ngModel",n.value),t.Y8G("type",n.type)("label",(null!=n.attributes&&n.attributes.required?"*":"")+n.label)("placeholder",n.placeholder),t.R7$(),t.Y8G("ngIf",(null==n.attributes?null:n.attributes.required)&&!n.value)}}function b(o,a){1&o&&t.eu8(0)}function S(o,a){if(1&o&&(t.j41(0,"ion-select-option",17),t.EFF(1),t.k0s()),2&o){const n=a.$implicit;t.Y8G("value",n),t.R7$(),t.SpI(" ",n," ")}}function k(o,a){1&o&&(t.j41(0,"ion-text",14)(1,"small"),t.EFF(2,"required"),t.k0s()())}function F(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-select",15),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG(2).$implicit;return t.DH7(l.value,e)||(l.value=e),t.Njj(e)}),t.DNE(1,S,2,2,"ion-select-option",16),t.k0s(),t.DNE(2,k,3,0,"ion-text",13)}if(2&o){const n=t.XpG(2).$implicit;t.AVh("required",(null==n.attributes?null:n.attributes.required)&&!n.value),t.Y8G("label",(null!=n.attributes&&n.attributes.required?"*":"")+n.label)("placeholder",n.placeholder)("value",n.value),t.R50("ngModel",n.value),t.R7$(),t.Y8G("ngForOf",null==n.options?null:n.options.choices),t.R7$(),t.Y8G("ngIf",(null==n.attributes?null:n.attributes.required)&&!n.value)}}function G(o,a){if(1&o&&t.DNE(0,b,1,0,"ng-container",11)(1,F,3,8,"ng-template",null,3,t.C5r),2&o){const n=t.sdS(2),i=t.XpG().$implicit;t.XpG();const e=t.sdS(17);t.Y8G("ngIf","dropdown"===i.altType)("ngIfThen",n)("ngIfElse",e)}}function j(o,a){if(1&o&&(t.j41(0,"div")(1,"ion-item"),t.DNE(2,A,1,0,"ng-container",11)(3,R,2,7,"ng-template",null,1,t.C5r)(5,G,3,3,"ng-template",null,2,t.C5r),t.k0s()()),2&o){const n=a.$implicit,i=t.sdS(4),e=t.sdS(6);t.R7$(2),t.Y8G("ngIf",!n.altType)("ngIfThen",i)("ngIfElse",e)}}function D(o,a){1&o&&t.EFF(0," not implemented\n")}let P=(()=>{var o;class a{constructor(i){this.modalController=i}ngOnInit(){}isValid(){return this.inputs.every(i=>{var e;return!(null!==(e=i.attributes)&&void 0!==e&&e.required)||i.value})}dismiss(i){this.modalController.dismiss({data:this.getFormData()},i?"confirm":"cancel")}confirm(){this.isValid()&&this.dismiss(!0)}getFormData(){const i={};return this.inputs.forEach(e=>{i[e.name]=e.value}),i}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(r.W3))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-input-modal"]],inputs:{title:"title",message:"message",inputs:"inputs"},decls:18,vars:5,consts:[["notImplementedType",""],["type",""],["altType",""],["dropdownType",""],[3,"fullscreen"],[1,"mx-2"],[4,"ngFor","ngForOf"],["slot","start"],[3,"click"],["slot","end"],["color","success","fill","outline",3,"click","disabled"],[4,"ngIf","ngIfThen","ngIfElse"],["required","","labelPlacement","stacked",3,"ngModelChange","ngModel","type","label","placeholder"],["color","danger",4,"ngIf"],["color","danger"],["justify","start","interface","action-sheet",3,"ngModelChange","label","placeholder","value","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,e){if(1&i){const l=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3),t.k0s()()(),t.j41(4,"ion-content",4)(5,"p",5),t.EFF(6),t.k0s(),t.DNE(7,j,7,3,"div",6),t.k0s(),t.j41(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",7)(11,"ion-button",8),t.bIt("click",function(){return t.eBV(l),t.Njj(e.dismiss(!1))}),t.EFF(12,"Cancel"),t.k0s()(),t.j41(13,"ion-buttons",9)(14,"ion-button",10),t.bIt("click",function(){return t.eBV(l),t.Njj(e.confirm())}),t.EFF(15,"Confirm"),t.k0s()()()(),t.DNE(16,D,1,0,"ng-template",null,0,t.C5r)}2&i&&(t.R7$(3),t.JRh(e.title),t.R7$(),t.Y8G("fullscreen",!0),t.R7$(2),t.JRh(e.message),t.R7$(),t.Y8G("ngForOf",e.inputs),t.R7$(7),t.Y8G("disabled",!e.isValid()))},dependencies:[p.Sq,p.bT,u.BC,u.YS,u.vS,r.Jm,r.QW,r.W9,r.M0,r.eU,r.$w,r.uz,r.Nm,r.Ip,r.IO,r.BC,r.ai,r.Je,r.Gw],styles:[".required[_ngcontent-%COMP%]{border-bottom:1px solid red}"]}),a})(),x=(()=>{var o;class a{constructor(i){this.modalController=i}presentInputModal(i,e,l,c=!1){var d=this;return(0,C.A)(function*(){const m=yield d.modalController.create({component:P,backdropDismiss:c,componentProps:{inputs:i,title:e,message:l},cssClass:"small-modal",showBackdrop:!0});yield m.present();const _=yield m.onDidDismiss();return{data:_.data||{},confirmed:"confirm"===_.role}})()}}return(o=a).\u0275fac=function(i){return new(i||o)(t.KVO(r.W3))},o.\u0275prov=t.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),a})();var $=s(742),V=s(9385),X=s(9715);function Y(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-card-title",16),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.EFF(1),t.k0s()}if(2&o){const n=t.XpG();t.R7$(),t.JRh(n.entry.name)}}function B(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-input",17),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG();return t.DH7(l.entry.name,e)||(l.entry.name=e),t.Njj(e)}),t.k0s()}if(2&o){const n=t.XpG();t.R50("ngModel",n.entry.name),t.Y8G("autofocus",!0)}}function O(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-icon",18),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.editTitle=!e.editTitle)}),t.k0s()}if(2&o){const n=t.XpG();t.Y8G("name",n.editTitle?"checkmark":"pencil")}}function U(o,a){if(1&o){const n=t.RV6();t.j41(0,"p",16),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.EFF(1),t.k0s()}if(2&o){let n;const i=t.XpG();t.R7$(),t.JRh(null!==(n=i.entry.note)&&void 0!==n?n:"click to add note")}}function w(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-input",19),t.mxI("ngModelChange",function(e){t.eBV(n);const l=t.XpG();return t.DH7(l.entry.note,e)||(l.entry.note=e),t.Njj(e)}),t.k0s()}if(2&o){const n=t.XpG();t.R50("ngModel",n.entry.note),t.Y8G("autofocus",!0)}}function K(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-icon",20),t.bIt("click",function(){t.eBV(n);const e=t.XpG();return t.Njj(e.editNote=!e.editNote)}),t.k0s()}if(2&o){const n=t.XpG();t.Y8G("name",n.editNote?"checkmark":"pencil")}}function L(o,a){if(1&o){const n=t.RV6();t.j41(0,"ion-card",21)(1,"ion-card-content",22)(2,"app-portion",23),t.bIt("onPortionDeleted",function(e){t.eBV(n);const l=t.XpG();return t.Njj(l.removePortion(e))}),t.k0s()()()}if(2&o){const n=a.$implicit;t.R7$(2),t.Y8G("portion",n)("allowDBDeletion",!1)("allowEdit",!1)}}const z=[{path:"",component:(()=>{var o;class a{constructor(i,e,l,c,d,m,_,h,y){this.catalogService=i,this.foodLogService=e,this.loadingService=l,this.messageService=c,this.alertService=d,this.modalService=m,this.router=_,this.route=h,this.normalNav=y,this.defaultLog={name:"",portionIds:[],date:(new Date).toISOString()},this.entry={...this.defaultLog},this.editTitle=!1,this.editNote=!1,this.portions=[]}ngOnInit(){this.route.params.subscribe(i=>{this.setup()})}setup(){this.entry.name=this.getDefaultEntryName(),this.promptInputModal()}reset(){this.entry={...this.defaultLog},this.portions=[],this.editTitle=!0,this.editNote=!1}openCatalog(){this.normalNav.setNavigationAllowed(!1),this.catalogService.openFoodCatalog({title:"Select portions to add",callback:this.addSelectedPortions.bind(this),canAddItems:!0,canSelectItems:!1,canSelectPortions:!0})}addSelectedPortions(i){var e;this.portions=this.portions.concat(null!==(e=i.returnedPortions)&&void 0!==e?e:[]),this.normalNav.setNavigationAllowed(!0)}removePortion(i){let e=this.portions.map(l=>l.id).indexOf(i.id);this.portions.splice(e,1)}cancel(){this.reset()}confirm(){this.entry.carbs=this.countCarbs(this.portions),this.entry.portionIds=this.portions.map(i=>i.id).filter(i=>null!=i),this.entry.date=(new Date).toISOString(),this.validate(this.entry)&&this.loadingService.addToQueue(this.foodLogService.saveItemToDB(this.entry).then(i=>{this.reset(),this.messageService.display("Entry saved!"),this.promptNavigation()}))}promptNavigation(){this.alertService.promptConfirmation("View entries","Would you like to view your new log on the entry log page?","no","yes").then(i=>{i&&this.router.navigateByUrl("/view-entries")})}validate(i){var e;let l=!0;return i.name?null==i.portionIds||(null===(e=i.portionIds)||void 0===e?void 0:e.length)<=0?(l=!1,this.alertService.simpleError("Entries cannot be created without portions","Entry invalid"),!1):l:(l=!1,this.alertService.simpleError("Entry must have a name","Entry invalid"),!1)}countCarbs(i){return i.reduce((e,l)=>e+(l.carbs||0),0)}promptInputModal(){let i=[{altType:"dropdown",options:{choices:["Breakfast","Lunch","Dinner","Morning Snack","Afternoon Snack","Other"]},value:this.getDefaultEntryName(),name:"entryName",label:"entry type",placeholder:"entry name eg. 'lunch'",attributes:{required:!0}},{name:"note",label:"note",placeholder:"note eg. 'small lunch'"}];this.modalService.presentInputModal(i,"Enter details","Add info for new entry").then(e=>{if(e.confirmed){let l=e.data.data,c=l.entryName,d=l.note;this.entry.name=null==c||""==c?null:c,this.entry.note=null==d||""==d?null:d,this.editTitle=null==this.entry.name,this.openCatalog()}})}promptInput(){this.alertService.promptInput("Enter details","Add info for new entry",[{name:"entryName",label:"entry name",placeholder:"entry name eg. 'lunch'",attributes:{required:!0,autofocus:!0}},{name:"note",placeholder:"note eg. 'small lunch'"}]).then(e=>{let l=e.entryName,c=e.note;this.entry.name=null==l||""==l?null:l,this.entry.note=null==c||""==c?null:c,this.editTitle=null==this.entry.name,this.openCatalog()})}getDefaultEntryName(){let i="";const e=(new Date).getHours();return i=e>=5&&e<10?"Breakfast":e>=12&&e<16?"Lunch":e>=18&&e<22?"Dinner":e>=10&&e<12?"Morning Snack":e>=16&&e<18?"Afternoon Snack":"Other",i}}return(o=a).\u0275fac=function(i){return new(i||o)(t.rXU(v.H),t.rXU(E.i),t.rXU(I.U),t.rXU(N.b),t.rXU(T.u),t.rXU(x),t.rXU(g.Ix),t.rXU(g.nX),t.rXU($.$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-add-entry"]],decls:34,vars:14,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],["mode","ios"],[3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","large",3,"name","click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","add any extra information","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","small",3,"name","click",4,"ngIf"],["class","portion-card",4,"ngFor","ngForOf"],["lines","none",3,"click"],["name","add","size","large","color","primary"],["slot","end"],["color","medium",3,"click"],["color","success","fill","outline",3,"click","strong"],[3,"click"],["fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","large",3,"click","name"],["fill","outline","type","text","placeholder","add any extra information","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","small",3,"click","name"],[1,"portion-card"],[1,"no-padding"],[3,"onPortionDeleted","portion","allowDBDeletion","allowEdit"]],template:function(i,e){1&i&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title",2),t.EFF(5,"Add Entry"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header",4)(9,"ion-row"),t.DNE(10,Y,2,1,"ion-card-title",5)(11,B,1,2,"ion-input",6)(12,O,1,1,"ion-icon",7),t.k0s()(),t.j41(13,"ion-card-content")(14,"ion-row"),t.DNE(15,U,2,1,"p",5)(16,w,1,2,"ion-input",8)(17,K,1,1,"ion-icon",9),t.k0s(),t.DNE(18,L,3,3,"ion-card",10),t.j41(19,"ion-item",11),t.bIt("click",function(){return e.openCatalog()}),t.nrm(20,"ion-icon",12),t.j41(21,"ion-label"),t.EFF(22,"Add portion "),t.k0s()()()()(),t.j41(23,"ion-footer")(24,"ion-toolbar")(25,"p")(26,"b"),t.EFF(27),t.nI1(28,"sumProperty"),t.k0s()(),t.j41(29,"ion-buttons",13)(30,"ion-button",14),t.bIt("click",function(){return e.cancel()}),t.EFF(31," Cancel "),t.k0s(),t.j41(32,"ion-button",15),t.bIt("click",function(){return e.confirm()}),t.EFF(33,"Confirm"),t.k0s()()()()),2&i&&(t.Y8G("translucent",!0),t.R7$(6),t.Y8G("fullscreen",!0),t.R7$(4),t.Y8G("ngIf",!e.editTitle),t.R7$(),t.Y8G("ngIf",e.editTitle),t.R7$(),t.Y8G("ngIf",e.entry.name),t.R7$(3),t.Y8G("ngIf",!e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngIf",e.editNote),t.R7$(),t.Y8G("ngForOf",e.portions),t.R7$(9),t.SpI("",t.i5U(28,11,e.portions,"carbs"),"g Carbs"),t.R7$(5),t.Y8G("strong",!0))},dependencies:[p.Sq,p.bT,u.BC,u.vS,r.Jm,r.QW,r.b_,r.I9,r.ME,r.tN,r.W9,r.M0,r.eU,r.iq,r.$w,r.uz,r.he,r.MC,r.ln,r.BC,r.ai,r.Gw,V.x,X.$]}),a})()}];let H=(()=>{var o;class a{}return(o=a).\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.iI.forChild(z),g.iI]}),a})();var J=s(1815),W=s(4683);let Q=(()=>{var o;class a{}return(o=a).\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[p.MD,u.YN,r.bv,H,J.U,W.Y]}),a})()}}]);