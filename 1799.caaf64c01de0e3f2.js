"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1799],{4180:(J,g,s)=>{s.r(g),s.d(g,{AddEntryPageModule:()=>H});var p=s(177),u=s(4341),a=s(3819),m=s(9858),e=s(4438),h=s(4569),y=s(7225),v=s(2038),E=s(529),I=s(4988),T=s(467);function N(n,l){1&n&&e.eu8(0)}function C(n,l){1&n&&(e.j41(0,"ion-text",14)(1,"small"),e.EFF(2,"This field is required."),e.k0s()())}function A(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-input",12),e.mxI("ngModelChange",function(t){e.eBV(o);const r=e.XpG().$implicit;return e.DH7(r.value,t)||(r.value=t),e.Njj(t)}),e.k0s(),e.DNE(1,C,3,0,"ion-text",13)}if(2&n){const o=e.XpG().$implicit;e.AVh("required",(null==o.attributes?null:o.attributes.required)&&!o.value),e.R50("ngModel",o.value),e.Y8G("type",o.type)("label",(null!=o.attributes&&o.attributes.required?"*":"")+o.label)("placeholder",o.placeholder),e.R7$(),e.Y8G("ngIf",(null==o.attributes?null:o.attributes.required)&&!o.value)}}function M(n,l){1&n&&e.eu8(0)}function R(n,l){if(1&n&&(e.j41(0,"ion-select-option",17),e.EFF(1),e.k0s()),2&n){const o=l.$implicit;e.Y8G("value",o),e.R7$(),e.SpI(" ",o," ")}}function S(n,l){1&n&&(e.j41(0,"ion-text",14)(1,"small"),e.EFF(2,"required"),e.k0s()())}function b(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-select",15),e.mxI("ngModelChange",function(t){e.eBV(o);const r=e.XpG(2).$implicit;return e.DH7(r.value,t)||(r.value=t),e.Njj(t)}),e.DNE(1,R,2,2,"ion-select-option",16),e.k0s(),e.DNE(2,S,3,0,"ion-text",13)}if(2&n){const o=e.XpG(2).$implicit;e.AVh("required",(null==o.attributes?null:o.attributes.required)&&!o.value),e.Y8G("label",(null!=o.attributes&&o.attributes.required?"*":"")+o.label)("placeholder",o.placeholder)("value",o.value),e.R50("ngModel",o.value),e.R7$(),e.Y8G("ngForOf",null==o.options?null:o.options.choices),e.R7$(),e.Y8G("ngIf",(null==o.attributes?null:o.attributes.required)&&!o.value)}}function k(n,l){if(1&n&&e.DNE(0,M,1,0,"ng-container",11)(1,b,3,8,"ng-template",null,3,e.C5r),2&n){const o=e.sdS(2),i=e.XpG().$implicit;e.XpG();const t=e.sdS(17);e.Y8G("ngIf","dropdown"===i.altType)("ngIfThen",o)("ngIfElse",t)}}function F(n,l){if(1&n&&(e.j41(0,"div")(1,"ion-item"),e.DNE(2,N,1,0,"ng-container",11)(3,A,2,7,"ng-template",null,1,e.C5r)(5,k,3,3,"ng-template",null,2,e.C5r),e.k0s()()),2&n){const o=l.$implicit,i=e.sdS(4),t=e.sdS(6);e.R7$(2),e.Y8G("ngIf",!o.altType)("ngIfThen",i)("ngIfElse",t)}}function G(n,l){1&n&&e.EFF(0," not implemented\n")}let P=(()=>{var n;class l{constructor(i){this.modalController=i}ngOnInit(){}isValid(){return this.inputs.every(i=>{var t;return!(null!==(t=i.attributes)&&void 0!==t&&t.required)||i.value})}dismiss(i){this.modalController.dismiss({data:this.getFormData()},i?"confirm":"cancel")}confirm(){this.isValid()&&this.dismiss(!0)}getFormData(){const i={};return this.inputs.forEach(t=>{i[t.name]=t.value}),i}}return(n=l).\u0275fac=function(i){return new(i||n)(e.rXU(a.W3))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-input-modal"]],inputs:{title:"title",message:"message",inputs:"inputs"},decls:18,vars:5,consts:[["notImplementedType",""],["type",""],["altType",""],["dropdownType",""],[3,"fullscreen"],[1,"mx-2"],[4,"ngFor","ngForOf"],["slot","start"],[3,"click"],["slot","end"],[3,"click","disabled"],[4,"ngIf","ngIfThen","ngIfElse"],["required","","labelPlacement","stacked",3,"ngModelChange","ngModel","type","label","placeholder"],["color","danger",4,"ngIf"],["color","danger"],["justify","start","interface","action-sheet",3,"ngModelChange","label","placeholder","value","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(i,t){if(1&i){const r=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3),e.k0s()()(),e.j41(4,"ion-content",4)(5,"p",5),e.EFF(6),e.k0s(),e.DNE(7,F,7,3,"div",6),e.k0s(),e.j41(8,"ion-footer")(9,"ion-toolbar")(10,"ion-buttons",7)(11,"ion-button",8),e.bIt("click",function(){return e.eBV(r),e.Njj(t.dismiss(!1))}),e.EFF(12,"Cancel"),e.k0s()(),e.j41(13,"ion-buttons",9)(14,"ion-button",10),e.bIt("click",function(){return e.eBV(r),e.Njj(t.confirm())}),e.EFF(15,"Confirm"),e.k0s()()()(),e.DNE(16,G,1,0,"ng-template",null,0,e.C5r)}2&i&&(e.R7$(3),e.JRh(t.title),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(2),e.JRh(t.message),e.R7$(),e.Y8G("ngForOf",t.inputs),e.R7$(7),e.Y8G("disabled",!t.isValid()))},dependencies:[p.Sq,p.bT,u.BC,u.YS,u.vS,a.Jm,a.QW,a.W9,a.M0,a.eU,a.$w,a.uz,a.Nm,a.Ip,a.IO,a.BC,a.ai,a.Je,a.Gw],styles:[".required[_ngcontent-%COMP%]{border-bottom:1px solid red}"]}),l})(),j=(()=>{var n;class l{constructor(i){this.modalController=i}presentInputModal(i,t,r){var c=this;return(0,T.A)(function*(){const d=yield c.modalController.create({component:P,componentProps:{inputs:i,title:t,message:r},cssClass:"small-modal",showBackdrop:!0});yield d.present();const _=yield d.onDidDismiss();return{data:_.data||{},confirmed:"confirm"===_.role}})()}}return(n=l).\u0275fac=function(i){return new(i||n)(e.KVO(a.W3))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();var D=s(9385);let x=(()=>{var n;class l{transform(i,t){return i?i.reduce((r,c)=>r+(c[t]||0),0):0}}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275pipe=e.EJ8({name:"sumProperty",type:n,pure:!1}),l})();function V(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-card-title",16),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.editTitle=!t.editTitle)}),e.EFF(1),e.k0s()}if(2&n){const o=e.XpG();e.R7$(),e.JRh(o.entry.name)}}function $(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-input",17),e.mxI("ngModelChange",function(t){e.eBV(o);const r=e.XpG();return e.DH7(r.entry.name,t)||(r.entry.name=t),e.Njj(t)}),e.k0s()}if(2&n){const o=e.XpG();e.R50("ngModel",o.entry.name),e.Y8G("autofocus",!0)}}function Y(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",18),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.editTitle=!t.editTitle)}),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("name",o.editTitle?"checkmark":"pencil")}}function B(n,l){if(1&n){const o=e.RV6();e.j41(0,"p",16),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.editNote=!t.editNote)}),e.EFF(1),e.k0s()}if(2&n){let o;const i=e.XpG();e.R7$(),e.JRh(null!==(o=i.entry.note)&&void 0!==o?o:"click to add note")}}function O(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-input",19),e.mxI("ngModelChange",function(t){e.eBV(o);const r=e.XpG();return e.DH7(r.entry.note,t)||(r.entry.note=t),e.Njj(t)}),e.k0s()}if(2&n){const o=e.XpG();e.R50("ngModel",o.entry.note),e.Y8G("autofocus",!0)}}function X(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-icon",20),e.bIt("click",function(){e.eBV(o);const t=e.XpG();return e.Njj(t.editNote=!t.editNote)}),e.k0s()}if(2&n){const o=e.XpG();e.Y8G("name",o.editNote?"checkmark":"pencil")}}function U(n,l){if(1&n){const o=e.RV6();e.j41(0,"ion-card",21)(1,"ion-card-content",22)(2,"app-portion",23),e.bIt("onPortionDeleted",function(t){e.eBV(o);const r=e.XpG();return e.Njj(r.removePortion(t))}),e.k0s()()()}if(2&n){const o=l.$implicit;e.R7$(2),e.Y8G("portion",o)("allowDBDeletion",!1)("allowEdit",!1)}}const w=[{path:"",component:(()=>{var n;class l{constructor(i,t,r,c,d,_,f){this.catalogService=i,this.foodLogService=t,this.loadingService=r,this.messageService=c,this.alertService=d,this.modalService=_,this.router=f,this.defaultLog={name:"",portionIds:[],date:(new Date).toISOString()},this.entry={...this.defaultLog},this.editTitle=!0,this.editNote=!1,this.portions=[]}ngOnInit(){this.promptInputModal()}reset(){this.entry={...this.defaultLog},this.portions=[],this.editTitle=!0,this.editNote=!1}openCatalog(){this.catalogService.openFoodCatalog({title:"Select portions to add",callback:this.addSelectedPortions.bind(this),canAddItems:!0,canSelectItems:!1,canSelectPortions:!0})}addSelectedPortions(i){var t;this.portions=this.portions.concat(null!==(t=i.returnedPortions)&&void 0!==t?t:[])}removePortion(i){let t=this.portions.map(r=>r.id).indexOf(i.id);this.portions.splice(t,1)}cancel(){this.reset()}confirm(){this.entry.carbs=this.countCarbs(this.portions),this.entry.portionIds=this.portions.map(i=>i.id).filter(i=>null!=i),this.entry.date=(new Date).toISOString(),this.validate(this.entry)&&this.loadingService.addToQueue(this.foodLogService.saveItemToDB(this.entry).then(i=>{this.reset(),this.messageService.display("Entry saved!"),this.promptNavigation()}))}promptNavigation(){this.alertService.promptConfirmation("View entries","Would you like to view your new log on the entry log page?","no","yes").then(i=>{i&&this.router.navigateByUrl("/view-entries")})}validate(i){var t;let r=!0;return i.name?null==i.portionIds||(null===(t=i.portionIds)||void 0===t?void 0:t.length)<=0?(r=!1,this.alertService.simpleError("Entries cannot be created without portions","Entry invalid"),!1):r:(r=!1,this.alertService.simpleError("Entry must have a name","Entry invalid"),!1)}countCarbs(i){return i.reduce((t,r)=>t+(r.carbs||0),0)}promptInputModal(){let i=[{altType:"dropdown",options:{choices:["Breakfast","Lunch","Dinner","Morning snack","Afternoon snack","Other"]},value:this.getDefaultEntryName(),name:"entryName",label:"entry type",placeholder:"entry name eg. 'lunch'",attributes:{required:!0}},{name:"note",label:"note",placeholder:"note eg. 'small lunch'"}];this.modalService.presentInputModal(i,"Enter details","Add info for new entry").then(t=>{if(t.confirmed){let r=t.data.data,c=r.entryName,d=r.note;this.entry.name=null==c||""==c?null:c,this.entry.note=null==d||""==d?null:d,this.editTitle=null==this.entry.name,this.openCatalog()}})}promptInput(){this.alertService.promptInput("Enter details","Add info for new entry",[{name:"entryName",label:"entry name",placeholder:"entry name eg. 'lunch'",attributes:{required:!0,autofocus:!0}},{name:"note",placeholder:"note eg. 'small lunch'"}]).then(t=>{let r=t.entryName,c=t.note;this.entry.name=null==r||""==r?null:r,this.entry.note=null==c||""==c?null:c,this.editTitle=null==this.entry.name,this.openCatalog()})}getDefaultEntryName(){let i="";const t=(new Date).getHours();return i=t>=5&&t<10?"Breakfast":t>=12&&t<16?"Lunch":t>=18&&t<22?"Dinner":t>=10&&t<12?"Morning Snack":t>=16&&t<18?"Afternoon Snack":"Other",i}}return(n=l).\u0275fac=function(i){return new(i||n)(e.rXU(h.H),e.rXU(y.i),e.rXU(v.U),e.rXU(E.b),e.rXU(I.u),e.rXU(j),e.rXU(m.Ix))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-add-entry"]],decls:34,vars:14,consts:[[3,"translucent"],["slot","start"],["size","large"],[3,"fullscreen"],["mode","ios"],[3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","large",3,"name","click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","add any extra information","size","large",3,"ngModel","autofocus","ngModelChange",4,"ngIf"],["size","small",3,"name","click",4,"ngIf"],["class","portion-card",4,"ngFor","ngForOf"],["lines","none",3,"click"],["name","add","size","large","color","primary"],["slot","end"],["color","medium",3,"click"],[3,"click","strong"],[3,"click"],["fill","outline","type","text","placeholder","entry name, eg. 'Lunch'","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","large",3,"click","name"],["fill","outline","type","text","placeholder","add any extra information","size","large",1,"enhanced-visibility",3,"ngModelChange","ngModel","autofocus"],["size","small",3,"click","name"],[1,"portion-card"],[1,"no-padding"],[3,"onPortionDeleted","portion","allowDBDeletion","allowEdit"]],template:function(i,t){1&i&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-title",2),e.EFF(5,"Add Entry"),e.k0s()()(),e.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header",4)(9,"ion-row"),e.DNE(10,V,2,1,"ion-card-title",5)(11,$,1,2,"ion-input",6)(12,Y,1,1,"ion-icon",7),e.k0s()(),e.j41(13,"ion-card-content")(14,"ion-row"),e.DNE(15,B,2,1,"p",5)(16,O,1,2,"ion-input",8)(17,X,1,1,"ion-icon",9),e.k0s(),e.DNE(18,U,3,3,"ion-card",10),e.j41(19,"ion-item",11),e.bIt("click",function(){return t.openCatalog()}),e.nrm(20,"ion-icon",12),e.j41(21,"ion-label"),e.EFF(22,"Add portion "),e.k0s()()()()(),e.j41(23,"ion-footer")(24,"ion-toolbar")(25,"p")(26,"b"),e.EFF(27),e.nI1(28,"sumProperty"),e.k0s()(),e.j41(29,"ion-buttons",13)(30,"ion-button",14),e.bIt("click",function(){return t.cancel()}),e.EFF(31," Cancel "),e.k0s(),e.j41(32,"ion-button",15),e.bIt("click",function(){return t.confirm()}),e.EFF(33,"Confirm"),e.k0s()()()()),2&i&&(e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(4),e.Y8G("ngIf",!t.editTitle),e.R7$(),e.Y8G("ngIf",t.editTitle),e.R7$(),e.Y8G("ngIf",t.entry.name),e.R7$(3),e.Y8G("ngIf",!t.editNote),e.R7$(),e.Y8G("ngIf",t.editNote),e.R7$(),e.Y8G("ngIf",t.editNote),e.R7$(),e.Y8G("ngForOf",t.portions),e.R7$(9),e.SpI("",e.i5U(28,11,t.portions,"carbs"),"g Carbs"),e.R7$(5),e.Y8G("strong",!0))},dependencies:[p.Sq,p.bT,u.BC,u.vS,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.W9,a.M0,a.eU,a.iq,a.$w,a.uz,a.he,a.MC,a.ln,a.BC,a.ai,a.Gw,D.x,x]}),l})()}];let K=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.iI.forChild(w),m.iI]}),l})();var L=s(1815),z=s(4683);let H=(()=>{var n;class l{}return(n=l).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.MD,u.YN,a.bv,K,L.U,z.Y]}),l})()}}]);