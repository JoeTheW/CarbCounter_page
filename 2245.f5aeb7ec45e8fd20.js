"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2245],{9385:(O,F,h)=>{h.d(F,{x:()=>R});var o=h(4438),b=h(2038),s=h(5293),S=h(4569),e=h(4988),v=h(177),M=h(4341),C=h(3819),k=h(9601);function D(_,I){if(1&_&&(o.j41(0,"h1"),o.EFF(1),o.k0s()),2&_){const a=o.XpG(2);o.R7$(),o.JRh(a.portionModel.name)}}function T(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-input",15),o.mxI("ngModelChange",function(p){o.eBV(a);const f=o.XpG(2);return o.DH7(f.portionModel.name,p)||(f.portionModel.name=p),o.Njj(p)}),o.bIt("ionInput",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.markModelChanged())}),o.k0s()}if(2&_){const a=o.XpG(2);o.R50("ngModel",a.portionModel.name)}}function P(_,I){if(1&_&&(o.j41(0,"h2"),o.EFF(1),o.k0s()),2&_){let a;const u=o.XpG(2);o.R7$(),o.JRh(null!==(a=u.portionModel.note)&&void 0!==a?a:"-")}}function x(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-input",16),o.mxI("ngModelChange",function(p){o.eBV(a);const f=o.XpG(2);return o.DH7(f.portionModel.note,p)||(f.portionModel.note=p),o.Njj(p)}),o.bIt("ionInput",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.markModelChanged())}),o.k0s()}if(2&_){const a=o.XpG(2);o.R50("ngModel",a.portionModel.note)}}function G(_,I){if(1&_&&(o.j41(0,"h2"),o.EFF(1),o.k0s()),2&_){const a=o.XpG(2);o.R7$(),o.SpI("",a.portionModel.carbs,"g")}}function w(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-button",17),o.bIt("click",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.adjustCarbs(-5))}),o.nrm(1,"ion-icon",18),o.k0s()}}function B(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-input",19),o.mxI("ngModelChange",function(p){o.eBV(a);const f=o.XpG(2);return o.DH7(f.portionModel.carbs,p)||(f.portionModel.carbs=p),o.Njj(p)}),o.bIt("ionInput",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.markModelChanged())}),o.k0s()}if(2&_){const a=o.XpG(2);o.R50("ngModel",a.portionModel.carbs)}}function E(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-button",20),o.bIt("click",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.adjustCarbs(5))}),o.nrm(1,"ion-icon",21),o.k0s()}}function j(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-button",22),o.bIt("click",function(){o.eBV(a);const p=o.XpG(2);return o.Njj(p.selectPortion())}),o.EFF(1," Select "),o.k0s()}}function y(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-button",26),o.bIt("click",function(){o.eBV(a);const p=o.XpG(3);return o.Njj(p.changeEditMode())}),o.nrm(1,"ion-icon",27),o.k0s()}if(2&_){const a=o.XpG(3);o.Y8G("disabled",a.editMode&&!a.portionModel.name),o.R7$(),o.Y8G("name",a.editMode?"save":"pencil")}}function N(_,I){if(1&_&&(o.j41(0,"ion-col",23)(1,"div",24),o.DNE(2,y,2,2,"ion-button",25),o.k0s()()),2&_){const a=o.XpG(2);o.R7$(2),o.Y8G("ngIf",a.portionModel.id)}}function X(_,I){if(1&_){const a=o.RV6();o.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",1),o.nrm(3,"app-catalog-item",2),o.k0s(),o.j41(4,"ion-col")(5,"p"),o.EFF(6),o.k0s(),o.j41(7,"ion-row"),o.DNE(8,D,2,1,"h1",0)(9,T,1,1,"ion-input",3),o.k0s(),o.j41(10,"ion-row"),o.DNE(11,P,2,1,"h2",0)(12,x,1,1,"ion-input",4),o.k0s(),o.j41(13,"ion-row",5),o.DNE(14,G,2,1,"h2",0),o.j41(15,"ion-col",1),o.DNE(16,w,2,0,"ion-button",6),o.k0s(),o.j41(17,"ion-col"),o.DNE(18,B,1,1,"ion-input",7),o.k0s(),o.j41(19,"ion-col",1),o.DNE(20,E,2,0,"ion-button",8),o.k0s()()()(),o.j41(21,"ion-row")(22,"ion-col",9)(23,"div",10)(24,"ion-button",11),o.bIt("click",function(){o.eBV(a);const p=o.XpG();return o.Njj(p.deletePortion())}),o.nrm(25,"ion-icon",12),o.k0s()()(),o.DNE(26,j,2,0,"ion-button",13)(27,N,3,1,"ion-col",14),o.k0s()()}if(2&_){const a=o.XpG();o.R7$(3),o.Y8G("item",a.tempItem)("clickable",!1)("showTitle",!1)("showIcons",!1)("animate",!1)("overlayIcon",a.editMode?"camera":""),o.R7$(3),o.JRh(a.catalogItemName),o.R7$(2),o.Y8G("ngIf",!a.editMode),o.R7$(),o.Y8G("ngIf",a.editMode),o.R7$(2),o.Y8G("ngIf",!a.editMode),o.R7$(),o.Y8G("ngIf",a.editMode),o.R7$(2),o.Y8G("ngIf",!a.editMode),o.R7$(2),o.Y8G("ngIf",a.editMode),o.R7$(2),o.Y8G("ngIf",a.editMode),o.R7$(2),o.Y8G("ngIf",a.editMode),o.R7$(6),o.Y8G("ngIf",a.canSelectPortions&&a.portion.id&&!a.editMode),o.R7$(),o.Y8G("ngIf",a.allowEdit)}}let R=(()=>{var _;class I{constructor(u,p,f,V){this.loadingService=u,this.portionService=p,this.catalogService=f,this.alertService=V,this.allowDBDeletion=!1,this.allowEdit=!1,this.canSelectPortions=!1,this.onPortionDeleted=new o.bkB,this.onPortionSelected=new o.bkB,this.editMode=!1,this.modelChanged=!1,this.tempItem={name:"temp"}}ngOnInit(){!this.portion&&this.portionId?this.loadingService.addToQueue(this.portionService.getByKey(this.portionId).then(u=>{u?(this.portion=u,this.setup()):this.missingPortionData(this.portionId)})):this.setup()}missingPortionData(u){this.portion={name:"deleted",catalogItemId:-1,carbs:0,note:"portion deleted"},this.portionModel={...this.portion}}setup(){this.portionModel=this.cloneItem(this.portion),this.tempItem.image=this.portion.image,""===this.portionModel.name?(this.editMode=!0,this.getCatalogItemName().then(u=>{this.catalogItemName=u,this.portionModel.name=u})):this.getCatalogItemName().then(u=>this.catalogItemName=u)}getCatalogItemName(){return this.catalogService.getPropertyByKey(this.portion.catalogItemId,"name")}cloneItem(u){return{...u}}markModelChanged(){this.modelChanged=!0}changeEditMode(){this.editMode&&this.savePortion(),this.editMode=!this.editMode}savePortion(){this.portion=this.cloneItem(this.portionModel),this.loadingService.addToQueue(this.portionService.saveItemToDB(this.portion).then(u=>{this.portion=u}))}adjustCarbs(u){var p;let f=null!==(p=this.portionModel.carbs)&&void 0!==p?p:0;f+=u,f=Math.max(f,0),this.portionModel.carbs=f}deletePortion(){this.allowDBDeletion?this.alertService.promptConfirmation("Confirm","are you sure you want to delete this portion?","no","yes").then(u=>{u&&this.loadingService.addToQueue(this.portionService.deleteEntityFromDB(this.portion.id).then(()=>{this.onPortionDeleted.emit(this.portion)}))}):this.onPortionDeleted.emit(this.portion)}selectPortion(){this.onPortionSelected.emit(this.portion)}}return(_=I).\u0275fac=function(u){return new(u||_)(o.rXU(b.U),o.rXU(s.t),o.rXU(S.H),o.rXU(e.u))},_.\u0275cmp=o.VBU({type:_,selectors:[["app-portion"]],inputs:{portion:"portion",portionId:"portionId",listPosition:"listPosition",allowDBDeletion:"allowDBDeletion",allowEdit:"allowEdit",canSelectPortions:"canSelectPortions"},outputs:{onPortionDeleted:"onPortionDeleted",onPortionSelected:"onPortionSelected"},decls:1,vars:1,consts:[[4,"ngIf"],["size","auto"],[3,"item","clickable","showTitle","showIcons","animate","overlayIcon"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter name",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter note",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],[1,"flex","flex-row","align-items-center","gap-2"],["shape","round","color","danger","fill","clear",3,"click",4,"ngIf"],["class","enhanced-visibility","fill","outline","type","number","placeholder","enter carbs",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],["shape","round","color","success","fill","clear",3,"click",4,"ngIf"],[1,"flex","justify-content-start"],[1,"flex","align-items-start"],["item-start","","fill","clear","color","danger",3,"click"],["slot","icon-only","name","trash"],["size","small","shape","round","color","warning","fill","outline",3,"click",4,"ngIf"],["class","flex justify-content-end",4,"ngIf"],["fill","outline","type","text","placeholder","enter name",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["fill","outline","type","text","placeholder","enter note",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","danger","fill","clear",3,"click"],["slot","icon-only","name","remove","size","small"],["fill","outline","type","number","placeholder","enter carbs",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],["shape","round","color","success","fill","clear",3,"click"],["slot","icon-only","name","add","size","small"],["size","small","shape","round","color","warning","fill","outline",3,"click"],[1,"flex","justify-content-end"],[1,"flex","align-items-end"],["item-end","","fill","clear","color","medium",3,"disabled","click",4,"ngIf"],["item-end","","fill","clear","color","medium",3,"click","disabled"],["slot","icon-only",3,"name"]],template:function(u,p){1&u&&o.DNE(0,X,28,17,"ion-grid",0),2&u&&o.Y8G("ngIf",p.portionModel)},dependencies:[v.bT,M.BC,M.vS,C.Jm,C.hU,C.lO,C.iq,C.$w,C.ln,C.su,C.Gw,k.I]}),I})()},2245:(O,F,h)=>{h.r(F),h.d(F,{FoodCatalogPageModule:()=>oe});var o=h(177),b=h(4341),s=h(3819),S=h(9858),e=h(4438),v=h(529),M=h(4569);function C(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-button",3),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.editMode=!n.editMode)}),e.nrm(1,"ion-icon",7),e.k0s()}if(2&i){const l=e.XpG();e.R7$(),e.Y8G("name",l.editMode?"refresh":"pencil")}}let k=(()=>{var i;class d{constructor(t){this.modalController=t,this.editMode=!1,this.reloadRequired=!1,this.canSelectItems=!1,this.canSelectPortions=!1,this.returnData={itemConverted:!1}}ngOnInit(){this.catalogItemOriginal=this.cloneItem(this.catalogItem)}cancel(){return this.modalController.dismiss(this.constructReturnData("cancel"))}close(){return this.modalController.dismiss(this.constructReturnData("close"))}confirm(){return this.modalController.dismiss(this.constructReturnData("confirm"))}itemDeleted(){return this.modalController.dismiss(this.constructReturnData("deleted"))}itemSelected(t){return this.modalController.dismiss(this.constructReturnData("itemSelected"))}portionSelected(t){return this.returnData.portion=t,this.modalController.dismiss(this.constructReturnData("portionSelected"))}folderConverted(t){return this.returnData.convertedFolder=t,this.modalController.dismiss(this.constructReturnData("folderConversion"))}constructReturnData(t){let n={...this.returnData};return n.action=t,n.returnedItem=this.catalogItem,n.itemConverted=this.itemHasConverted(),n}itemHasConverted(){return this.catalogItemOriginal!=this.catalogItem&&this.catalogItemOriginal.isFolder!=this.catalogItem.isFolder}cloneItem(t){return{...t}}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-item-details-modal"]],decls:16,vars:7,consts:[["slot","start"],["color","medium",3,"click",4,"ngIf"],["slot","end"],["color","medium",3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[3,"itemChange","onItemDeleted","onItemSelected","onPortionSelected","editModeChange","onFolderConversion","item","editMode","canSelectItems","canSelectPortions"],[3,"name"]],template:function(t,n){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.DNE(3,C,2,1,"ion-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s(),e.j41(6,"ion-buttons",2)(7,"ion-button",3),e.bIt("click",function(){return n.close()}),e.nrm(8,"ion-icon",4),e.k0s()()()(),e.j41(9,"ion-content",5)(10,"app-item-details",6),e.mxI("itemChange",function(c){return e.DH7(n.catalogItem,c)||(n.catalogItem=c),c}),e.bIt("onItemDeleted",function(){return n.itemDeleted()})("onItemSelected",function(c){return n.itemSelected(c)})("onPortionSelected",function(c){return n.portionSelected(c)}),e.mxI("editModeChange",function(c){return e.DH7(n.editMode,c)||(n.editMode=c),c}),e.bIt("onFolderConversion",function(c){return n.folderConverted(c)}),e.k0s()(),e.j41(11,"ion-footer")(12,"ion-toolbar")(13,"ion-buttons",2)(14,"ion-button",3),e.bIt("click",function(){return n.close()}),e.EFF(15," Close "),e.k0s()()()()),2&t&&(e.R7$(3),e.Y8G("ngIf",n.catalogItem.id),e.R7$(2),e.JRh(n.catalogItem.name),e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(),e.R50("item",n.catalogItem)("editMode",n.editMode),e.Y8G("canSelectItems",n.canSelectItems)("canSelectPortions",n.canSelectPortions))}}),d})();var D=h(2038),T=h(4988),P=h(9601);function x(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-breadcrumb",6),e.bIt("click",function(){const n=e.eBV(l),r=n.$implicit,c=n.index,m=e.XpG(2);return e.Njj(m.navigateBreadcrumb(r,c))}),e.EFF(1),e.nrm(2,"ion-icon",7),e.k0s()}if(2&i){const l=d.$implicit;e.R7$(),e.SpI(" ",null==l.item?"Home":l.item.name," ")}}function G(i,d){if(1&i&&(e.j41(0,"ion-breadcrumbs",4),e.DNE(1,x,3,1,"ion-breadcrumb",5),e.k0s()),2&i){const l=e.XpG();e.R7$(),e.Y8G("ngForOf",l.breadcrumbs)}}function w(i,d){if(1&i){const l=e.RV6();e.j41(0,"span")(1,"app-catalog-item",8),e.bIt("onItemClicked",function(){const n=e.eBV(l).$implicit,r=e.XpG();return e.Njj(r.itemClicked(n))}),e.k0s()()}if(2&i){const l=d.$implicit;e.R7$(),e.Y8G("item",l)}}function B(i,d){if(1&i){const l=e.RV6();e.j41(0,"span")(1,"app-catalog-item",9),e.bIt("onItemClicked",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.addItem())}),e.k0s()()}if(2&i){const l=e.XpG();e.R7$(),e.Y8G("item",l.emptyItem)("clickable",!0)("showTitle",!1)("showIcons",!1)("animate",!1)}}function E(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"div",10)(3,"ion-button",11),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.selectFolder())}),e.EFF(4," Select folder "),e.k0s()()()()}2&i&&(e.R7$(3),e.Y8G("strong",!0))}let j=(()=>{var i;class d{constructor(t,n,r,c,m){this.messageService=t,this.catalogService=n,this.modalController=r,this.loadingService=c,this.alertService=m,this.canSelectItems=!1,this.canSelectPortions=!1,this.canAddItems=!0,this.onItemSelected=new e.bkB,this.onPortionSelected=new e.bkB,this.onSelectionComplete=new e.bkB,this.allItems=[],this.filteredItems=[],this.searchTerm="",this.currentSegment="ALL",this.breadcrumbs=[{}],this.emptyItem={name:"",colour:"#000000"}}ngOnInit(){this.catalogService.dataReady.subscribe(t=>{t&&this.loadAllItems()})}loadAllItems(){this.loadingService.addToQueue(this.catalogService.getAll().then(t=>{this.allItems=t,this.filter()}))}navigateBreadcrumb(t,n){n>=this.breadcrumbs.length-1?t.item?this.viewItem({item:t.item}):this.exitBreadcrumbs():null==t.item?this.exitBreadcrumbs():(this.breadcrumbs=this.breadcrumbs.slice(0,n+1),this.currentFolder=t.item,this.filter())}exitBreadcrumbs(){this.breadcrumbs=[this.breadcrumbs[0]],this.currentFolder=void 0,this.filter()}itemClicked(t){t.isFolder?this.folderChanged(t):this.viewItem({item:t,canSelectItem:this.canSelectItems,canSelectPortion:this.canSelectPortions})}folderChanged(t){this.currentFolder=t,this.breadcrumbs.push({item:t}),this.filter()}handleSegmentChanged(t){this.currentSegment=t,this.filter()}handleSearchTermChanged(t){this.searchTerm=t,this.filter()}filter(){let t=this.filterByFolder(this.allItems);t=this.filterBySegment(t),t=this.filterBySearch(t),t=this.sortCatalog(t),this.filteredItems=t}filterBySegment(t){let r=null;switch(this.currentSegment){case"ALL":r=function(m){return!0};break;case"FAV":r=function(m){return m.isFavourite};break;case"GROUP":r=function(m){return m.isGroup};break;case"FOLDER":r=function(m){return m.isFolder}}let c=[];return c=t.filter(r),c}filterBySearch(t){let n=this.searchTerm,r=t;return""!=n&&(r=r.filter(c=>c.name.toLowerCase().includes(n))),r}filterByFolder(t){if(null==this.currentFolder)return t;let n=t;if(null==this.currentFolder.childIds)n=[];else{let r=this.currentFolder.childIds;n=n.filter(c=>null!=c.id&&r.includes(c.id))}return n}sortCatalog(t){let n=t;return n=n.sort(function(r,c){var m=r.name.toUpperCase(),g=c.name.toUpperCase();return m<g?-1:m>g?1:0}),n=n.sort((r,c)=>{var m,g;return Number(null!==(m=c.isFavourite)&&void 0!==m&&m)-Number(null!==(g=r.isFavourite)&&void 0!==g&&g)}),n}viewItem(t){this.modalController.create({component:k,showBackdrop:!0,backdropDismiss:!1,canDismiss:(n,r)=>new Promise(c=>{this.handleModalClosed(t.item,n),c(!0)}),componentProps:{catalogItem:t.item,editMode:t.editMode,canSelectItems:t.canSelectItem,canSelectPortions:t.canSelectPortion}}).then(n=>{n.present()})}handleModalClosed(t,n){var r,c;let m=n;if(n){switch(n.action){case"close":case"cancel":console.log("Closed",m),this.createOrUpdateItem(t,m.returnedItem);break;case"confirm":console.log("Confirmed",m),this.createOrUpdateItem(t,m.returnedItem);break;case"deleted":console.log("Item deleted"),this.itemDeleted(t);break;case"folderConversion":this.handleItemConvertedToNewFolder(t,m);break;case"itemSelected":this.onItemSelected.emit(t),this.loadAllItems();break;case"portionSelected":this.onPortionSelected.emit(m.portion),this.promptPortionSelectionCompleted(),this.loadAllItems();break;default:console.log("Dismissed",m),this.createOrUpdateItem(t,m.returnedItem)}m.itemConverted&&(null===(r=this.currentFolder)||void 0===r?void 0:r.id)===(null===(c=m.returnedItem)||void 0===c?void 0:c.id)&&this.exitBreadcrumbs()}else this.ngOnInit()}createOrUpdateItem(t,n){this.allItems.includes(t)?this.updateItem(t,n):this.addNewItemToList(n)}updateItem(t,n){if(null==n)return;let r=this.filteredItems.indexOf(t);this.filteredItems[r]=n;let c=this.allItems.indexOf(t);this.allItems[c]=n;let g=this.breadcrumbs.map(ne=>ne.item).indexOf(t);-1!=g&&(this.breadcrumbs[g].item=n)}addNewItemToList(t){t&&null!=t.id&&(this.allItems.push(t),null!=this.currentFolder?this.addItemsToFolder([t],this.currentFolder):this.filter())}addItemsToFolder(t,n){var r;let c=t.map(m=>{var g;return null!==(g=m.id)&&void 0!==g?g:-1});c=Array.from(new Set(c)),null===(r=n.childIds)||void 0===r||r.push(...c),n.childIds=Array.from(new Set(n.childIds)),this.loadingService.addToQueue(this.catalogService.saveItemToDB(n).then(m=>{this.filter()}))}resetFilters(){this.exitBreadcrumbs()}addItem(){this.currentFolder?this.alertService.promptDecision("Choice","","Create new item or add existing item to folder?",[{text:"cancel",role:"cancel"},{text:"create",role:"create"},{text:"add existing",role:"addExisting"}]).then(t=>{switch(t){case"create":this.addNewItem();break;case"addExisting":this.catalogService.openFoodCatalog({title:"Select items to add",callback:this.addSelectedItemsToFolder.bind(this),canAddItems:!1,canSelectItems:!0});break;default:return}}):this.addNewItem()}addSelectedItemsToFolder(t){var n;let r=null!==(n=t.returnedItems)&&void 0!==n?n:[];null!=r&&r.length>0&&this.currentFolder&&(console.log("Adding items to folder",r),this.addItemsToFolder(r,this.currentFolder))}addNewItem(){this.viewItem({item:{name:""},editMode:!0,canSelectItem:this.canSelectItems,canSelectPortion:this.canSelectPortions})}itemDeleted(t){let n=this.filteredItems.indexOf(t);this.filteredItems.splice(n,1);let r=this.allItems.indexOf(t);this.allItems.splice(r,1);let m=this.breadcrumbs.map(g=>g.item).indexOf(t);if(-1!=m){this.breadcrumbs.splice(m,1);let g=this.breadcrumbs.length-1;this.navigateBreadcrumb(this.breadcrumbs[g],g)}}handleItemConvertedToNewFolder(t,n){if(null!=this.currentFolder){var r,c,m;let g=null===(r=this.currentFolder.childIds)||void 0===r?void 0:r.indexOf(null!==(c=t.id)&&void 0!==c?c:-1);null===(m=this.currentFolder.childIds)||void 0===m||m.splice(g,1),this.createOrUpdateItem(this.currentFolder,this.currentFolder)}this.createOrUpdateItem(t,n.returnedItem),n.convertedFolder&&this.createOrUpdateItem(n.convertedFolder,n.convertedFolder)}selectFolder(t){this.onItemSelected.emit(t=t||this.currentFolder)}promptPortionSelectionCompleted(){this.alertService.promptConfirmation("Add more?","Would you like to add more portions or are you done?","done","add more",!1).then(t=>{t||this.onSelectionComplete.emit()})}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(v.b),e.rXU(M.H),e.rXU(s.W3),e.rXU(D.U),e.rXU(T.u))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-food-catalog"]],inputs:{canSelectItems:"canSelectItems",canSelectPortions:"canSelectPortions",canAddItems:"canAddItems"},outputs:{onItemSelected:"onItemSelected",onPortionSelected:"onPortionSelected",onSelectionComplete:"onSelectionComplete"},decls:5,vars:4,consts:[["color","primary",4,"ngIf"],[1,"flex","flex-wrap","justify-content-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],["color","primary"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","icon-only","name","star",1,"item-icon"],[1,"px-2","py-1",3,"onItemClicked","item"],["overlayIcon","add",3,"onItemClicked","item","clickable","showTitle","showIcons","animate"],[1,"flex","align-content-center","justify-content-center"],["color","warning","fill","outline",3,"click","strong"]],template:function(t,n){1&t&&(e.DNE(0,G,2,1,"ion-breadcrumbs",0),e.j41(1,"div",1),e.DNE(2,w,2,1,"span",2)(3,B,2,5,"span",3),e.k0s(),e.DNE(4,E,5,1,"ion-footer",3)),2&t&&(e.Y8G("ngIf",n.breadcrumbs.length>1),e.R7$(2),e.Y8G("ngForOf",n.filteredItems),e.R7$(),e.Y8G("ngIf",n.canAddItems),e.R7$(),e.Y8G("ngIf",n.canSelectItems))},dependencies:[o.Sq,o.bT,s.a6,s.dQ,s.Jm,s.M0,s.iq,s.ai,P.I]}),d})();function y(i,d){1&i&&(e.j41(0,"ion-buttons",13),e.nrm(1,"ion-menu-button"),e.k0s())}function N(i,d){1&i&&(e.j41(0,"ion-buttons",14)(1,"ion-button"),e.nrm(2,"ion-icon",15),e.k0s()())}function X(i,d){if(1&i&&(e.j41(0,"ion-toolbar"),e.DNE(1,y,2,0,"ion-buttons",10)(2,N,3,0,"ion-buttons",11),e.j41(3,"ion-title",12),e.EFF(4,"Food Catalog"),e.k0s()()),2&i){const l=e.XpG();e.R7$(),e.Y8G("ngIf","full"===l.headerMode),e.R7$(),e.Y8G("ngIf","mid"===l.headerMode),e.R7$(),e.Y8G("size","full"===l.headerMode?"large":"medium")}}let R=(()=>{var i;class d{onSegmentChange(t){null!=t&&null!=t.detail&&null!=t.detail.value&&""!=t.detail.value&&(this.currentSegment=t.detail.value,this.segmentChanged.emit(this.currentSegment))}constructor(){this.headerMode="full",this.currentSegment="ALL",this.segmentChanged=new e.bkB}ngOnInit(){}}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-food-catalog-header"]],inputs:{headerMode:"headerMode"},outputs:{segmentChanged:"segmentChanged"},decls:19,vars:2,consts:[[4,"ngIf"],["value","all","mode","md","scrollable","true",3,"ngModelChange","ionChange","ngModel"],["value","ALL"],["name","home"],["value","FAV"],["name","star"],["value","FOLDER"],["name","folder"],["value","GROUP"],["name","grid"],["slot","start",4,"ngIf"],["slot","end",4,"ngIf"],[3,"size"],["slot","start"],["slot","end"],["name","close"]],template:function(t,n){1&t&&(e.DNE(0,X,5,3,"ion-toolbar",0),e.j41(1,"ion-toolbar")(2,"ion-segment",1),e.mxI("ngModelChange",function(c){return e.DH7(n.currentSegment,c)||(n.currentSegment=c),c}),e.bIt("ionChange",function(c){return n.onSegmentChange(c)}),e.j41(3,"ion-segment-button",2)(4,"ion-label"),e.EFF(5,"ALL"),e.k0s(),e.nrm(6,"ion-icon",3),e.k0s(),e.j41(7,"ion-segment-button",4)(8,"ion-label"),e.EFF(9,"FAV"),e.k0s(),e.nrm(10,"ion-icon",5),e.k0s(),e.j41(11,"ion-segment-button",6)(12,"ion-label"),e.EFF(13,"FOLDER"),e.k0s(),e.nrm(14,"ion-icon",7),e.k0s(),e.j41(15,"ion-segment-button",8)(16,"ion-label"),e.EFF(17,"GROUP"),e.k0s(),e.nrm(18,"ion-icon",9),e.k0s()()()),2&t&&(e.Y8G("ngIf","none"!==n.headerMode),e.R7$(2),e.R50("ngModel",n.currentSegment))},dependencies:[o.bT,b.BC,b.vS,s.Jm,s.QW,s.iq,s.he,s.MC,s.Gp,s.eP,s.BC,s.ai,s.Je]}),d})(),_=(()=>{var i;class d{onSearchTermChange(t){let n="";null!=t&&null!=t.detail&&null!=t.detail.value&&""!=t.detail.value&&(n=t.detail.value.toLowerCase()),this.searchTerm=n,this.searchTermChanged.emit(this.searchTerm)}constructor(){this.searchTerm="",this.searchTermChanged=new e.bkB}ngOnInit(){}}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-food-catalog-footer"]],outputs:{searchTermChanged:"searchTermChanged"},decls:2,vars:1,consts:[["placeholder","Search for item","show-clear-button","always",3,"ionInput","debounce"]],template:function(t,n){1&t&&(e.j41(0,"ion-toolbar")(1,"ion-searchbar",0),e.bIt("ionInput",function(c){return n.onSearchTermChange(c)}),e.k0s()()),2&t&&(e.R7$(),e.Y8G("debounce",100))},dependencies:[s.S1,s.ai,s.Gw]}),d})();const a=[{path:"",component:(()=>{var i;class d{constructor(t,n){this.messageService=t,this.catalogService=n}ngOnInit(){}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(v.b),e.rXU(M.H))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-food-catalog-page"]],decls:7,vars:2,consts:[["catalog",""],[3,"translucent"],["headerMode","full",3,"segmentChanged"],[3,"fullscreen"],[3,"searchTermChanged"]],template:function(t,n){if(1&t){const r=e.RV6();e.j41(0,"ion-header",1)(1,"app-food-catalog-header",2),e.bIt("segmentChanged",function(m){e.eBV(r);const g=e.sdS(4);return e.Njj(g.handleSegmentChanged(m))}),e.k0s()(),e.j41(2,"ion-content",3),e.nrm(3,"app-food-catalog",null,0),e.k0s(),e.j41(5,"ion-footer")(6,"app-food-catalog-footer",4),e.bIt("searchTermChanged",function(m){e.eBV(r);const g=e.sdS(4);return e.Njj(g.handleSearchTermChanged(m))}),e.k0s()()}2&t&&(e.Y8G("translucent",!0),e.R7$(2),e.Y8G("fullscreen",!0))},dependencies:[s.W9,s.M0,s.eU,j,R,_]}),d})()}];let u=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[S.iI.forChild(a),S.iI]}),d})();var p=h(1815),f=h(8385),V=h(8581),U=h(5293),Y=h(9385);function $(i,d){if(1&i&&(e.j41(0,"p"),e.EFF(1),e.k0s()),2&i){const l=e.XpG();e.R7$(),e.JRh(l.itemModel.name)}}function A(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-input",7),e.mxI("ngModelChange",function(n){e.eBV(l);const r=e.XpG();return e.DH7(r.itemModel.name,n)||(r.itemModel.name=n),e.Njj(n)}),e.bIt("ionInput",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.markModelChanged())}),e.k0s()}if(2&i){const l=e.XpG();e.R50("ngModel",l.itemModel.name)}}function L(i,d){1&i&&(e.j41(0,"ion-badge",8),e.EFF(1,"item"),e.k0s())}function H(i,d){1&i&&(e.j41(0,"ion-badge",8),e.EFF(1,"folder"),e.k0s())}function W(i,d){1&i&&(e.j41(0,"ion-badge"),e.EFF(1,"fav"),e.k0s())}function z(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-row")(1,"div")(2,"ion-input",9),e.mxI("ngModelChange",function(n){e.eBV(l);const r=e.XpG();return e.DH7(r.itemModel.colour,n)||(r.itemModel.colour=n),e.Njj(n)}),e.bIt("ionInput",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.markModelChanged())}),e.k0s()()()}if(2&i){const l=e.XpG();e.R7$(2),e.R50("ngModel",l.itemModel.colour)}}function Q(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-row")(1,"ion-toolbar")(2,"ion-button",10),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.toggleFavourite())}),e.nrm(3,"ion-icon",11),e.k0s(),e.j41(4,"ion-button",12),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.delete())}),e.nrm(5,"ion-icon",13),e.k0s(),e.j41(6,"ion-button",14),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.convertItem())}),e.EFF(7," Convert "),e.nrm(8,"ion-icon",15)(9,"ion-icon",16),e.k0s()()()}if(2&i){const l=e.XpG();e.R7$(2),e.Y8G("color",l.itemModel.isFavourite?"danger":"success"),e.R7$(),e.Y8G("name",l.itemModel.isFavourite?"heart-dislike":"heart"),e.R7$(6),e.Y8G("name",l.itemModel.isFolder?"pizza":"folder")}}function J(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-row")(1,"ion-toolbar")(2,"ion-button",14),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.selectItem())}),e.EFF(3," Select item "),e.k0s()()()}}function K(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-row")(1,"ion-button",17),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.reset())}),e.EFF(2," Reset "),e.k0s(),e.j41(3,"ion-button",18),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.validateSave())}),e.EFF(4," Save "),e.k0s()()}if(2&i){const l=e.XpG();e.R7$(3),e.Y8G("disabled",""==l.itemModel.name)}}function Z(i,d){if(1&i){const l=e.RV6();e.j41(0,"ion-card",20)(1,"ion-card-content",21)(2,"app-portion",24),e.bIt("onPortionDeleted",function(n){e.eBV(l);const r=e.XpG(2);return e.Njj(r.portionDeleted(n))})("onPortionSelected",function(n){e.eBV(l);const r=e.XpG(2);return e.Njj(r.portionSelected(n))}),e.k0s()()()}if(2&i){const l=d.$implicit,t=d.index,n=e.XpG(2);e.R7$(2),e.Y8G("portion",l)("listPosition",t)("canSelectPortions",n.canSelectPortions)("allowEdit",!0)("allowDBDeletion",!0)}}function q(i,d){if(1&i){const l=e.RV6();e.j41(0,"div")(1,"p"),e.EFF(2,"Portions"),e.k0s(),e.DNE(3,Z,3,5,"ion-card",19),e.j41(4,"ion-card",20)(5,"ion-card-content",21)(6,"ion-item",22),e.bIt("click",function(){e.eBV(l);const n=e.XpG();return e.Njj(n.createNewPortion())}),e.nrm(7,"ion-icon",23),e.j41(8,"ion-label"),e.EFF(9,"Add portion "),e.k0s()()()()()}if(2&i){const l=e.XpG();e.R7$(3),e.Y8G("ngForOf",l.portions)}}let ee=(()=>{var i;class d{get item(){return this._item}set item(t){this._item=t,this.reload()}get editMode(){return this._editMode}set editMode(t){this._editMode=t,this.reload()}constructor(t,n,r,c,m){this.catalogService=t,this.loadingService=n,this.messageService=r,this.alertService=c,this.portionService=m,this.itemChange=new e.bkB,this._editMode=!1,this.editModeChange=new e.bkB,this.canSelectItems=!1,this.canSelectPortions=!1,this.onItemDeleted=new e.bkB,this.onItemSelected=new e.bkB,this.onPortionSelected=new e.bkB,this.onFolderConversion=new e.bkB,this.modelChanged=!1,this.existingFolderConversion=!1,this.init=!1}ngOnInit(){this.itemModel=this.cloneItem(this.item),this.portionService.dataReady.subscribe(t=>{t&&this.loadPortions()})}reload(){this.itemModel=this.cloneItem(this.item)}loadPortions(){this.item.id&&this.loadingService.addToQueue(this.portionService.getAllForIndex(V.$I.PORTION_TBL_CATALOG_ITEM_ID,this.item.id).then(t=>{this.portions=t}))}cloneItem(t){return{...t}}colorChanged(){this.markModelChanged()}toggleFavourite(){this.itemModel.isFavourite=!this.itemModel.isFavourite,this.markModelChanged()}convertItem(){this.itemModel.isFolder?this.convertToItem():this.convertToFolder()}convertToFolder(){this.itemModel.isFolder=!0,this.itemModel.childIds=[],this.markModelChanged()}convertToItem(){this.itemModel.isFolder=!1,delete this.itemModel.childIds,this.markModelChanged()}markModelChanged(){this.modelChanged=!0}reset(){this.itemModel=this.cloneItem(this.item),this.modelChanged=!1}validateSave(){this.isExistingItemToFolderConversion()?this.alertService.promptDecision("Choice","","Do you want to keep the original item, and place it within the new folder?",[{text:"cancel",role:"cancel"},{text:"delete",role:"delete"},{text:"keep",role:"keep"}]).then(t=>{var n;switch(t){case"delete":this.save();break;case"keep":let r=this.itemModel.id;delete this.itemModel.id,null===(n=this.itemModel.childIds)||void 0===n||n.push(null!=r?r:-1),this.save(),this.existingFolderConversion=!0;break;default:return}}):this.save()}save(){let t=this.catalogService.saveItemToDB(this.itemModel);this.loadingService.addToQueue(t),t.then(n=>{this.modelChanged=!1,this.item=this.existingFolderConversion?this.item:n,this.itemChange.emit(this.item),this.messageService.display("Item saved!",2,"middle"),this.setEditMode(!1),this.existingFolderConversion&&this.onFolderConversion.emit(n)})}isExistingItemToFolderConversion(){var t;return null!==(t=null!=this.itemModel.id&&this.itemModel.isFolder&&!this.item.isFolder)&&void 0!==t&&t}delete(){this.alertService.promptConfirmation("Confirm","are you sure you want to delete this item?","no","yes").then(t=>{if(t){let n=this.catalogService.deleteEntityFromDB(this.item.id);this.loadingService.addToQueue(n),n.then(()=>{this.onItemDeleted.emit(),this.messageService.display("Item deleted!",3,"middle")})}})}setEditMode(t){this.editMode=t,this.editModeChange.emit(t)}selectItem(){this.onItemSelected.emit(this.item)}portionDeleted(t){let n=this.portions.map(r=>r.id).indexOf(t.id);-1!=n&&this.portions.splice(n,1)}portionSelected(t){this.onPortionSelected.emit(t)}createNewPortion(){this.item.id&&this.loadingService.addToQueue(this.portionService.saveItemToDB({name:"",catalogItemId:this.item.id,image:this.item.image,carbs:0}).then(n=>{this.loadPortions()}))}}return(i=d).\u0275fac=function(t){return new(t||i)(e.rXU(M.H),e.rXU(D.U),e.rXU(v.b),e.rXU(T.u),e.rXU(U.t))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-item-details"]],inputs:{_item:"_item",item:"item",_editMode:"_editMode",editMode:"editMode",canSelectItems:"canSelectItems",canSelectPortions:"canSelectPortions"},outputs:{itemChange:"itemChange",editModeChange:"editModeChange",onItemDeleted:"onItemDeleted",onItemSelected:"onItemSelected",onPortionSelected:"onPortionSelected",onFolderConversion:"onFolderConversion"},decls:19,vars:16,consts:[["size","auto"],[3,"item","clickable","showTitle","showIcons","animate","overlayIcon"],[4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter name",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],[1,"mt-1"],[1,"flex"],["class","mr-2",4,"ngIf"],["fill","outline","type","text","placeholder","enter name",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],[1,"mr-2"],["label","Colour","labelPlacement","stacked","placeholder","Colour","type","color",3,"ngModelChange","ionInput","ngModel"],["shape","round",3,"click","color"],["slot","icon-only",3,"name"],["shape","round","color","danger",3,"click"],["slot","icon-only","name","trash"],["size","small","shape","round","color","warning",3,"click"],["slot","end","name","chevron-forward"],["slot","end",3,"name"],["shape","round","color","warning",3,"click"],["shape","round","color","success",3,"click","disabled"],["class","portion-card",4,"ngFor","ngForOf"],[1,"portion-card"],[1,"no-padding"],["lines","none",3,"click"],["name","add","size","large","color","primary"],[3,"onPortionDeleted","onPortionSelected","portion","listPosition","canSelectPortions","allowEdit","allowDBDeletion"]],template:function(t,n){1&t&&(e.j41(0,"ion-content")(1,"ion-grid")(2,"ion-row")(3,"ion-col",0),e.nrm(4,"app-catalog-item",1),e.k0s(),e.j41(5,"ion-col")(6,"ion-row"),e.DNE(7,$,2,1,"p",2)(8,A,1,1,"ion-input",3),e.k0s(),e.j41(9,"ion-row",4)(10,"div",5),e.DNE(11,L,2,0,"ion-badge",6)(12,H,2,0,"ion-badge",6)(13,W,2,0,"ion-badge",2),e.k0s()(),e.DNE(14,z,3,1,"ion-row",2),e.k0s()(),e.DNE(15,Q,10,3,"ion-row",2)(16,J,4,0,"ion-row",2)(17,K,5,1,"ion-row",2),e.k0s(),e.DNE(18,q,10,1,"div",2),e.k0s()),2&t&&(e.R7$(4),e.Y8G("item",n.itemModel)("clickable",!1)("showTitle",!1)("showIcons",!1)("animate",!1)("overlayIcon",n.editMode?"camera":""),e.R7$(3),e.Y8G("ngIf",!n.editMode),e.R7$(),e.Y8G("ngIf",n.editMode),e.R7$(3),e.Y8G("ngIf",!n.itemModel.isFolder),e.R7$(),e.Y8G("ngIf",n.itemModel.isFolder),e.R7$(),e.Y8G("ngIf",n.itemModel.isFavourite),e.R7$(),e.Y8G("ngIf",n.editMode),e.R7$(),e.Y8G("ngIf",n.editMode),e.R7$(),e.Y8G("ngIf",n.canSelectItems&&!n.editMode&&n.itemModel.id),e.R7$(),e.Y8G("ngIf",n.modelChanged),e.R7$(),e.Y8G("ngIf",!n.itemModel.isFolder))},dependencies:[o.Sq,o.bT,b.BC,b.vS,s.In,s.Jm,s.b_,s.I9,s.hU,s.W9,s.lO,s.iq,s.$w,s.uz,s.he,s.ln,s.ai,s.Gw,P.I,Y.x]}),d})(),te=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[o.MD,b.YN,s.bv,p.U]}),d})();e.wjB(k,[o.bT,s.Jm,s.QW,s.W9,s.M0,s.eU,s.iq,s.BC,s.ai,ee],[]),e.wjB(f.g,[o.bT,s.Jm,s.QW,s.W9,s.M0,s.eU,s.iq,s.BC,s.ai,j,R,_],[]);let oe=(()=>{var i;class d{}return(i=d).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[o.MD,b.YN,s.bv,u,p.U,te]}),d})()}}]);