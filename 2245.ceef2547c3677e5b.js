"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2245],{2245:(le,I,m)=>{m.r(I),m.d(I,{FoodCatalogPageModule:()=>ie});var h=m(177),u=m(4341),r=m(3819),f=m(9858),e=m(4438),p=m(529),g=m(4569);function T(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-button",3),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.editMode=!o.editMode)}),e.nrm(1,"ion-icon",7),e.k0s()}if(2&n){const i=e.XpG();e.R7$(),e.Y8G("name",i.editMode?"refresh":"pencil")}}let C=(()=>{var n;class s{constructor(t){this.modalController=t,this.editMode=!1,this.reloadRequired=!1,this.canSelectItems=!1,this.canSelectPortions=!1,this.returnData={itemConverted:!1}}ngOnInit(){this.catalogItemOriginal=this.cloneItem(this.catalogItem)}cancel(){return this.modalController.dismiss(this.constructReturnData("cancel"))}close(){return this.modalController.dismiss(this.constructReturnData("close"))}confirm(){return this.modalController.dismiss(this.constructReturnData("confirm"))}itemDeleted(){return this.modalController.dismiss(this.constructReturnData("deleted"))}itemSelected(t){return this.modalController.dismiss(this.constructReturnData("itemSelected"))}portionSelected(t){return this.returnData.portion=t,this.modalController.dismiss(this.constructReturnData("portionSelected"))}folderConverted(t){return this.returnData.convertedFolder=t,this.modalController.dismiss(this.constructReturnData("folderConversion"))}constructReturnData(t){let o={...this.returnData};return o.action=t,o.returnedItem=this.catalogItem,o.itemConverted=this.itemHasConverted(),o}itemHasConverted(){return this.catalogItemOriginal!=this.catalogItem&&this.catalogItemOriginal.isFolder!=this.catalogItem.isFolder}cloneItem(t){return{...t}}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(r.W3))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-item-details-modal"]],decls:16,vars:7,consts:[["slot","start"],["color","medium",3,"click",4,"ngIf"],["slot","end"],["color","medium",3,"click"],["name","close"],[1,"ion-padding",3,"fullscreen"],[3,"itemChange","onItemDeleted","onItemSelected","onPortionSelected","editModeChange","onFolderConversion","item","editMode","canSelectItems","canSelectPortions"],[3,"name"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.DNE(3,T,2,1,"ion-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s(),e.j41(6,"ion-buttons",2)(7,"ion-button",3),e.bIt("click",function(){return o.close()}),e.nrm(8,"ion-icon",4),e.k0s()()()(),e.j41(9,"ion-content",5)(10,"app-item-details",6),e.mxI("itemChange",function(a){return e.DH7(o.catalogItem,a)||(o.catalogItem=a),a}),e.bIt("onItemDeleted",function(){return o.itemDeleted()})("onItemSelected",function(a){return o.itemSelected(a)})("onPortionSelected",function(a){return o.portionSelected(a)}),e.mxI("editModeChange",function(a){return e.DH7(o.editMode,a)||(o.editMode=a),a}),e.bIt("onFolderConversion",function(a){return o.folderConverted(a)}),e.k0s()(),e.j41(11,"ion-footer")(12,"ion-toolbar")(13,"ion-buttons",2)(14,"ion-button",3),e.bIt("click",function(){return o.close()}),e.EFF(15," Close "),e.k0s()()()()),2&t&&(e.R7$(3),e.Y8G("ngIf",o.catalogItem.id),e.R7$(2),e.JRh(o.catalogItem.name),e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(),e.R50("item",o.catalogItem)("editMode",o.editMode),e.Y8G("canSelectItems",o.canSelectItems)("canSelectPortions",o.canSelectPortions))}}),s})();var b=m(2038),v=m(4988),F=m(9601);function j(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-breadcrumb",6),e.bIt("click",function(){const o=e.eBV(i),l=o.$implicit,a=o.index,d=e.XpG(2);return e.Njj(d.navigateBreadcrumb(l,a))}),e.EFF(1),e.nrm(2,"ion-icon",7),e.k0s()}if(2&n){const i=s.$implicit;e.R7$(),e.SpI(" ",null==i.item?"Home":i.item.name," ")}}function w(n,s){if(1&n&&(e.j41(0,"ion-breadcrumbs",4),e.DNE(1,j,3,1,"ion-breadcrumb",5),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.breadcrumbs)}}function R(n,s){if(1&n){const i=e.RV6();e.j41(0,"span")(1,"app-catalog-item",8),e.bIt("onItemClicked",function(){const o=e.eBV(i).$implicit,l=e.XpG();return e.Njj(l.itemClicked(o))}),e.k0s()()}if(2&n){const i=s.$implicit;e.R7$(),e.Y8G("item",i)}}function G(n,s){if(1&n){const i=e.RV6();e.j41(0,"span")(1,"app-catalog-item",9),e.bIt("onItemClicked",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.addItem())}),e.k0s()()}if(2&n){const i=e.XpG();e.R7$(),e.Y8G("item",i.emptyItem)("clickable",!0)("showTitle",!1)("showIcons",!1)("animate",!1)}}function P(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"div",10)(3,"ion-button",11),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.selectFolder())}),e.EFF(4," Select folder "),e.k0s()()()()}2&n&&(e.R7$(3),e.Y8G("strong",!0))}let S=(()=>{var n;class s{constructor(t,o,l,a,d){this.messageService=t,this.catalogService=o,this.modalController=l,this.loadingService=a,this.alertService=d,this.canSelectItems=!1,this.canSelectPortions=!1,this.canAddItems=!0,this.onItemSelected=new e.bkB,this.onPortionSelected=new e.bkB,this.onSelectionComplete=new e.bkB,this.segmentChanged=new e.bkB,this.allItems=[],this.filteredItems=[],this.searchTerm="",this.currentSegment="ALL",this.breadcrumbs=[{}],this.emptyItem={name:"",colour:"#000000"}}ngOnInit(){this.catalogService.dataReady.subscribe(t=>{t&&this.loadAllItems()})}loadAllItems(){this.loadingService.addToQueue(this.catalogService.getAll().then(t=>{this.allItems=t,this.filter()}))}navigateBreadcrumb(t,o){o>=this.breadcrumbs.length-1?t.item?this.viewItem({item:t.item}):this.exitBreadcrumbs():null==t.item?this.exitBreadcrumbs():(this.breadcrumbs=this.breadcrumbs.slice(0,o+1),this.currentFolder=t.item,this.filter())}exitBreadcrumbs(){this.breadcrumbs=[this.breadcrumbs[0]],this.currentFolder=void 0,this.filter()}itemClicked(t){t.isFolder?this.folderChanged(t):this.viewItem({item:t,canSelectItem:this.canSelectItems,canSelectPortion:this.canSelectPortions})}folderChanged(t){this.triggerSegmentChanged("ALL"),this.currentFolder=t,this.breadcrumbs.push({item:t}),this.filter()}handleSegmentChanged(t){this.currentSegment=t,this.filter()}triggerSegmentChanged(t){this.handleSegmentChanged(t),this.segmentChanged.emit(t)}handleSearchTermChanged(t){this.searchTerm=t,this.filter()}filter(){let t=this.filterByFolder(this.allItems);t=this.filterBySegment(t),t=this.filterBySearch(t),t=this.sortCatalog(t),this.filteredItems=t}filterBySegment(t){let l=null;switch(this.currentSegment){case"ALL":l=function(d){return!0};break;case"FAV":l=function(d){return d.isFavourite};break;case"FOLDER":l=function(d){return d.isFolder}}let a=[];return a=t.filter(l),a}filterBySearch(t){let o=this.searchTerm,l=t;return""!=o&&(l=l.filter(a=>a.name.toLowerCase().includes(o))),l}filterByFolder(t){if(null==this.currentFolder)return t;let o=t;if(null==this.currentFolder.childIds)o=[];else{let l=this.currentFolder.childIds;o=o.filter(a=>null!=a.id&&l.includes(a.id))}return o}sortCatalog(t){let o=t;return o=o.sort(function(l,a){var d=l.name.toUpperCase(),c=a.name.toUpperCase();return d<c?-1:d>c?1:0}),o=o.sort((l,a)=>{var d,c;return Number(null!==(d=a.isFavourite)&&void 0!==d&&d)-Number(null!==(c=l.isFavourite)&&void 0!==c&&c)}),o}viewItem(t){this.modalController.create({component:C,showBackdrop:!0,backdropDismiss:!1,canDismiss:(o,l)=>new Promise(a=>{this.handleModalClosed(t.item,o),a(!0)}),componentProps:{catalogItem:t.item,editMode:t.editMode,canSelectItems:t.canSelectItem,canSelectPortions:t.canSelectPortion}}).then(o=>{o.present()})}handleModalClosed(t,o){var l,a;let d=o;if(o){switch(o.action){case"close":case"cancel":console.log("Closed",d),this.createOrUpdateItem(t,d.returnedItem);break;case"confirm":console.log("Confirmed",d),this.createOrUpdateItem(t,d.returnedItem);break;case"deleted":console.log("Item deleted"),this.itemDeleted(t);break;case"folderConversion":this.handleItemConvertedToNewFolder(t,d);break;case"itemSelected":this.onItemSelected.emit(t),this.loadAllItems();break;case"portionSelected":this.onPortionSelected.emit(d.portion),this.promptPortionSelectionCompleted(),this.loadAllItems();break;default:console.log("Dismissed",d),this.createOrUpdateItem(t,d.returnedItem)}d.itemConverted&&(null===(l=this.currentFolder)||void 0===l?void 0:l.id)===(null===(a=d.returnedItem)||void 0===a?void 0:a.id)&&this.exitBreadcrumbs()}else this.ngOnInit()}createOrUpdateItem(t,o){this.allItems.includes(t)?this.updateItem(t,o):this.addNewItemToList(o)}updateItem(t,o){if(null==o)return;let l=this.filteredItems.indexOf(t);this.filteredItems[l]=o;let a=this.allItems.indexOf(t);this.allItems[a]=o;let c=this.breadcrumbs.map(_=>_.item).indexOf(t);-1!=c&&(this.breadcrumbs[c].item=o)}addNewItemToList(t){t&&null!=t.id&&(this.allItems.push(t),null!=this.currentFolder?this.addItemsToFolder([t],this.currentFolder):this.filter())}addItemsToFolder(t,o){var l;let a=t.map(d=>{var c;return null!==(c=d.id)&&void 0!==c?c:-1});a=Array.from(new Set(a)),null===(l=o.childIds)||void 0===l||l.push(...a),o.childIds=Array.from(new Set(o.childIds)),this.loadingService.addToQueue(this.catalogService.saveItemToDB(o).then(d=>{this.filter()}))}resetFilters(){this.exitBreadcrumbs()}addItem(){this.currentFolder?this.alertService.promptDecision("Choice","","Create new item or add existing item to folder?",[{text:"cancel",role:"cancel"},{text:"create",role:"create"},{text:"add existing",role:"addExisting"}]).then(t=>{switch(t){case"create":this.addNewItem();break;case"addExisting":this.catalogService.openFoodCatalog({title:"Select items to add",callback:this.addSelectedItemsToFolder.bind(this),canAddItems:!1,canSelectItems:!0});break;default:return}}):this.addNewItem()}addSelectedItemsToFolder(t){var o;let l=null!==(o=t.returnedItems)&&void 0!==o?o:[];null!=l&&l.length>0&&this.currentFolder&&(console.log("Adding items to folder",l),this.addItemsToFolder(l,this.currentFolder))}addNewItem(){this.viewItem({item:{name:""},editMode:!0,canSelectItem:this.canSelectItems,canSelectPortion:this.canSelectPortions})}itemDeleted(t){let o=this.filteredItems.indexOf(t);this.filteredItems.splice(o,1);let l=this.allItems.indexOf(t);this.allItems.splice(l,1);let d=this.breadcrumbs.map(c=>c.item).indexOf(t);if(-1!=d){this.breadcrumbs.splice(d,1);let c=this.breadcrumbs.length-1;this.navigateBreadcrumb(this.breadcrumbs[c],c)}}handleItemConvertedToNewFolder(t,o){if(null!=this.currentFolder){var l,a,d;let c=null===(l=this.currentFolder.childIds)||void 0===l?void 0:l.indexOf(null!==(a=t.id)&&void 0!==a?a:-1);null===(d=this.currentFolder.childIds)||void 0===d||d.splice(c,1),this.createOrUpdateItem(this.currentFolder,this.currentFolder)}this.createOrUpdateItem(t,o.returnedItem),o.convertedFolder&&this.createOrUpdateItem(o.convertedFolder,o.convertedFolder)}selectFolder(t){this.onItemSelected.emit(t=t||this.currentFolder)}promptPortionSelectionCompleted(){this.alertService.promptConfirmation("Add more?","Would you like to add more portions or are you done?","done","add more",!1).then(t=>{t||this.onSelectionComplete.emit()})}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(p.b),e.rXU(g.H),e.rXU(r.W3),e.rXU(b.U),e.rXU(v.u))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-food-catalog"]],inputs:{canSelectItems:"canSelectItems",canSelectPortions:"canSelectPortions",canAddItems:"canAddItems"},outputs:{onItemSelected:"onItemSelected",onPortionSelected:"onPortionSelected",onSelectionComplete:"onSelectionComplete",segmentChanged:"segmentChanged"},decls:5,vars:4,consts:[["color","primary",4,"ngIf"],[1,"flex","flex-wrap","justify-content-center"],[4,"ngFor","ngForOf"],[4,"ngIf"],["color","primary"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["slot","icon-only","name","star",1,"item-icon"],[1,"px-2","py-1",3,"onItemClicked","item"],["overlayIcon","add",3,"onItemClicked","item","clickable","showTitle","showIcons","animate"],[1,"flex","align-content-center","justify-content-center"],["color","warning","fill","outline",3,"click","strong"]],template:function(t,o){1&t&&(e.DNE(0,w,2,1,"ion-breadcrumbs",0),e.j41(1,"div",1),e.DNE(2,R,2,1,"span",2)(3,G,2,5,"span",3),e.k0s(),e.DNE(4,P,5,1,"ion-footer",3)),2&t&&(e.Y8G("ngIf",o.breadcrumbs.length>1),e.R7$(2),e.Y8G("ngForOf",o.filteredItems),e.R7$(),e.Y8G("ngIf",o.canAddItems),e.R7$(),e.Y8G("ngIf",o.canSelectItems))},dependencies:[h.Sq,h.bT,r.a6,r.dQ,r.Jm,r.M0,r.iq,r.ai,F.I]}),s})();function B(n,s){1&n&&(e.j41(0,"ion-buttons",11),e.nrm(1,"ion-menu-button"),e.k0s())}function x(n,s){1&n&&(e.j41(0,"ion-buttons",12)(1,"ion-button"),e.nrm(2,"ion-icon",13),e.k0s()())}function y(n,s){if(1&n&&(e.j41(0,"ion-toolbar"),e.DNE(1,B,2,0,"ion-buttons",8)(2,x,3,0,"ion-buttons",9),e.j41(3,"ion-title",10),e.EFF(4,"Food Catalog"),e.k0s()()),2&n){const i=e.XpG();e.R7$(),e.Y8G("ngIf","full"===i.headerMode),e.R7$(),e.Y8G("ngIf","mid"===i.headerMode),e.R7$(),e.Y8G("size","full"===i.headerMode?"large":"medium")}}let M=(()=>{var n;class s{onSegmentChange(t){null!=t&&null!=t.detail&&null!=t.detail.value&&""!=t.detail.value&&(this.currentSegment=t.detail.value,this.segmentChanged.emit(this.currentSegment))}constructor(){this.headerMode="full",this.currentSegment="ALL",this.segmentChanged=new e.bkB}ngOnInit(){}handleSegmentChanged(t){this.currentSegment=t}}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-food-catalog-header"]],inputs:{headerMode:"headerMode"},outputs:{segmentChanged:"segmentChanged"},decls:15,vars:2,consts:[[4,"ngIf"],["value","all","mode","md","scrollable","false",3,"ngModelChange","ionChange","ngModel"],["value","ALL"],["name","home"],["value","FAV"],["name","star"],["value","FOLDER"],["name","grid"],["slot","start",4,"ngIf"],["slot","end",4,"ngIf"],[3,"size"],["slot","start"],["slot","end"],["name","close"]],template:function(t,o){1&t&&(e.DNE(0,y,5,3,"ion-toolbar",0),e.j41(1,"ion-toolbar")(2,"ion-segment",1),e.mxI("ngModelChange",function(a){return e.DH7(o.currentSegment,a)||(o.currentSegment=a),a}),e.bIt("ionChange",function(a){return o.onSegmentChange(a)}),e.j41(3,"ion-segment-button",2)(4,"ion-label"),e.EFF(5,"ALL"),e.k0s(),e.nrm(6,"ion-icon",3),e.k0s(),e.j41(7,"ion-segment-button",4)(8,"ion-label"),e.EFF(9,"FAV"),e.k0s(),e.nrm(10,"ion-icon",5),e.k0s(),e.j41(11,"ion-segment-button",6)(12,"ion-label"),e.EFF(13,"FOLDER"),e.k0s(),e.nrm(14,"ion-icon",7),e.k0s()()()),2&t&&(e.Y8G("ngIf","none"!==o.headerMode),e.R7$(2),e.R50("ngModel",o.currentSegment))},dependencies:[h.bT,u.BC,u.vS,r.Jm,r.QW,r.iq,r.he,r.MC,r.Gp,r.eP,r.BC,r.ai,r.Je]}),s})(),k=(()=>{var n;class s{onSearchTermChange(t){let o="";null!=t&&null!=t.detail&&null!=t.detail.value&&""!=t.detail.value&&(o=t.detail.value.toLowerCase()),this.searchTerm=o,this.searchTermChanged.emit(this.searchTerm)}constructor(){this.searchTerm="",this.searchTermChanged=new e.bkB}ngOnInit(){}}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-food-catalog-footer"]],outputs:{searchTermChanged:"searchTermChanged"},decls:2,vars:1,consts:[["placeholder","Search for item","show-clear-button","always",3,"ionInput","debounce"]],template:function(t,o){1&t&&(e.j41(0,"ion-toolbar")(1,"ion-searchbar",0),e.bIt("ionInput",function(a){return o.onSearchTermChange(a)}),e.k0s()()),2&t&&(e.R7$(),e.Y8G("debounce",100))},dependencies:[r.S1,r.ai,r.Gw]}),s})();const N=[{path:"",component:(()=>{var n;class s{constructor(t,o){this.messageService=t,this.catalogService=o}ngOnInit(){}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(p.b),e.rXU(g.H))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-food-catalog-page"]],decls:8,vars:2,consts:[["catalogheader",""],["catalog",""],[3,"translucent"],["headerMode","full",3,"segmentChanged"],[3,"fullscreen"],[3,"segmentChanged"],[3,"searchTermChanged"]],template:function(t,o){if(1&t){const l=e.RV6();e.j41(0,"ion-header",2)(1,"app-food-catalog-header",3,0),e.bIt("segmentChanged",function(d){e.eBV(l);const c=e.sdS(5);return e.Njj(c.handleSegmentChanged(d))}),e.k0s()(),e.j41(3,"ion-content",4)(4,"app-food-catalog",5,1),e.bIt("segmentChanged",function(d){e.eBV(l);const c=e.sdS(2);return e.Njj(c.handleSegmentChanged(d))}),e.k0s()(),e.j41(6,"ion-footer")(7,"app-food-catalog-footer",6),e.bIt("searchTermChanged",function(d){e.eBV(l);const c=e.sdS(5);return e.Njj(c.handleSearchTermChanged(d))}),e.k0s()()}2&t&&(e.Y8G("translucent",!0),e.R7$(3),e.Y8G("fullscreen",!0))},dependencies:[r.W9,r.M0,r.eU,S,M,k]}),s})()}];let E=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[f.iI.forChild(N),f.iI]}),s})();var D=m(1815),X=m(8385),V=m(8581),O=m(1020),U=m(5293),Y=m(4075),$=m(8317),A=m(8361);function L(n,s){if(1&n&&(e.j41(0,"p"),e.EFF(1),e.k0s()),2&n){const i=e.XpG();e.R7$(),e.JRh(i.itemModel.name)}}function H(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-input",7),e.mxI("ngModelChange",function(o){e.eBV(i);const l=e.XpG();return e.DH7(l.itemModel.name,o)||(l.itemModel.name=o),e.Njj(o)}),e.bIt("ionInput",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.markModelChanged())}),e.k0s()}if(2&n){const i=e.XpG();e.R50("ngModel",i.itemModel.name)}}function Q(n,s){1&n&&(e.j41(0,"ion-badge",8),e.EFF(1,"item"),e.k0s())}function W(n,s){1&n&&(e.j41(0,"ion-badge",8),e.EFF(1,"folder"),e.k0s())}function J(n,s){1&n&&(e.j41(0,"ion-badge"),e.EFF(1,"fav"),e.k0s())}function z(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-row")(1,"div")(2,"ion-input",9),e.mxI("ngModelChange",function(o){e.eBV(i);const l=e.XpG();return e.DH7(l.itemModel.colour,o)||(l.itemModel.colour=o),e.Njj(o)}),e.bIt("ionInput",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.markModelChanged())}),e.k0s()()()}if(2&n){const i=e.XpG();e.R7$(2),e.R50("ngModel",i.itemModel.colour)}}function K(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-row")(1,"ion-toolbar")(2,"ion-button",10),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.toggleFavourite())}),e.nrm(3,"ion-icon",11),e.k0s(),e.j41(4,"ion-button",12),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.delete())}),e.nrm(5,"ion-icon",13),e.k0s(),e.j41(6,"ion-button",14),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.exportItem())}),e.nrm(7,"ion-icon",15),e.k0s(),e.j41(8,"ion-button",16),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.convertItem())}),e.EFF(9," Convert "),e.nrm(10,"ion-icon",17)(11,"ion-icon",18),e.k0s()()()}if(2&n){const i=e.XpG();e.R7$(2),e.Y8G("color",i.itemModel.isFavourite?"danger":"success"),e.R7$(),e.Y8G("name",i.itemModel.isFavourite?"heart-dislike":"heart"),e.R7$(8),e.Y8G("name",i.itemModel.isFolder?"pizza":"folder")}}function Z(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-row")(1,"ion-toolbar")(2,"ion-button",16),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.selectItem())}),e.EFF(3," Select item "),e.k0s()()()}}function q(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-row")(1,"ion-button",19),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.reset())}),e.EFF(2," Reset "),e.k0s(),e.j41(3,"ion-button",20),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.validateSave())}),e.EFF(4," Save "),e.k0s()()}if(2&n){const i=e.XpG();e.R7$(3),e.Y8G("disabled",""==i.itemModel.name)}}function ee(n,s){if(1&n){const i=e.RV6();e.j41(0,"ion-card",22)(1,"ion-card-content",23)(2,"app-portion",26),e.bIt("onPortionDeleted",function(o){e.eBV(i);const l=e.XpG(2);return e.Njj(l.portionDeleted(o))})("onPortionSelected",function(o){e.eBV(i);const l=e.XpG(2);return e.Njj(l.portionSelected(o))}),e.k0s()()()}if(2&n){const i=s.$implicit,t=s.index,o=e.XpG(2);e.R7$(2),e.Y8G("portion",i)("listPosition",t)("canSelectPortions",o.canSelectPortions)("allowEdit",!0)("allowDBDeletion",!0)}}function te(n,s){if(1&n){const i=e.RV6();e.j41(0,"div")(1,"p"),e.EFF(2,"Portions"),e.k0s(),e.DNE(3,ee,3,5,"ion-card",21),e.j41(4,"ion-card",22)(5,"ion-card-content",23)(6,"ion-item",24),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.createNewPortion())}),e.nrm(7,"ion-icon",25),e.j41(8,"ion-label"),e.EFF(9,"Add portion "),e.k0s()()()()()}if(2&n){const i=e.XpG();e.R7$(3),e.Y8G("ngForOf",i.portions)}}let oe=(()=>{var n;class s{get item(){return this._item}set item(t){this._item=t,this.reload()}get editMode(){return this._editMode}set editMode(t){this._editMode=t,this.reload()}constructor(t,o,l,a,d,c,_){this.catalogService=t,this.loadingService=o,this.messageService=l,this.alertService=a,this.portionService=d,this.imageService=c,this.imageCaptureService=_,this.itemChange=new e.bkB,this._editMode=!1,this.editModeChange=new e.bkB,this.canSelectItems=!1,this.canSelectPortions=!1,this.onItemDeleted=new e.bkB,this.onItemSelected=new e.bkB,this.onPortionSelected=new e.bkB,this.onFolderConversion=new e.bkB,this.onImageChanged=new e.bkB,this.modelChanged=!1,this.existingFolderConversion=!1}ngOnInit(){this.itemModel=this.cloneItem(this.item),this.portionService.dataReady.subscribe(t=>{t&&this.loadPortions()})}reload(){this.itemModel=this.cloneItem(this.item)}loadPortions(){this.item.id&&this.loadingService.addToQueue(this.portionService.getAllForIndex(V.$I.PORTION_TBL_CATALOG_ITEM_ID,this.item.id).then(t=>{this.portions=t}))}cloneItem(t){return{...t}}colorChanged(){this.markModelChanged()}toggleFavourite(){this.itemModel.isFavourite=!this.itemModel.isFavourite,this.markModelChanged()}convertItem(){this.itemModel.isFolder?this.convertToItem():this.convertToFolder()}convertToFolder(){this.itemModel.isFolder=!0,this.itemModel.childIds=[],this.markModelChanged()}convertToItem(){this.itemModel.isFolder=!1,delete this.itemModel.childIds,this.markModelChanged()}markModelChanged(){this.modelChanged=!0}reset(){this.itemModel=this.cloneItem(this.item),this.modelChanged=!1}validateSave(){this.isExistingItemToFolderConversion()?this.alertService.promptDecision("Choice","","Do you want to keep the original item, and place it within the new folder?",[{text:"cancel",role:"cancel"},{text:"delete",role:"delete"},{text:"keep",role:"keep"}]).then(t=>{var o;switch(t){case"delete":this.save();break;case"keep":let l=this.itemModel.id;delete this.itemModel.id,null===(o=this.itemModel.childIds)||void 0===o||o.push(null!=l?l:-1),this.save(),this.existingFolderConversion=!0;break;default:return}}):this.save()}save(){return new Promise(t=>{let o=this.catalogService.saveItemToDB(this.itemModel);this.loadingService.addToQueue(o),o.then(l=>{this.modelChanged=!1,this.item=this.existingFolderConversion?this.item:l,this.itemChange.emit(this.item),this.messageService.display("Item saved!",2,"middle"),this.setEditMode(!1),this.existingFolderConversion&&this.onFolderConversion.emit(l),t()})})}isExistingItemToFolderConversion(){var t;return null!==(t=null!=this.itemModel.id&&this.itemModel.isFolder&&!this.item.isFolder)&&void 0!==t&&t}delete(){this.alertService.promptConfirmation("Confirm","are you sure you want to delete this item?","no","yes").then(t=>{if(t){let o=this.catalogService.deleteEntityFromDB(this.item.id);this.loadingService.addToQueue(o),o.then(()=>{this.onItemDeleted.emit(),this.messageService.display("Item deleted!",3,"middle")})}})}setEditMode(t){this.editMode=t,this.editModeChange.emit(t)}selectItem(){this.onItemSelected.emit(this.item)}portionDeleted(t){let o=this.portions.map(l=>l.id).indexOf(t.id);-1!=o&&this.portions.splice(o,1)}portionSelected(t){this.onPortionSelected.emit(t)}createNewPortion(){this.item.id&&this.loadingService.addToQueue(this.portionService.saveItemToDB({name:"",catalogItemId:this.item.id,imageId:this.item.imageId,measure:0,unit:"g",carbs:0}).then(o=>{this.loadPortions()}))}onImageClicked(t){this.imageService.userCreateImage().then(o=>{var l;o?(t.imageId=null!==(l=o.id)&&void 0!==l?l:0,this.save().then(()=>{this.onImageChanged.emit()})):this.messageService.display("Photo upload cancelled.")})}exportItem(){this.catalogService.getExportableItemData(this.item).then(t=>{console.log("Data",t);let o=JSON.stringify(t);O.B.write({string:o}).then(()=>{this.messageService.display("Item export data copied to clipboard.",6,"middle")})})}}return(n=s).\u0275fac=function(t){return new(t||n)(e.rXU(g.H),e.rXU(b.U),e.rXU(p.b),e.rXU(v.u),e.rXU(U.t),e.rXU(Y.f),e.rXU($.X))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-item-details"]],inputs:{_item:"_item",item:"item",_editMode:"_editMode",editMode:"editMode",canSelectItems:"canSelectItems",canSelectPortions:"canSelectPortions"},outputs:{itemChange:"itemChange",editModeChange:"editModeChange",onItemDeleted:"onItemDeleted",onItemSelected:"onItemSelected",onPortionSelected:"onPortionSelected",onFolderConversion:"onFolderConversion",onImageChanged:"onImageChanged"},decls:19,vars:17,consts:[["size","auto"],[3,"onItemClicked","item","clickable","showTitle","showIcons","animate","overlayIcon","reloadEmitter"],[4,"ngIf"],["class","enhanced-visibility","fill","outline","type","text","placeholder","enter name",3,"ngModel","ngModelChange","ionInput",4,"ngIf"],[1,"mt-1"],[1,"flex"],["class","mr-2",4,"ngIf"],["fill","outline","type","text","placeholder","enter name",1,"enhanced-visibility",3,"ngModelChange","ionInput","ngModel"],[1,"mr-2"],["label","Colour","labelPlacement","stacked","placeholder","Colour","type","color",3,"ngModelChange","ionInput","ngModel"],["shape","round",3,"click","color"],["slot","icon-only",3,"name"],["shape","round","color","danger",3,"click"],["slot","icon-only","name","trash"],["shape","round",3,"click"],["slot","icon-only","name","download"],["size","small","shape","round","color","warning",3,"click"],["slot","end","name","chevron-forward"],["slot","end",3,"name"],["shape","round","color","warning",3,"click"],["shape","round","color","success",3,"click","disabled"],["class","portion-card",4,"ngFor","ngForOf"],[1,"portion-card"],[1,"no-padding"],["lines","none",3,"click"],["name","add","size","large","color","primary"],[3,"onPortionDeleted","onPortionSelected","portion","listPosition","canSelectPortions","allowEdit","allowDBDeletion"]],template:function(t,o){1&t&&(e.j41(0,"ion-content")(1,"ion-grid")(2,"ion-row")(3,"ion-col",0)(4,"app-catalog-item",1),e.bIt("onItemClicked",function(a){return o.onImageClicked(a)}),e.k0s()(),e.j41(5,"ion-col")(6,"ion-row"),e.DNE(7,L,2,1,"p",2)(8,H,1,1,"ion-input",3),e.k0s(),e.j41(9,"ion-row",4)(10,"div",5),e.DNE(11,Q,2,0,"ion-badge",6)(12,W,2,0,"ion-badge",6)(13,J,2,0,"ion-badge",2),e.k0s()(),e.DNE(14,z,3,1,"ion-row",2),e.k0s()(),e.DNE(15,K,12,3,"ion-row",2)(16,Z,4,0,"ion-row",2)(17,q,5,1,"ion-row",2),e.k0s(),e.DNE(18,te,10,1,"div",2),e.k0s()),2&t&&(e.R7$(4),e.Y8G("item",o.itemModel)("clickable",o.editMode)("showTitle",!1)("showIcons",!1)("animate",!1)("overlayIcon",o.editMode?"camera":"")("reloadEmitter",o.onImageChanged),e.R7$(3),e.Y8G("ngIf",!o.editMode),e.R7$(),e.Y8G("ngIf",o.editMode),e.R7$(3),e.Y8G("ngIf",!o.itemModel.isFolder),e.R7$(),e.Y8G("ngIf",o.itemModel.isFolder),e.R7$(),e.Y8G("ngIf",o.itemModel.isFavourite),e.R7$(),e.Y8G("ngIf",o.editMode),e.R7$(),e.Y8G("ngIf",o.editMode),e.R7$(),e.Y8G("ngIf",o.canSelectItems&&!o.editMode&&o.itemModel.id),e.R7$(),e.Y8G("ngIf",o.modelChanged),e.R7$(),e.Y8G("ngIf",!o.itemModel.isFolder))},dependencies:[h.Sq,h.bT,u.BC,u.vS,r.In,r.Jm,r.b_,r.I9,r.hU,r.W9,r.lO,r.iq,r.$w,r.uz,r.he,r.ln,r.ai,r.Gw,F.I,A.x]}),s})(),ne=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.MD,u.YN,r.bv,D.U]}),s})();e.wjB(C,[h.bT,r.Jm,r.QW,r.W9,r.M0,r.eU,r.iq,r.BC,r.ai,oe],[]),e.wjB(X.g,[h.bT,r.Jm,r.QW,r.W9,r.M0,r.eU,r.iq,r.BC,r.ai,S,M,k],[]);let ie=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.MD,u.YN,r.bv,E,D.U,ne]}),s})()}}]);